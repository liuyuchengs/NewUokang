{"version":3,"sources":["activity.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","queryParams","pageRows","currentPage","flag","noProduct","noProductText","products","init","hasBgColor","search","queryActivity","changeRoute","post","url","host","params","then","data","code","length","mergeActivity","concat","alert","loading","items","forEach","item","priceunit","preferPriceType","pricetype","samllimg","type","hasActivity","detail","productId","hospitalId","loadNext","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY"],"mappings":"AAAAA,OAAO,WACH,MAAO,UAASC,OAAOC,WAAWC,UAAUC,KAAKC,MAE7CJ,OAAOK,aACHC,SAAS,GACTC,YAAY,EACZC,KAAK,MAGTR,OAAOS,WAAY,EACnBT,OAAOU,cAAgB,GACvBV,OAAOW,YAGPX,OAAOY,KAAO,WACVX,WAAWY,YAAa,EACrBX,UAAUY,SAASN,MAClBR,OAAOK,YAAYG,KAAON,UAAUY,SAASN,KAC7CR,OAAOe,iBAEPZ,KAAKa,YAAY,UAKzBhB,OAAOe,cAAgB,WACnBX,KAAKa,MACDC,IAAIf,KAAKgB,KAAK,4BACdC,OAAOpB,OAAOK,cACfgB,KAAK,SAASC,MACG,IAAbA,KAAKC,OACDD,KAAKA,KAAKE,OAAO,GACbxB,OAAOW,SAASa,OAAO,EACtBxB,OAAOU,cAAgB,OAEvBV,OAAOU,cAAgB,SAE3BV,OAAOS,WAAY,IAEnBT,OAAOyB,cAAcH,KAAKA,MAC1BtB,OAAOW,SAAWX,OAAOW,SAASe,OAAOJ,KAAKA,UAd1DlB,SAkBS,WACLD,KAAKwB,MAAM,mBAnBfvB,WAoBW,WACPH,WAAW2B,SAAU,KAK7B5B,OAAOyB,cAAgB,SAASI,OAC5BA,MAAMC,QAAQ,SAASC,MACA,MAAhBA,KAAKC,WAAiC,IAAhBD,KAAKC,UAC1BD,KAAKE,gBAAkBF,KAAKG,UAAU,IAAIH,KAAKC,UAE/CD,KAAKE,gBAAkBF,KAAKG,UAEd,IAAfH,KAAKI,UAA6B,MAAfJ,KAAKI,WACvBJ,KAAKI,SAAW,iCAEL,IAAZJ,KAAKK,OACJL,KAAKM,aAAc,MAM/BrC,OAAOsC,OAAS,SAASC,UAAUC,WAAWJ,MACvCG,WAAWC,YAAYJ,OACZ,IAAPA,MACCjC,KAAKa,YAAY,eAAe,aAAauB,UAAU,eAAeC,YAC/D,IAAPJ,KACAjC,KAAKa,YAAY,eAAe,aAAauB,UAAU,eAAeC,WAAW,kBAEjFrC,KAAKa,YAAY,kBAAkB,aAAauB,UAAU,eAAeC,cAKrFxC,OAAOyC,SAAW,WACdzC,OAAOK,YAAYE,cACnBP,OAAOe,iBAIjB2B,OAAOC,SAAW,WACjB,IAAG1C,WAAW2B,UAAS5B,OAAOS,UAA9B,CAGA,GAAImC,MAAOC,SAASD,KAChBE,KAAOD,SAASE,gBAChBC,OAASC,KAAKC,IAAKN,KAAKO,aAAcP,KAAKQ,aAAaN,KAAKO,aAAcP,KAAKK,aAAcL,KAAKM,aACpGJ,QAAON,OAAOY,aACZN,OAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClDtD,OAAOyC","file":"activity.js","sourcesContent":["define(function(){\r\n    return function($scope,$rootScope,$location,Tool,Ajax){\r\n        // 查询参数\r\n        $scope.queryParams = {\r\n            pageRows:10,\r\n            currentPage:1,\r\n            flag:null,\r\n        }\r\n\r\n        $scope.noProduct = false;\r\n        $scope.noProductText = \"\";\r\n        $scope.products = [];\r\n\r\n        // 页面初始化\r\n        $scope.init = function(){\r\n            $rootScope.hasBgColor = false;\r\n            if($location.search().flag){\r\n                $scope.queryParams.flag = $location.search().flag;\r\n                $scope.queryActivity();\r\n            }else{\r\n                Tool.changeRoute(\"/home\");\r\n            }\r\n        }\r\n\r\n        // 查询活动数据\r\n        $scope.queryActivity = function(){\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/product/queryActivity\",\r\n                params:$scope.queryParams,\r\n            }).then(function(data){\r\n                if(data.code ===0){\r\n                    if(data.data.length<1){\r\n                        if($scope.products.length<1){\r\n                            $scope.noProductText = \"暂无数据\";\r\n                        }else{\r\n                            $scope.noProductText = \"已经没有了!\";\r\n                        }\r\n                        $scope.noProduct = true;\r\n                    }else{\r\n                        $scope.mergeActivity(data.data);\r\n                        $scope.products = $scope.products.concat(data.data);\r\n                    }\r\n                    \r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"获取数据失败，请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        // 处理活动数据\r\n        $scope.mergeActivity = function(items){\r\n            items.forEach(function(item){\r\n                if(item.priceunit!=null&&item.priceunit!=\"\"){\r\n                    item.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n                }else{\r\n                    item.preferPriceType = item.pricetype;\r\n                }\r\n                if(item.samllimg==\"\"||item.samllimg==null){\r\n                    item.samllimg = \"../contents/img/p_default.png\";\r\n                }\r\n                if(item.type===6){\r\n                    item.hasActivity = true;\r\n                }\r\n            })\r\n        }\r\n\r\n        // 跳转到详情页面\r\n        $scope.detail = function(productId,hospitalId,type){\r\n            if(productId&&hospitalId&&type){\r\n                if(type===5){\r\n                    Tool.changeRoute(\"/exam/detail\",\"productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n                }if(type===6){\r\n                    Tool.changeRoute(\"/exam/detail\",\"productId=\"+productId+\"&hospitalId=\"+hospitalId+\"&activityp=元/次\");\r\n                }else{\r\n                    Tool.changeRoute(\"/product/detail\",\"productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n                }\r\n            }\r\n        }\r\n\r\n        $scope.loadNext = function(){\r\n            $scope.queryParams.currentPage++;\r\n            $scope.queryActivity();\r\n        }\r\n\r\n        // 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($rootScope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n})"],"sourceRoot":"/source/"}