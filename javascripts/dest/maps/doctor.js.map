{"version":3,"sources":["doctor.js"],"names":["define","$scope","$rootScope","$http","Tool","Ajax","Params","hasBg","profValue","profItemValue","doctors","noProduct","noProductText","orderParams","default","has","val","title","score","areaParams","professionalParams","queryParams","professionId","itemid","orderby","city","area","pageRows","currentPage","menuParams","order","professional","init","hasBgColor","loadDoctor","window","onscroll","loading","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","switchMenu","menu","switchObj","selectMenu","item","obj","ob","resetDate","selectProfression","selectProfressionItem","pro","proId","id","post","url","host","params","then","data","length","mergeDoctor","concat","alert","items","forEach","sales","detail","changeRoute"],"mappings":"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","file":"doctor.js","sourcesContent":["define(function(){\r\n    return function($scope,$rootScope,$http,Tool,Ajax,Params){\r\n        $scope.hasBg = false;\r\n        $scope.profValue = \"default\";\r\n        $scope.profItemValue = \"default\";\r\n        $scope.doctors = [];\r\n        $scope.noProduct = false;\r\n        $scope.noProductText = \"\";\r\n        // 下拉菜单项变量\r\n        $scope.orderParams ={\r\n            default:{has:true,val:\"\"},\r\n            title:{has:false,val:\"profession_title desc\"},\r\n            score:{has:false,val:\"score desc\"}\r\n        }\r\n        $scope.areaParams = Params.areaParams;\r\n        $scope.professionalParams = Params.professionalParams;\r\n\r\n        // 查询参数\r\n        $scope.queryParams = {\r\n            professionId:\"\",\r\n            itemid:\"\",\r\n            orderby:\"\",\r\n            city:\"深圳\",\r\n            area:\"\",\r\n            pageRows:10,\r\n            currentPage:1\r\n        }\r\n\r\n        // 导航栏变量，需定义在上述变量的后面\r\n        $scope.menuParams = {\r\n            area:{has:false,val:$scope.areaParams},\r\n            order:{has:false,val:$scope.orderParams},\r\n            professional:{has:false,val:$scope.professionalParams},\r\n        }\r\n\r\n        // 初始化页面\r\n        $scope.init = function(){\r\n            $rootScope.hasBgColor = true;\r\n            $scope.loadDoctor();\r\n        }\r\n\r\n        // 滚动监听\r\n        window.onscroll = function(){\r\n            if($rootScope.loading||$scope.noProduct){\r\n                return;\r\n            }\r\n            var body = document.body;\r\n            var html = document.documentElement;\r\n            var height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n            if(height>window.innerHeight){\r\n                if (height - window.scrollY - window.innerHeight < 100) {\r\n                    $scope.loadNext();\r\n                }\r\n            }\r\n        }\r\n\r\n        // 切换导航菜单\r\n        $scope.switchMenu = function(menu){\r\n            $scope.switchObj(menu,$scope.menuParams,true);\r\n        }\r\n\r\n        // 选择区域和排序项目\r\n        $scope.selectMenu = function(item,obj){\r\n            var ob = $scope.menuParams[obj].val;\r\n            $scope.switchObj(item,ob);\r\n            if(obj==\"area\"){\r\n                $scope.queryParams.area = ob[item].val;\r\n            }\r\n            if(obj==\"order\"){\r\n                $scope.queryParams.orderby = ob[item].val;\r\n            }\r\n            $scope.switchMenu(obj);\r\n            $scope.resetDate();\r\n            $scope.loadDoctor();\r\n        }\r\n\r\n        // 选择专科\r\n        $scope.selectProfression = function(item){\r\n            $scope.switchObj(item,$scope.professionalParams);\r\n        }\r\n\r\n        // 选择专科项目\r\n        $scope.selectProfressionItem = function(item,pro){\r\n            if(item!=$scope.profItemValue){\r\n                if($scope.profValue==\"\"&&$scope.profItemValue==\"\"){\r\n                    $scope.professionalParams[pro].val[item].has = true;\r\n                }else{\r\n                    $scope.professionalParams[$scope.profValue].val[$scope.profItemValue].has = false;\r\n                    $scope.professionalParams[pro].val[item].has = true;\r\n                }\r\n                $scope.profItemValue = item;\r\n                $scope.profValue = pro;\r\n                $scope.queryParams.professionId = $scope.professionalParams[pro].proId;\r\n                $scope.queryParams.itemid = $scope.professionalParams[pro].val[item].id;\r\n                $scope.switchMenu(\"professional\");\r\n                $scope.resetDate();\r\n                $scope.loadDoctor();\r\n\r\n            }\r\n        }\r\n\r\n        // 切换对象的值\r\n        $scope.switchObj = function(item,obj,hasBg){\r\n            for(var pro in obj){\r\n                if(pro==item){\r\n                    obj[pro].has = !obj[pro].has;\r\n                    if(hasBg){\r\n                        $scope.hasBg = obj[pro].has;\r\n                    }\r\n                }else{\r\n                    obj[pro].has = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        // 加载医生数据\r\n        $scope.loadDoctor = function(){\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/doctor/querydoctorbycityandprofession\",\r\n                params:$scope.queryParams\r\n            }).then(function(data){\r\n                if(data.data.length<1){\r\n                    if($scope.doctors.length<1){\r\n                        $scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n                    }else{\r\n                        $scope.noProductText = \"已经没有项目了!\";\r\n                    }\r\n                    $scope.noProduct = true;\r\n                }else{\r\n                    $scope.mergeDoctor(data.data);\r\n                    $scope.doctors = $scope.doctors.concat(data.data);\r\n                }\r\n            }).catch(function(){\r\n                $scope.noProduct = true;\r\n                Tool.alert(\"数据加载失败，请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading =false;\r\n            })\r\n        }\r\n\r\n        // 处理医生数据\r\n        $scope.mergeDoctor = function(items){\r\n            items.forEach(function(item){\r\n                if(item.score==\"\"||item.score==null){\r\n                    item.score=\"暂无评\";\r\n                }\r\n                if(item.sales==\"\"||item.sales==null){\r\n                    item.sales=0;\r\n                }\r\n            })\r\n        }\r\n\r\n        // 加载下一页数据\r\n        $scope.loadNext = function(){\r\n            $scope.queryParams.currentPage++;\r\n            $scope.loadDoctor();\r\n        }\r\n\r\n        // 重置查询数据\r\n        $scope.resetDate = function(){\r\n            $scope.queryParams.currentPage = 1;\r\n            $scope.noProduct = false;\r\n            $scope.noProductText = \"\";\r\n            $scope.doctors = [];\r\n        }\r\n\r\n        // 跳转到详情页面\r\n        $scope.detail = function(id){\r\n            Tool.changeRoute(\"/doctor/detail\",\"id=\"+id);\r\n        }\r\n    }\r\n\r\n})"],"sourceRoot":"/source/"}