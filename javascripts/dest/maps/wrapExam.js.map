{"version":3,"sources":["wrapExam.js"],"names":["define","$scope","$http","Tool","Ajax","loading","noProduct","noProductText","products","queryParams","flag","city","area","professionId","itemId","currentPage","init","loadHost","loadProduct","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","url","host","params","convertParams","post","headers","Content-type","success","data","code","length","mergeProdcut","concat","error","alert","items","forEach","item","priceunit","preferPriceType","pricetype","detail","proId","hosId","goPage"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,MAAMC,KAAKC,MACjCH,OAAOI,SAAU,EACjBJ,OAAOK,WAAY,EACnBL,OAAOM,cAAc,GACrBN,OAAOO,YAEPP,OAAOQ,aACNC,KAAK,EACLC,KAAK,KACLC,KAAK,GACLC,aAAa,IACbC,OAAO,GACPC,YAAY,GAIbd,OAAOe,KAAO,WACbZ,KAAKa,SAAShB,OAAO,WACpBA,OAAOiB,iBAKTC,OAAOC,SAAW,WACjB,IAAGnB,OAAOI,UAASJ,OAAOK,UAA1B,CAGA,GAAIe,MAAOC,SAASD,KAChBE,KAAOD,SAASE,gBAChBC,OAASC,KAAKC,IAAKN,KAAKO,aAAcP,KAAKQ,aAAaN,KAAKO,aAAcP,KAAKK,aAAcL,KAAKM,aACpGJ,QAAON,OAAOY,aACZN,OAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClD9B,OAAOgC,aAMVhC,OAAOiB,YAAc,WACpBjB,OAAOI,SAAU,CACjB,IAAI6B,KAAMjC,OAAOkC,KAAK,0BAClBC,OAASjC,KAAKkC,cAAcpC,OAAOQ,YACvCP,OAAMoC,KAAKJ,IAAIE,QACdG,SACCC,eAAe,qDAEdC,QAAQ,SAASC,MACL,GAAXA,KAAKC,OACJD,KAAKA,KAAKE,OAAO,GAChB3C,OAAOO,SAASoC,OAAO,EACzB3C,OAAOM,cAAgB,sBAEvBN,OAAOM,cAAgB,WAExBN,OAAOK,WAAY,IAEnBL,OAAO4C,aAAaH,KAAKA,MACzBzC,OAAOO,SAAWP,OAAOO,SAASsC,OAAOJ,KAAKA,OAE/CzC,OAAOI,SAAQ,KAEd0C,MAAM,WACR9C,OAAOI,SAAQ,EACfJ,OAAOK,WAAY,EACnBH,KAAK6C,MAAM/C,OAAO,oBAKpBA,OAAO4C,aAAe,SAASI,OAC9BA,MAAMC,QAAQ,SAASC,MACH,MAAhBA,KAAKC,WAAiC,IAAhBD,KAAKC,UAC7BD,KAAKE,gBAAkBF,KAAKG,UAAU,IAAIH,KAAKC,UAE/CD,KAAKE,gBAAkBF,KAAKG,aAM/BrD,OAAOsD,OAAS,SAASC,MAAMC,OAC9BtD,KAAKuD,OAAO,0CAA0CF,MAAM,eAAeC,QAI5ExD,OAAOgC,SAAW,WACjBhC,OAAOQ,YAAYM,cACnBd,OAAOiB","file":"wrapExam.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$http,Tool,Ajax){\r\n\t\t$scope.loading = false;\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText=\"\";\r\n\t\t$scope.products = [];\r\n\r\n\t\t$scope.queryParams = {\r\n\t\t\tflag:1,\r\n\t\t\tcity:\"深圳\",\r\n\t\t\tarea:\"\",\r\n\t\t\tprofessionId:\"6\",\r\n\t\t\titemId:\"\",\r\n\t\t\tcurrentPage:1,\r\n\t\t}\r\n\r\n\t\t// 初始化\r\n\t\t$scope.init = function(){\r\n\t\t\tAjax.loadHost($scope,function(){\r\n\t\t\t\t$scope.loadProduct();\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载体检项目\r\n\t\t$scope.loadProduct = function(){\r\n\t\t\t$scope.loading = true;\r\n\t\t\tvar url = $scope.host+\"/wx/product/queryByMidd\";\r\n\t\t\tvar params = Tool.convertParams($scope.queryParams);\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\t\tif($scope.products.length<1){\r\n\t\t\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t\t$scope.products = $scope.products.concat(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.loading=false;\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\t$scope.loading=false;\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\tTool.alert($scope,\"查询数据失败，请稍后再试！\");\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 合并价格单位,如：元/次\r\n\t\t$scope.mergeProdcut = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 跳转到套餐详细页面\r\n\t\t$scope.detail = function(proId,hosId){\r\n\t\t\tTool.goPage(\"/new/htmls/exam-detail.html#?productId=\"+proId+\"&hospitalId=\"+hosId);\r\n\t\t}\r\n\r\n\t\t// 加载下一页数据\r\n\t\t$scope.loadNext = function(){\r\n\t\t\t$scope.queryParams.currentPage++;\r\n\t\t\t$scope.loadProduct();\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}