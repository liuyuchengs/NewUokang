{"version":3,"sources":["home.js"],"names":["define","$scope","$rootScope","$http","Tool","Ajax","Weixin","items","currentPage","noProduct","noProductText","banners","locationInfo","imgStyle","width","screen","gotoMenu","path","goPage","init","hasBgColor","loadRecommend","queryBanner","initSwiper","getSession","city","wxInit","getLocation","wxConfig","latitude","longitude","url","key","jsonp","success","data","status","result","address_component","setSession","error","window","onscroll","loading","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","host","params","post","headers","Content-type","code","length","mergeProdcut","concat","alert","forEach","item","priceunit","preferPriceType","pricetype","samllimg","mergeBanner","Swiper","loop","pagination","autoplay","autoplayDisableOnInteraction","observeParents","observer","onSlideChangeEnd","swiper","activeIndex","stopAutoplay","setTimeout","startAutoplay","detail","productId","hospitalId","type","changeRoute","activity","id"],"mappings":"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","file":"home.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$http,Tool,Ajax,Weixin){\r\n\t\t$scope.items = [];\r\n\t\t$scope.currentPage = 1;\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.banners = [];\r\n\t\t//$scope.key = \"LFQBZ-7UNCX-VDR44-T34PN-OX2VQ-M2BNI\"; //个人私钥，后续可更换为企业密钥\r\n\t\t$scope.locationInfo =\"深圳市\"\r\n\t\t$scope.imgStyle = {\r\n\t\t\t\"width\":screen.width\r\n\t\t}\r\n\t\t$scope.gotoMenu = function(path){\r\n\t\t\tTool.goPage(path);\r\n\t\t}\r\n\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = false;\r\n\t\t\t$scope.loadRecommend();\r\n\t\t\t$scope.queryBanner();\r\n\t\t\t$scope.initSwiper();\r\n\t\t\tif(Tool.getSession(\"locationInfo\")){\r\n\t\t\t\t$scope.locationInfo = Tool.getSession(\"locationInfo\").city;\r\n\t\t\t}else{\r\n\t\t\t\tWeixin.wxInit($scope,$scope.getLocation);\r\n\t\t\t\tWeixin.wxConfig($scope);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 逆地址服务暂不用 \r\n\t\t$scope.getLocation = function(latitude,longitude){\r\n\t\t\tvar url = \"https://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&callback=JSON_CALLBACK&location=\"+latitude+\",\"+longitude+\"&key=\"+$scope.key;\r\n\t\t\t$http.jsonp(url).success(function(data){\r\n\t\t\t\tif(data.status==0){\r\n\t\t\t\t\t$scope.locationInfo = data.result.address_component.city;\r\n\t\t\t\t\tvar locationInfo = Tool.getSession(\"locationInfo\");\r\n\t\t\t\t\tlocationInfo.city = data.result.address_component.city;\r\n\t\t\t\t\tTool.setSession(\"locationInfo\",locationInfo);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.locationInfo = \"定位失败\";\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\t$scope.locationInfo = \"定位失败\";\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 查询热门推荐\r\n\t\t$scope.loadRecommend = function(){\r\n\t\t\t$rootScope.loading = true;\r\n\t\t\tvar url = Tool.host+\"/wx/product/queryrecommend\";\r\n\t\t\tvar params = \"city=深圳&currentPage=\"+$scope.currentPage;\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\t\tif($scope.items.length<1){\r\n\t\t\t\t\t\t\t$scope.noProductText = \"暂时没有热门项目\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t\t$scope.items = $scope.items.concat(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t}).error(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\tTool.alert(\"获取热门推荐数据失败，请稍后再试!\");\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 处理数据\r\n\t\t$scope.mergeProdcut = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.samllimg==\"\"||item.samllimg==null){\r\n\t\t\t\t\titem.samllimg = \"../contents/img/p_default.png\";\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 获取图片轮播\r\n\t\t$scope.queryBanner = function(){\r\n\t\t\t$rootScope.loading = true;\r\n\t\t\tvar url = Tool.host+\"/wx/banner/query\";\r\n\t\t\tvar params = \"type=home_banner\";\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.mergeBanner(data.data);\r\n\t\t\t\t\t$scope.banners = data.data;\r\n\t\t\t\t}\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t}).error(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\tTool.alert(\"获取主页图片失败，请稍后再试!\");\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 初始化图片轮播插件\r\n\t\t$scope.initSwiper = function(){\r\n\t\t\t//初始化swiper\r\n\t\t\tvar myswiper = new Swiper(\".swiper-container\",{\r\n\t\t\t\tloop:false,\r\n\t\t\t\tpagination: '.swiper-pagination',\r\n\t\t\t\tautoplay: 2000,\r\n\t\t\t\tautoplayDisableOnInteraction:false,\r\n\t\t\t\tobserveParents:true,  //\r\n\t\t\t\tobserver:true,\r\n\t\t\t\t//第一张轮播图显示6s,其他的2s\r\n\t\t\t\tonSlideChangeEnd: function(swiper){\r\n\t\t\t\t\tif(swiper.activeIndex==0||swiper.activeIndex==1){\r\n\t\t\t\t\t\tswiper.stopAutoplay();\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\tif(swiper.activeIndex==0||swiper.activeIndex==1){\r\n\t\t\t\t\t\t\t\tswiper.startAutoplay();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},4000)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tswiper.startAutoplay();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t}\r\n\r\n\t\t// 跳转到详细页面\r\n\t\t$scope.detail = function(productId,hospitalId,type){\r\n\t\t\tif(type===5){\r\n\t\t\t\tTool.changeRoute(\"/exam/detail\",\"productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/product/detail\",\"flag=1&productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\t// 图片轮播跳转\r\n\t\t$scope.activity = function(id){\r\n\t\t\tif(id===1){\r\n\t\t\t\tTool.changeRoute(\"/invite/new\");\r\n\t\t\t}\r\n\t\t\tif(id===2){\r\n\t\t\t\tTool.changeRoute(\"/activity\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 分页查询，查询下一页\r\n\t\t$scope.loadNext = function(){\r\n\t\t\t$scope.currentPage++;\r\n\t\t\t$scope.loadRecommend();\r\n\t\t}\r\n\t}\r\n})\r\n\r\n\r\n"],"sourceRoot":"/source/"}