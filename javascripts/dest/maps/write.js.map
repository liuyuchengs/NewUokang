{"version":3,"sources":["write.js"],"names":["define","$scope","$rootScope","$http","Tool","Ajax","postData","FormData","noBeforeSelect","noAfterSelect","beforeParams","input1","has","url","val","input2","input3","input4","input5","input6","afterParams","input7","input8","input9","queryParams","postName","postIntro","postContent","hospitalId","doctorId","productId","img1","img2","img3","p1","p2","p3","flag","switchParams","kanya","qiumei","yunsheng","order","orderInfo","select","value","load","hasBgColor","noWindowListen","checkLogin","loadUserinfo","loadOrder","listen","comfirm","hasTip","changeRoute","goTo","path","$","on","getUrl","this","files","$apply","obj","undefined","window","createObjectURL","URL","webkitURL","item","mergeSay","imgStr","pStr","count","afterCount","file","Blob","type","index","prototype","append","get","mergeNote","beforeCount","prototypeB","prototypeA","addPost","merge","alert","host","loading","post","headers","Content-Type","accessToken","userInfo","success","data","code","error","addSayPost","addNotePost","chooseSayPic","click","chooseBeforePic","chooseAfterPic","removeBefore","clear","removeAfter","selector","element","document","getElementById","outerHTML","params","status","userId","id","then","result","filter","length","chooseOrder","chooseProduct","productName"],"mappings":"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","file":"write.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$http,Tool,Ajax){\r\n\t\t$scope.postData = new FormData();\r\n\t\t$scope.noBeforeSelect = true;\r\n\t\t$scope.noAfterSelect = true;\r\n\t\t$scope.beforeParams = {\r\n\t\t\tinput1:{has:false,url:\"\",val:\"#input1\"},\r\n\t\t\tinput2:{has:false,url:\"\",val:\"#input2\"},\r\n\t\t\tinput3:{has:false,url:\"\",val:\"#input3\"},\r\n\t\t\tinput4:{has:false,url:\"\",val:\"#input4\"},\r\n\t\t\tinput5:{has:false,url:\"\",val:\"#input5\"},\r\n\t\t\tinput6:{has:false,url:\"\",val:\"#input6\"},\r\n\t\t}\r\n\t\t$scope.afterParams = {\r\n\t\t\tinput7:{has:false,url:\"\",val:\"#input7\"},\r\n\t\t\tinput8:{has:false,url:\"\",val:\"#input8\"},\r\n\t\t\tinput9:{has:false,url:\"\",val:\"#input9\"},\r\n\t\t}\r\n\t\t$scope.queryParams ={\r\n\t\t\tpostName:null,\r\n\t\t\tpostIntro:null,\r\n\t\t\tpostContent:null,\r\n\t\t\thospitalId:null,\r\n\t\t\tdoctorId:null,\r\n\t\t\tproductId:null,\r\n\t\t\timg1:null,\r\n\t\t\timg2:null,\r\n\t\t\timg3:null,\r\n\t\t\tp1:null,\r\n\t\t\tp2:null,\r\n\t\t\tp3:null,\r\n\t\t\tflag:1,\r\n\t\t}\r\n\t\t//发帖类型信息\r\n\t\t$scope.switchParams = {\r\n\t\t\tkanya:{has:true,val:1},\r\n\t\t\tqiumei:{has:false,val:2},\r\n\t\t\tyunsheng:{has:false,val:3}\r\n\t\t}\r\n\t\t$scope.order = {\r\n\t\t\thas:false,\r\n\t\t\torderInfo:null,\r\n\t\t}\r\n\t\t$scope.select = {\r\n\t\t\thas:false,\r\n\t\t\tvalue:\"\"\r\n\t\t}\r\n\r\n\t\t// 页面初始化\r\n\t\t$scope.load = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t$scope.loadOrder();\r\n\t\t\t\t$scope.listen();\r\n\t\t\t}else{\r\n\t\t\t\tTool.comfirm(\"您还没有登录，请先登录\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\t// 跳转到具体的发帖页面\r\n\t\t$scope.goTo = function(path){\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.changeRoute(path);\r\n\t\t\t}else{\r\n\t\t\t\tTool.comfirm(\"您还没有登录，请先登录\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 监听input元素选择图片\r\n\t\t$scope.listen = function(){\r\n\t\t\t$(\"#input1\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input1.has = true;\r\n\t\t\t\t$scope.beforeParams.input1.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input2\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input2.has = true;\r\n\t\t\t\t$scope.beforeParams.input2.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input3\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input3.has = true;\r\n\t\t\t\t$scope.beforeParams.input3.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input4\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input4.has = true;\r\n\t\t\t\t$scope.beforeParams.input4.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input5\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input5.has = true;\r\n\t\t\t\t$scope.beforeParams.input5.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input6\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.beforeParams.input6.has = true;\r\n\t\t\t\t$scope.beforeParams.input6.url = url;\r\n\t\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input7\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.afterParams.input7.has = true;\r\n\t\t\t\t$scope.afterParams.input7.url = url;\r\n\t\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input8\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.afterParams.input8.has = true;\r\n\t\t\t\t$scope.afterParams.input8.url = url;\r\n\t\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input9\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.afterParams.input9.has = true;\r\n\t\t\t\t$scope.afterParams.input9.url = url;\r\n\t\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 获取input元素图片的url，做图片预览\r\n\t\t$scope.getUrl = function(obj){\r\n\t\t\tvar url = null;\r\n\t\t\tif (window.createObjectURL != undefined) { // basic\r\n\t\t\t\turl = window.createObjectURL(obj);\r\n\t\t\t} else if (window.URL != undefined) { // mozilla(firefox)\r\n\t\t\t\turl = window.URL.createObjectURL(obj);\r\n\t\t\t} else if (window.webkitURL != undefined) { // webkit or chrome\r\n\t\t\t\turl = window.webkitURL.createObjectURL(obj);\r\n\t\t\t}\r\n\t\t\treturn url;\r\n\t\t}\r\n\r\n\t\t// 切换发帖类型\r\n\t\t$scope.switch =function(item){\r\n\t\t\tTool.select(item,$scope.switchParams);\r\n\t\t\tif($scope.switchParams[item]){\r\n\t\t\t\t$scope.queryParams.flag = $scope.switchParams[item].val;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 调整随便聊聊照片参数\r\n\t\t$scope.mergeSay = function(){\r\n\t\t\tvar imgStr = \"img\";\r\n\t\t\tvar pStr = \"p\";\r\n\t\t\tvar count = 1;\r\n\t\t\tvar afterCount = 3;\r\n\t\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\t\tfor(var index in $scope.beforeParams){\r\n\t\t\t\tvar prototype = $scope.beforeParams[index];\r\n\t\t\t\tif(prototype.has){\r\n\t\t\t\t\tif(count<4){\r\n\t\t\t\t\t\t$scope.postData.append(imgStr+count,$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(count;count<7;count++){\r\n\t\t\t\tif(count<4){\r\n\t\t\t\t\t$scope.postData.append(imgStr+count,file);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),file);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$scope.postData.append(\"postName\",$scope.queryParams.postName);\r\n\t\t\t$scope.postData.append(\"postContent\",$scope.queryParams.postContent);\r\n\t\t\t$scope.postData.append(\"flag\",$scope.queryParams.flag);\r\n\t\t\t$scope.postData.append(\"postFlags\",2);\r\n\t\t}\r\n\r\n\t\t// 调整写日记参数\r\n\t\t$scope.mergeNote = function(){\r\n\t\t\tvar imgStr = \"img\";\r\n\t\t\tvar beforeCount = 1 ;\r\n\t\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\t\tfor(var index in $scope.beforeParams){\r\n\t\t\t\tvar prototypeB = $scope.beforeParams[index];\r\n\t\t\t\tif(prototypeB.has){\r\n\t\t\t\t\t$scope.postData.append(imgStr+beforeCount,$(prototypeB.val).get(0).files[0]);\r\n\t\t\t\t\tbeforeCount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(beforeCount<4){\r\n\t\t\t\tfor(;beforeCount<4;beforeCount++){\r\n\t\t\t\t\t$scope.postData.append(imgStr+beforeCount,file);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar pStr = \"p\";\r\n\t\t\tvar afterCount = 1;\r\n\t\t\tfor(var index in $scope.afterParams){\r\n\t\t\t\tvar prototypeA = $scope.afterParams[index];\r\n\t\t\t\tif(prototypeA.has){\r\n\t\t\t\t\t$scope.postData.append(pStr+afterCount,$(prototypeA.val).get(0).files[0]);\r\n\t\t\t\t\tafterCount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(afterCount<4){\r\n\t\t\t\tfor(;afterCount<4;afterCount++){\r\n\t\t\t\t\t$scope.postData.append(pStr+afterCount,file);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$scope.postData.append(\"postName\",$scope.queryParams.postName);\r\n\t\t\t$scope.postData.append(\"postContent\",$scope.queryParams.postContent);\r\n\t\t\t$scope.postData.append(\"flag\",$scope.queryParams.flag);\r\n\t\t\t$scope.postData.append(\"productId\",$scope.queryParams.productId);\r\n\t\t\t$scope.postData.append(\"doctorId\",$scope.queryParams.doctorId);\r\n\t\t\t$scope.postData.append(\"hospitalId\",$scope.queryParams.hospitalId);\r\n\t\t\t$scope.postData.append(\"postFlags\",1);\r\n\t\t}\r\n\r\n\t\t// 发帖功能\r\n\t\t$scope.addPost = function(merge){\r\n\t\t\tif($scope.queryParams.postName==\"\"||$scope.queryParams.postName==null||$scope.queryParams.postContent==\"\"||$scope.queryParams.postContent==null){\r\n\t\t\t\tTool.alert(\"请填写发帖内容!\");\r\n\t\t\t}else{\r\n\t\t\t\tvar url = Tool.host+\"/wx/post/addPost\";\r\n\t\t\t\tmerge();\r\n\t\t\t\t$rootScope.loading = true;\r\n\t\t\t\t$http.post(url,$scope.postData,{\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\"Content-Type\":undefined,\r\n\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).success(function(data){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.changeRoute(\"/interaction\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(\"连接失败，请稍后再试!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}).error(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t$scope.postData = new FormData();\r\n\t\t\t\t\tTool.alert(\"连接失败，请稍后再试!\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 发布随便说说帖子\r\n\t\t$scope.addSayPost = function(){\r\n\t\t\t$scope.addPost($scope.mergeSay);\r\n\t\t}\r\n\r\n\t\t// 发布写日记\r\n\t\t$scope.addNotePost = function(){\r\n\t\t\tif(!$scope.select.has){\r\n\t\t\t\tif($scope.queryParams.productId==null||$scope.queryParams.hospitalId==null||$scope.queryParams.doctorId==null){\r\n\t\t\t\t\tTool.alert(\"请选择项目信息\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.addPost($scope.mergeNote);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"您还没有已完成的项目，暂不能写日记\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 触发随便说说选择照片\r\n\t\t$scope.chooseSayPic = function(){\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(var item in $scope.beforeParams){\r\n\t\t\t\tvar prototype = $scope.beforeParams[item];\r\n\t\t\t\tcount++;\r\n\t\t\t\tif(!prototype.has){\r\n\t\t\t\t\t$(prototype.val).click();\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(count==6){\r\n\t\t\t\tTool.alert(\"最多只能上传6张图片!\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 触发写日记选择术前照片\r\n\t\t$scope.chooseBeforePic = function(){\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(var item in $scope.beforeParams){\r\n\t\t\t\tcount++;\r\n\t\t\t\tif(count<4){\r\n\t\t\t\t\tvar prototype = $scope.beforeParams[item];\r\n\t\t\t\t\tif(!prototype.has){\r\n\t\t\t\t\t\t$(prototype.val).click();\r\n\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"术后最多上传三张照片\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 触发写日记选择术后照片\r\n\t\t$scope.chooseAfterPic = function(){\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(var item in $scope.afterParams){\r\n\t\t\t\tcount++;\r\n\t\t\t\tvar prototype = $scope.afterParams[item];\r\n\t\t\t\tif(!prototype.has){\r\n\t\t\t\t\t$(prototype.val).click();\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(count==3){\r\n\t\t\t\tTool.alert(\"术后最多上传三张照片\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 删除术前图片\r\n\t\t$scope.removeBefore = function(item){\r\n\t\t\tif($scope.beforeParams[item]){\r\n\t\t\t\t$scope.beforeParams[item].has=false;\r\n\t\t\t\t$scope.beforeParams[item].url=\"\";\r\n\t\t\t\t$scope.clear(item);\r\n\t\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 删除术后图片\r\n\t\t$scope.removeAfter = function(item){\r\n\t\t\tif($scope.afterParams[item]){\r\n\t\t\t\t$scope.afterParams[item].has=false;\r\n\t\t\t\t$scope.afterParams[item].url=\"\";\r\n\t\t\t\t$scope.clear(item);\r\n\t\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 重新替换要重新选择图片的input元素\r\n\t\t$scope.clear = function(selector){\r\n\t\t\tvar element = document.getElementById(selector);\r\n\t\t\telement.outerHTML = element.outerHTML; //重新替换Input元素\r\n\t\t}\r\n\r\n\t\t// 发帖页面加载用户已完成订单信息\r\n\t\t$scope.loadOrder = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/queryOrderList\",\r\n\t\t\t\tparams:{status:\"\",userId:Tool.userInfo.id},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\taccessToken:Tool.userInfo.accessToken\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code===0){\r\n\t\t\t\t\tvar result = data.data.filter(function(item){\r\n\t\t\t\t\t\treturn item.status==4;\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif(result.length>0){\r\n\t\t\t\t\t\t$scope.order.has = true;\r\n\t\t\t\t\t\t$scope.order.orderInfo = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var index in $scope.order.orderInfo){\r\n\t\t\t\t\t\t$scope.order.orderInfo[index].has = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"加载订单信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 触发项目选择\r\n\t\t$scope.chooseOrder = function(){\r\n\t\t\tif($scope.order.has){\r\n\t\t\t\t$scope.select.has = !$scope.select.has;\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"您还没有已完成的项目，暂不能写日记\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 选择项目\r\n\t\t$scope.chooseProduct = function(id){\r\n\t\t\t//先清理掉以选择的项\r\n\t\t\tfor(var prototype in $scope.order.orderInfo){\r\n\t\t\t\tif($scope.order.orderInfo[prototype].has){\r\n\t\t\t\t\t$scope.order.orderInfo[prototype].has = false;\r\n\t\t\t\t\t$scope.queryParams.productId = null;\r\n\t\t\t\t\t$scope.queryParams.doctorId = null;\r\n\t\t\t\t\t$scope.queryParams.hospitalId = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//再选择要选择的项\r\n\t\t\tfor(var prototype in $scope.order.orderInfo){\r\n\t\t\t\tif($scope.order.orderInfo[prototype].id==id){\r\n\t\t\t\t\t$scope.order.orderInfo[prototype].has = true;\r\n\t\t\t\t\t$scope.select.value = $scope.order.orderInfo[prototype].productName;\r\n\t\t\t\t\t$scope.select.has = false;\r\n\t\t\t\t\t$scope.queryParams.productId = $scope.order.orderInfo[prototype].productId;\r\n\t\t\t\t\t$scope.queryParams.doctorId = $scope.order.orderInfo[prototype].doctorId;\r\n\t\t\t\t\t$scope.queryParams.hospitalId = $scope.order.orderInfo[prototype].hospitalId;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}