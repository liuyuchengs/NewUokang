{"version":3,"sources":["productDetail.js"],"names":["define","$scope","$rootScope","$location","$http","Tool","Ajax","selectTime","hasDoctor","noSelectTime","hasDocSchedule","loading","selectDoc","hosId","proId","hasDiscount","productInfo","hospitalInfo","doctorInfo","activityp","follow","hasFollow","followText","productImg","url","hospitalImg","scheduleInfo","scheduleParams","order","hospitalId","doctorId","productId","scheduleId","doctorName","treatmentTime","hospitalName","hospitalAddress","preferPrice","productName","flag","dealMoney","payMoney","realMoney","giftMoney","code","discountid","init","hasBgColor","noWindowListen","loadQueryParams","queryProduct","queryProductImg","queryHospitalImg","queryDoctor","queryHospital","search","back","window","history","obj","checkLogin","loadUserinfo","accessToken","userInfo","post","host","params","then","data","focusState","mergeProdcut","title","preferPriceType","alert","type","mainId","length","mergeImg","id","logo","name","address","list","forEach","item","face","score","selectTimeValue","hasSelecTimeValue","queryDoctorSchedule","docId","mergeSchedule","chooseSchedule","chooseTime","scheId","date","select","mergeDocSelect","orderDetail","isUserInfoComplete","headers","parseFloat","setSession","changeRoute","comfirm","hasTip","items","priceunit","pricetype","smallImg","money","Itemindex","Timeindex","timeList","time","scheduleid","has","value","switchFollow","cacelFollow","tofollow","userId"],"mappings":"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","file":"productDetail.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,$http,Tool,Ajax){\r\n\t\t$scope.selectTime = false;\r\n\t\t$scope.hasDoctor = false;\r\n\t\t$scope.noSelectTime = true;\r\n\t\t$scope.hasDocSchedule = \"\";\r\n\t\t$scope.loading = false;\r\n\t\t$scope.selectDoc =\"\";\r\n\t\t$scope.hosId;\r\n\t\t$scope.proId;\r\n\t\t$scope.hasDiscount=false;\r\n\t\t$scope.productInfo;\r\n\t\t$scope.hospitalInfo;\r\n\t\t$scope.doctorInfo = [];\r\n\t\t$scope.activityp = \"\";\r\n\t\t$scope.follow = {\r\n\t\t\thasFollow:false,\r\n\t\t\tfollowText:\"关注\"\r\n\t\t}\r\n\t\t$scope.productImg = [\r\n\t\t\t{\r\n\t\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t\t},{\r\n\t\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t\t}];\r\n\t\t$scope.hospitalImg = [\r\n\t\t\t{\r\n\t\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t\t}];\r\n\t\t$scope.scheduleInfo = [];\r\n\t\t$scope.scheduleParams = {};\r\n\t\t$scope.order = {\r\n\t\t\thospitalId:\"\",\r\n\t\t\tdoctorId:\"\",\r\n\t\t\tproductId:\"\",\r\n\t\t\tscheduleId:\"\",\r\n\t\t\tdoctorName:\"\",\r\n\t\t\ttreatmentTime:\"\",\r\n\t\t\thospitalName:\"\",\r\n\t\t\thospitalAddress:\"\",\r\n\t\t\tpreferPrice:\"\",\r\n\t\t\tproductName:\"\",\r\n\t\t\tflag:null,\r\n\t\t\tdealMoney:\"\",\r\n\t\t\tpayMoney:\"\",\r\n\t\t\trealMoney:\"\",\r\n\t\t\tgiftMoney:\"\",\r\n\t\t\tcode:null,\r\n\t\t\tdiscountid:null,\r\n\t\t}\r\n\r\n\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.loadQueryParams();\r\n\t\t\t$scope.order.hospitalId = $scope.hosId;\r\n\t\t\t$scope.order.productId = $scope.proId;\r\n\t\t\t$scope.queryProduct();\r\n\t\t\t$scope.queryProductImg();\r\n\t\t\t$scope.queryHospitalImg();\r\n\t\t\t$scope.queryDoctor();\r\n\t\t\t$scope.queryHospital();\r\n\t\t}\r\n\r\n\t\t// 加载url参数\r\n\t\t$scope.loadQueryParams = function(){\r\n\t\t\t$scope.hosId = $location.search().hospitalId;\r\n\t\t\t$scope.proId = $location.search().productId;\r\n\t\t\tif($location.search().flag){\r\n\t\t\t\t$scope.order.flag = $location.search().flag;\r\n\t\t\t}\r\n\t\t\tif($location.search().discountid){\r\n\t\t\t\t$scope.order.discountid = $location.search().discountid;\r\n\t\t\t\t$scope.hasDiscount = true;\r\n\t\t\t}\r\n\t\t\tif($location.search().code){\r\n\t\t\t\t$scope.order.code = $location.search().code;\r\n\t\t\t}\r\n\t\t\tif($location.search().activityp){\r\n\t\t\t\t$scope.activityp = $location.search().activityp;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 返回上一页\r\n\t\t$scope.back = function(){\r\n\t\t\twindow.history.back();\r\n\t\t}\r\n\r\n\t\t// 查询项目信息\r\n\t\t$scope.queryProduct = function(){\r\n\t\t\tvar obj = {\r\n\t\t\t\tproductId:$scope.proId\r\n\t\t\t}\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tobj.accessToken = Tool.userInfo.accessToken;\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/product/querybyid\",\r\n\t\t\t\tparams:obj\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.data.focusState===1){\r\n\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t}\r\n\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t$scope.productInfo = data.data;\r\n\t\t\t\t$scope.order.productName = $scope.productInfo.title;\r\n\t\t\t\t$scope.order.preferPrice = \"￥\"+$scope.productInfo.preferPrice+$scope.productInfo.preferPriceType;\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"获取项目详细信息错误，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 查询项目图片\r\n\t\t$scope.queryProductImg = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/image/querybymainid\",\r\n\t\t\t\tparams:{type:\"PRODUCT\",mainId:$scope.proId}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.length>0){\r\n\t\t\t\t\t$scope.mergeImg(data);\r\n\t\t\t\t\t$scope.productImg = data;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 加载医院信息\r\n\t\t$scope.queryHospital = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/hospital/querybyid\",\r\n\t\t\t\tparams:{id:$scope.hosId}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\t$scope.hospitalInfo = data;\r\n\t\t\t\tif($scope.hospitalInfo.logo==\"\"||$scope.hospitalInfo.logo==null){\r\n\t\t\t\t\t$scope.hospitalInfo.logo = \"../../contents/img/p_default.png\";\r\n\t\t\t\t}\r\n\t\t\t\t$scope.order.hospitalName = data.name;\r\n\t\t\t\t$scope.order.hospitalAddress = data.address;\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"医院信息加载失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 查询医院图片\r\n\t\t$scope.queryHospitalImg = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/image/querybymainid\",\r\n\t\t\t\tparams:{\r\n\t\t\t\t\ttype:\"HOSPITAL\",\r\n\t\t\t\t\tmainId:$scope.hosId\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.length>0){\r\n\t\t\t\t\t$scope.mergeImg(data);\r\n\t\t\t\t\t$scope.hospitalImg = data;\r\n\t\t\t\t}\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 查询医生信息\r\n\t\t$scope.queryDoctor = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/doctor/queryscheduledoctorbyproductid\",\r\n\t\t\t\tparams:{productId:$scope.proId}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.list.length>0){\r\n\t\t\t\t\t$scope.hasDoctor = true;\r\n\t\t\t\t\t$scope.doctorInfo = data.list;\r\n\t\t\t\t\t$scope.doctorInfo.forEach(function(item){\r\n\t\t\t\t\t\tif(item.face==\"\"||item.face==null){\r\n\t\t\t\t\t\t\titem.face=\"../../contents/img/p_default.png\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(item.score==\"\"||item.score==null){\r\n\t\t\t\t\t\t\titem.score = \"暂无评\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem.selectTimeValue = \"请选择\";\r\n\t\t\t\t\t\titem.hasSelecTimeValue = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"医生数据加载失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 查询医生排班信息\r\n\t\t$scope.queryDoctorSchedule = function(docId){\r\n\t\t\tif($scope.hasDocSchedule==docId){\r\n\t\t\t\t$scope.selectTime = true;\r\n\t\t\t}else{\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/schedule/querybydoctorid\",\r\n\t\t\t\t\tparams:{doctorId:docId}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t$scope.mergeSchedule(data);\r\n\t\t\t\t\t$scope.scheduleInfo = data;\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t$scope.selectTime = true;\r\n\t\t\t\t\t$scope.hasDocSchedule = docId;\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"医生排班信息加载失败!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 选择就医时间按钮\r\n\t\t$scope.chooseSchedule = function(docId,name){\r\n\t\t\t$scope.order.doctorId = docId;\r\n\t\t\t$scope.order.doctorName = name;\r\n\t\t\t$scope.queryDoctorSchedule(docId);\r\n\t\t\t$scope.selectDoc = docId;\r\n\t\t}\r\n\r\n\t\t// 选择具体的就医时间\r\n\t\t$scope.chooseTime = function(scheId,date){\r\n\t\t\tTool.select(scheId,$scope.scheduleParams);\r\n\t\t\t$scope.order.scheduleId = scheId;\r\n\t\t\t$scope.order.treatmentTime = date;\r\n\t\t\t$scope.mergeDocSelect($scope.selectDoc,date);\r\n\t\t\t$scope.selectTime = false;\r\n\t\t\t$scope.noSelectTime = false;\r\n\t\t}\r\n\r\n\t\t// 下单按钮时间\r\n\t\t$scope.orderDetail = function(){\r\n\t\t\tif(!$scope.noSelectTime){\r\n\t\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\t\tTool.comfirm(\"请先登录并完善个人信息\",function(){\r\n\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}else if(!Tool.isUserInfoComplete()){\r\n\t\t\t\t\tTool.comfirm(\"请完善个人信息!\",function(){\r\n\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\tTool.changeRoute(\"/user/userinfo\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\tproductId:$scope.order.productId\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif($scope.order.code){\r\n\t\t\t\t\t\tparams.code = $scope.order.code;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif($scope.order.discountid){\r\n\t\t\t\t\t\tparams.discountid = $scope.order.discountid;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tAjax.post({\r\n\t\t\t\t\t\turl:Tool.host +\"/wx/order/checkCodeMoney\",\r\n\t\t\t\t\t\tparams:params,\r\n\t\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t\t$scope.order.dealMoney = data.dealMoney;\r\n\t\t\t\t\t\t$scope.order.payMoney = data.payMoney;\r\n\t\t\t\t\t\t$scope.order.realMoney = data.realMoney;\r\n\t\t\t\t\t\t$scope.order.giftMoney = data.giftMoney;\r\n\t\t\t\t\t\tif(parseFloat($scope.order.giftMoney)<=0&&$scope.order.flag!=11){\r\n\t\t\t\t\t\t\t$scope.order.flag = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tTool.setSession(\"makeorder\",$scope.order);\r\n\t\t\t\t\t\tTool.changeRoute(\"/makeorder\")\r\n\t\t\t\t\t}).catch(function(){\r\n\t\t\t\t\t\tTool.alert(\"加载App付款金额失败!\");\r\n\t\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 图片为空时，设置默认图片,onerror无法处理src为空\r\n\t\t$scope.mergeImg = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tif(item.url==\"\"||item.url==null){\r\n\t\t\t\t\titem.url = \"../../contents/img/p_default.png\";\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 修改项目信息\r\n\t\t$scope.mergeProdcut = function(data){\r\n\t\t\tif(data.priceunit!=null&&data.priceunit!=\"\"){\r\n\t\t\t\tdata.preferPriceType = data.pricetype+\"/\"+data.priceunit;\r\n\t\t\t}else{\r\n\t\t\t\tdata.preferPriceType = data.pricetype;\r\n\t\t\t}\r\n\t\t\tif(data.smallImg==\"\"||data.smallImg==null){\r\n\t\t\t\tdata.smallImg = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t\tif($location.search().money){\r\n\t\t\t\tdata.preferPrice = $location.search().money;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 截取排班参数\r\n\t\t$scope.mergeSchedule = function(items){\r\n\t\t\tfor(var Itemindex in items){\r\n\t\t\t\tvar item = items[Itemindex];\r\n\t\t\t\tfor(var Timeindex in item.timeList){\r\n\t\t\t\t\tvar time = item.timeList[Timeindex];\r\n\t\t\t\t\tif(Itemindex==0&&Timeindex==0){\r\n\t\t\t\t\t\t$scope.scheduleParams[time.scheduleid] = {\r\n\t\t\t\t\t\t\thas:true,\r\n\t\t\t\t\t\t\tvalue:time.date,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.scheduleParams[time.scheduleid] = {\r\n\t\t\t\t\t\t\thas:false,\r\n\t\t\t\t\t\t\tvalue:time.date,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 改变就医时间的选取值\r\n\t\t$scope.mergeDocSelect = function(docId,value){\r\n\t\t\t$scope.doctorInfo.forEach(function(item){\r\n\t\t\t\tif(item.id==docId){\r\n\t\t\t\t\titem.selectTimeValue = value;\r\n\t\t\t\t\titem.hasSelecTimeValue = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.selectTimeValue = \"请选择\";\r\n\t\t\t\t\titem.hasSelecTimeValue = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 关注按钮处理函数\r\n\t\t$scope.switchFollow = function(){\r\n\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\tTool.comfirm(\"请先登录!\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tif($scope.follow.hasFollow){\r\n\t\t\t\t\t$scope.cacelFollow();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.tofollow();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 关注项目\r\n\t\t$scope.tofollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/focus\",\r\n\t\t\t\tparams:{flag:3,userId:$scope.proId},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 取消关注项目\r\n\t\t$scope.cacelFollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/cacelFocus\",\r\n\t\t\t\tparams:{flag:3,userId:$scope.proId},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = false;\r\n\t\t\t\t\t$scope.follow.followText = \"关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"取消关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}