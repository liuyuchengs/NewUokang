{"version":3,"sources":["interaction.js"],"names":["define","$scope","$rootScope","$http","Tool","Ajax","noProductText","noProduct","hasInteractionMenu","queryParams","flag","pageRows","currentPage","navParams","kanya","has","val","shumei","yunsheng","posts","init","hasBgColor","queryPost","initSwiper","post","url","host","params","then","data","length","mergePost","concat","alert","loading","items","forEach","item","visitNum","commentNum","faceImage","index","list2","splice","loadNext","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","switchNav","select","detail","id","changeRoute"],"mappings":"AAAAA,OAAO,WACH,MAAO,UAASC,OAAOC,WAAWC,MAAMC,KAAKC,MACzCJ,OAAOK,cAAgB,GACvBL,OAAOM,WAAY,EACnBN,OAAOO,oBAAqB,EAC5BP,OAAOQ,aACHC,KAAK,EACLC,SAAS,GACTC,YAAY,GAEhBX,OAAOY,WACHC,OAAOC,KAAI,EAAKC,IAAI,GACpBC,QAAQF,KAAI,EAAMC,IAAI,GACtBE,UAAUH,KAAI,EAAMC,IAAI,IAG5Bf,OAAOkB,SAGPlB,OAAOmB,KAAO,WACVlB,WAAWmB,YAAa,EACxBpB,OAAOqB,YACPrB,OAAOsB,cAMXtB,OAAOqB,UAAY,WACfjB,KAAKmB,MACDC,IAAIrB,KAAKsB,KAAK,oBACdC,OAAO1B,OAAOQ,cACfmB,KAAK,SAASC,MACVA,KAAKA,KAAKC,OAAO,GACb7B,OAAOkB,MAAMW,OAAO,EACnB7B,OAAOK,cAAgB,UAEvBL,OAAOK,cAAgB,WAE3BL,OAAOM,WAAY,IAEnBN,OAAO8B,UAAUF,KAAKA,MACtB5B,OAAOkB,MAAQlB,OAAOkB,MAAMa,OAAOH,KAAKA,SAbhDxB,SAeS,WACLD,KAAK6B,MAAM,eAhBf5B,WAiBW,WACPH,WAAWgC,SAAU,KAK7BjC,OAAO8B,UAAY,SAASI,OACxBA,MAAMC,QAAQ,SAASC,MACD,MAAfA,KAAKC,UAA+B,IAAfD,KAAKC,WACzBD,KAAKC,SAAS,GAEE,IAAjBD,KAAKE,YAAiC,MAAjBF,KAAKE,aACzBF,KAAKE,WAAa,GAEtBF,KAAKG,UAAa,0BAA0BH,KAAKG,SACjD,KAAI,GAAIC,SAASJ,MAAKK,MACI,IAAnBL,KAAKK,MAAMD,QAA+B,MAAnBJ,KAAKK,MAAMD,QACjCJ,KAAKK,MAAMC,OAAOF,MAAM,MAOxCxC,OAAO2C,SAAW,WACd3C,OAAOQ,YAAYG,cACnBX,OAAOqB,aAIXuB,OAAOC,SAAW,WACd,IAAG5C,WAAWgC,UAASjC,OAAOM,UAA9B,CAGA,GAAIwC,MAAOC,SAASD,KAChBE,KAAOD,SAASE,gBAChBC,OAASC,KAAKC,IAAKN,KAAKO,aAAcP,KAAKQ,aAAaN,KAAKO,aAAcP,KAAKK,aAAcL,KAAKM,aACpGJ,QAAON,OAAOY,aACTN,OAASN,OAAOa,QAAUb,OAAOY,YAAc,KAC/CxD,OAAO2C,aAMnB3C,OAAO0D,UAAY,SAAStB,MACxBpC,OAAOQ,YAAYC,KAAOT,OAAOY,UAAUwB,MAAMrB,IACjDZ,KAAKwD,OAAOvB,KAAKpC,OAAOY,WACxBZ,OAAOQ,YAAYG,YAAc,EACjCX,OAAOM,WAAY,EACnBN,OAAOK,cAAgB,GACvBL,OAAOkB,SACPlB,OAAOqB,aAIXrB,OAAO4D,OAAS,SAASC,IACrB1D,KAAK2D,YAAY,sBAAsB,MAAMD","file":"interaction.js","sourcesContent":["define(function(){\r\n    return function($scope,$rootScope,$http,Tool,Ajax){\r\n        $scope.noProductText = \"\";\r\n        $scope.noProduct = false;\r\n        $scope.hasInteractionMenu = true;\r\n        $scope.queryParams = {\r\n            flag:1,\r\n            pageRows:10,\r\n            currentPage:1\r\n        }\r\n        $scope.navParams = {\r\n            kanya:{has:true,val:1},\r\n            shumei:{has:false,val:2},\r\n            yunsheng:{has:false,val:3}\r\n        }\r\n        \r\n        $scope.posts = [];\r\n\r\n        //初始化页面\r\n        $scope.init = function(){\r\n            $rootScope.hasBgColor = false;\r\n            $scope.queryPost();\r\n            $scope.initSwiper();\r\n        }\r\n\r\n\r\n\r\n        // 加载帖子数据\r\n        $scope.queryPost = function(){\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/post/postList\",\r\n                params:$scope.queryParams,\r\n            }).then(function(data){\r\n                if(data.data.length<1){\r\n                    if($scope.posts.length<1){\r\n                        $scope.noProductText = \"还没有帖子信息\";\r\n                    }else{\r\n                        $scope.noProductText = \"已经没有项目了!\";\r\n                    }\r\n                    $scope.noProduct = true;\r\n                }else{\r\n                    $scope.mergePost(data.data);\r\n                    $scope.posts = $scope.posts.concat(data.data);\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"获取帖子信息失败!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        // 处理帖子数据\r\n        $scope.mergePost = function(items){\r\n            items.forEach(function(item){\r\n                if(item.visitNum==null||item.visitNum==\"\"){\r\n                    item.visitNum=0;\r\n                }\r\n                if(item.commentNum==\"\"||item.commentNum==null){\r\n                    item.commentNum = 0;\r\n                }\r\n                item.faceImage = (\"https://biz.uokang.com/\"+item.faceImage);\r\n                for(var index in item.list2){\r\n                    if(item.list2[index]==\"\"||item.list2[index]==null){\r\n                        item.list2.splice(index,1);\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        // 加载下一页数据\r\n        $scope.loadNext = function(){\r\n            $scope.queryParams.currentPage++;\r\n            $scope.queryPost();\r\n        }\r\n\r\n        // 滚动监听\r\n        window.onscroll = function(){\r\n            if($rootScope.loading||$scope.noProduct){\r\n                return;\r\n            }\r\n            var body = document.body;\r\n            var html = document.documentElement;\r\n            var height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n            if(height>window.innerHeight){\r\n                if (height - window.scrollY - window.innerHeight < 100) {\r\n                    $scope.loadNext();\r\n                }\r\n            }\r\n        }\r\n\r\n        // 切换帖子类型\r\n        $scope.switchNav = function(item){\r\n            $scope.queryParams.flag = $scope.navParams[item].val;\r\n            Tool.select(item,$scope.navParams);\r\n            $scope.queryParams.currentPage = 1;\r\n            $scope.noProduct = false;\r\n            $scope.noProductText = \"\";\r\n            $scope.posts = [];\r\n            $scope.queryPost();\r\n        }\r\n\r\n        // 跳转到详细页面\r\n        $scope.detail = function(id){\r\n            Tool.changeRoute(\"/interaction/detail\",\"id=\"+id);\r\n        }\r\n    }\r\n})"],"sourceRoot":"/source/"}