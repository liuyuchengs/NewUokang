{"version":3,"sources":["myFollow.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","params","doctor","user","product","queryParams","pageRows","currentPage","flag","follows","noProduct","noProductText","init","hasBgColor","checkLogin","loadUserinfo","getQuery","changeRoute","search","item","proto","clearData","setNext","queryUser","queryDoctor","queryProduct","post","url","host","headers","accessToken","userInfo","then","data","code","length","forEach","hasFollow","followText","concat","alert","loading","switchFollow","id","selectFollow","follow","cacelFollow","tofollow","comfirm","userId","fn","loadNext","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY"],"mappings":"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","file":"myFollow.js","sourcesContent":["define(function(){\r\n    return function($scope,$rootScope,$location,Tool,Ajax){\r\n        //导航条变量\r\n        $scope.params = {\r\n            doctor:false,\r\n            user:true,\r\n            product:false\r\n        }\r\n\r\n        $scope.queryParams = {\r\n            pageRows:10,\r\n            currentPage:1,\r\n            flag:1,\r\n        }\r\n\r\n        $scope.follows = [];\r\n        $scope.noProduct = false;\r\n        $scope.noProductText = \"\";\r\n\r\n        //页面初始化\r\n        $scope.init = function(){\r\n            $rootScope.hasBgColor = false;\r\n            if(Tool.checkLogin()){\r\n                Tool.loadUserinfo();\r\n                $scope.getQuery();\r\n            }else{\r\n                Tool.changeRoute(\"/user\");\r\n            }\r\n        }\r\n\r\n        //获取查询参数\r\n        $scope.getQuery = function(){\r\n            if($location.search().item){\r\n                $scope.switch($location.search().item);\r\n            }else{\r\n                Tool.changeRoute(\"/user\");\r\n            }\r\n        }\r\n\r\n        //切换导航条\r\n        $scope.switch = function(item){\r\n            for(var proto in $scope.params){\r\n                if(proto==item){\r\n                    $scope.params[proto] = true;\r\n                }else{\r\n                    $scope.params[proto] = false;\r\n                }\r\n            }\r\n            $scope.clearData();\r\n            if(item===\"user\"){\r\n                $scope.setNext($scope.queryUser);\r\n                $scope.queryUser();\r\n            }\r\n            if(item===\"doctor\"){\r\n                $scope.setNext($scope.queryDoctor);\r\n                $scope.queryDoctor();\r\n            }\r\n            if(item===\"product\"){\r\n                $scope.setNext($scope.queryProduct);\r\n                $scope.queryProduct();\r\n            }\r\n        }\r\n\r\n        //清空数据\r\n        $scope.clearData = function(){\r\n            $scope.follows = [];\r\n            $scope.noProduct = false;\r\n            $scope.noProductText = \"\";\r\n            $scope.queryParams.currentPage = 1;\r\n        }\r\n\r\n        //查询关注的用户\r\n        $scope.queryUser = function(){\r\n            $scope.queryParams.flag = 1;\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/focus/focusUserMan\",\r\n                params:$scope.queryParams,\r\n                headers:{\r\n                    'accessToken':Tool.userInfo.accessToken,\r\n                }\r\n            }).then(function(data){\r\n                if(data.code===0){\r\n                    if(data.data.length<1){\r\n                        if($scope.follows.length<1){\r\n                            $scope.noProductText = \"您还没有关注其他人!\";\r\n                        }else{\r\n                            $scope.noProductText = \"已经没有了!\";\r\n                        }\r\n                        $scope.noProduct = true;\r\n                    }else{\r\n                        data.data.forEach(function(item){\r\n                            item.hasFollow = true;\r\n                            item.followText = \"已关注\";\r\n                        });\r\n                        $scope.follows = $scope.follows.concat(data.data);\r\n                    }\r\n                }else{\r\n                    Tool.alert(\"数据连接失败，请稍后再试!\");\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"数据连接失败，请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading =false;\r\n            })\r\n        }\r\n\r\n        //查询关注的医生\r\n        $scope.queryDoctor = function(){\r\n            $scope.queryParams.flag = 2;\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/focus/focusDoctorMan\",\r\n                params:$scope.queryParams,\r\n                headers:{\r\n                    'accessToken':Tool.userInfo.accessToken,\r\n                }\r\n            }).then(function(data){\r\n                if(data.code===0){\r\n                    if(data.data.length<1){\r\n                        if($scope.follows.length<1){\r\n                            $scope.noProductText = \"您还没有关注医生!\";\r\n                        }else{\r\n                            $scope.noProductText = \"已经没有了!\";\r\n                        }\r\n                        $scope.noProduct = true;\r\n                    }else{\r\n                        data.data.forEach(function(item){\r\n                            item.hasFollow = true;\r\n                            item.followText = \"已关注\";\r\n                        })\r\n                        $scope.follows = $scope.follows.concat(data.data);\r\n                    }\r\n                }else{\r\n                    Tool.alert(\"数据连接失败，请稍后再试!\");\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"连接数据失败,请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        //查询关注的项目\r\n        $scope.queryProduct = function(){\r\n            $scope.queryParams.flag = 3;\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/focus/focusProductMan\",\r\n                params:$scope.queryParams,\r\n                headers:{\r\n                    'accessToken':Tool.userInfo.accessToken,\r\n                }\r\n            }).then(function(data){\r\n                if(data.code===0){\r\n                    if(data.data.length<1){\r\n                        if($scope.follows.length<1){\r\n                            $scope.noProductText = \"您还没有关注项目!\";\r\n                        }else{\r\n                            $scope.noProductText = \"已经没有了!\";\r\n                        }\r\n                        $scope.noProduct = true;\r\n                    }else{\r\n                        data.data.forEach(function(item){\r\n                            item.hasFollow = true;\r\n                            item.followText = \"已关注\";\r\n                        });\r\n                        $scope.follows = $scope.follows.concat(data.data);\r\n                    }\r\n                }else{\r\n                    Tool.alert(\"数据连接失败，请稍后再试!\");\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"连接数据失败,请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        // 关注按钮处理函数\r\n        $scope.switchFollow = function(id,flag){\r\n            if(Tool.checkLogin()){\r\n                Tool.loadUserinfo();\r\n                if($scope.selectFollow(id)){\r\n                    var follow = $scope.selectFollow(id);\r\n                    if(follow.hasFollow){\r\n                        $scope.cacelFollow(id,flag);\r\n                    }else{\r\n                        $scope.tofollow(id,flag);\r\n                    }\r\n                }\r\n            }else{\r\n                Tool.comfirm(\"请先登录!\",function(){\r\n                    $rootScope.loading = false;\r\n                    Tool.changeRoute(\"/login\");\r\n                })\r\n            }\r\n        }\r\n\r\n        // 关注用户\r\n        $scope.tofollow = function(id,flag){\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/post/focus\",\r\n                params:{flag:flag,userId:id},\r\n                headers:{\r\n                    'accessToken':Tool.userInfo.accessToken,\r\n                }\r\n            }).then(function(data){\r\n                if(data.code==0){\r\n                    if($scope.selectFollow(id)){\r\n                        var follow = $scope.selectFollow(id);\r\n                        follow.hasFollow = true;\r\n                        follow.followText = \"已关注\";\r\n                    }\r\n                }else{\r\n                    Tool.alert(\"关注失败，稍后再试!\");\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"连接数据失败，请稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        // 取消关注用户\r\n        $scope.cacelFollow = function(id,flag){\r\n            Ajax.post({\r\n                url:Tool.host+\"/wx/post/cacelFocus\",\r\n                params:{flag:flag,userId:id},\r\n                headers:{\r\n                    'accessToken':Tool.userInfo.accessToken,\r\n                }\r\n            }).then(function(data){\r\n                if(data.code==0){\r\n                    if($scope.selectFollow(id)){\r\n                        var follow = $scope.selectFollow(id);\r\n                        follow.hasFollow = false;\r\n                        follow.followText = \"关注\";\r\n                    }\r\n                }else{\r\n                    Tool.alert(\"取消关注失败，稍后再试!\");\r\n                }\r\n            }).catch(function(){\r\n                Tool.alert(\"连接数据失败，稍后再试!\");\r\n            }).finally(function(){\r\n                $rootScope.loading = false;\r\n            })\r\n        }\r\n\r\n        //定位具体的关注元素\r\n        $scope.selectFollow = function(id){\r\n            for(var proto in $scope.follows){\r\n                var follow = $scope.follows[proto];\r\n                if(follow.id == id){\r\n                    return follow;\r\n                }\r\n            }\r\n        }\r\n\r\n        //设置加载下一页的方法\r\n        $scope.setNext = function(fn){\r\n            $scope.loadNext = function(){\r\n                $scope.queryParams.currentPage++;\r\n                fn();\r\n            }\r\n        }\r\n\r\n        // 滚动监听\r\n        window.onscroll = function(){\r\n            if($rootScope.loading||$scope.noProduct){\r\n                return;\r\n            }\r\n            var body = document.body;\r\n            var html = document.documentElement;\r\n            var height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n            if(height>window.innerHeight){\r\n                if (height - window.scrollY - window.innerHeight < 100) {\r\n                    $scope.loadNext();\r\n                }\r\n            }\r\n        }\r\n    }\r\n})"],"sourceRoot":"/source/"}