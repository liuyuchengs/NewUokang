{"version":3,"sources":["cush.js"],"names":["define","$scope","$rootScope","Tool","Ajax","cushs","noCush","activeValue","init","hasBgColor","noWindowListen","checkLogin","loadUserinfo","loadCush","changeRoute","post","url","host","params","userId","userInfo","id","headers","accessToken","then","data","code","length","merge","alert","loading","items","forEach","item","index","array","flags","money","used","uesd","active"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,WAAWC,KAAKC,MACtCH,OAAOI,MACPJ,OAAOK,QAAS,EAChBL,OAAOM,YAAY,GAGnBN,OAAOO,KAAO,WACbN,WAAWO,YAAa,EACxBN,KAAKO,iBACFP,KAAKQ,cACPR,KAAKS,eACLX,OAAOY,YAEPV,KAAKW,YAAY,UAKnBb,OAAOY,SAAW,WACjBT,KAAKW,MACJC,IAAIb,KAAKc,KAAK,4BACdC,QAAQC,OAAOhB,KAAKiB,SAASC,IAC7BC,SACCC,YAAcpB,KAAKiB,SAASG,eAE3BC,KAAK,SAASC,MACF,GAAXA,KAAKC,KACc,GAAlBD,KAAKA,KAAKE,OACZ1B,OAAOK,QAAS,GAEhBL,OAAO2B,MAAMH,KAAKA,MAClBxB,OAAOI,MAAQoB,KAAKA,MAGrBtB,KAAK0B,MAAM,mBAfbzB,SAiBS,WACRD,KAAK0B,MAAM,mBAlBZzB,WAmBW,WACVF,WAAW4B,SAAU,KAKvB7B,OAAO2B,MAAQ,SAASG,OACvBA,MAAMC,QAAQ,SAASC,KAAKC,MAAMC,OAC9BF,KAAKG,MAAMH,KAAKI,MAClBJ,KAAKK,MAAO,EAEZL,KAAKM,MAAO,KAMftC,OAAOuC,OAAS,WACe,GAA3BvC,OAAOM,YAAYoB,OACrBvB,KAAKW,MACJC,IAAIb,KAAKc,KAAK,qBACdC,QAAQC,OAAOhB,KAAKiB,SAASC,GAAGK,KAAKzB,OAAOM,aAC5Ce,SACCC,YAAcpB,KAAKiB,SAASG,eAE3BC,KAAK,SAASC,MACF,GAAXA,KAAKC,MACPzB,OAAO2B,MAAMH,KAAKA,MAClBxB,OAAOI,MAAQoB,KAAKA,MAEpBtB,KAAK0B,MAAM,aAXbzB,SAaS,SAASqB,MACjBtB,KAAK0B,MAAM,cAdZzB,WAeW,WACVF,WAAW4B,SAAU,IAGtB3B,KAAK0B,MAAM","file":"cush.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,Tool,Ajax){\r\n\t\t$scope.cushs;\r\n\t\t$scope.noCush = false;\r\n\t\t$scope.activeValue=\"\";\r\n\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t$scope.loadCush();\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载代金券信息\r\n\t\t$scope.loadCush = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/findAllVouchers\",\r\n\t\t\t\tparams:{userId:Tool.userInfo.id},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length==0){\r\n\t\t\t\t\t\t$scope.noCush = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t\t\t$scope.cushs = data.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"数据加载失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"数据加载失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 判断代金券是否有使用\r\n\t\t$scope.merge = function(items){\r\n\t\t\titems.forEach(function(item,index,array){\r\n\t\t\t\tif(item.flags>item.money){\r\n\t\t\t\t\titem.used = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.uesd = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 激活代金券\r\n\t\t$scope.active = function(){\r\n\t\t\tif($scope.activeValue.length==6){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/order/activate\",\r\n\t\t\t\t\tparams:{userId:Tool.userInfo.id,code:$scope.activeValue},\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t'accessToken':Tool.userInfo.accessToken\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t\t\t$scope.cushs = data.data;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(\"代金券不正确!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(data){\r\n\t\t\t\t\tTool.alert(\"代金券激活失败!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"请输入正确长度的代金券!\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}