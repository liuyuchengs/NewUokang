{"version":3,"sources":["myPost.js"],"names":["define","$scope","$rootScope","$location","Ajax","Tool","params","hasPublish","hasReply","queryParams","pageRows","currentPage","item","noProduct","noProductText","posts","replys","user","init","hasBgColor","checkLogin","loadUserinfo","getQuery","changeRoute","p","loadNext","queryPost","queryReply","clearData","search","post","url","host","headers","accessToken","userInfo","then","data","code","length","forEach","dataStr","createDateStr","slice","concat","alert","loading","visitNum","commentNum","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","goPost","id","deletePost","$event","stopPropagation","comfirm","hasTip","postId","deleteObj","deleteReply","postid","repliesId","array","index","splice"],"mappings":"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","file":"myPost.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,Ajax,Tool){\r\n\t\t//导航条参数\r\n\t\t$scope.params = {\r\n\t\t\thasPublish:false,\r\n\t\t\thasReply:false,\r\n\t\t}\r\n\t\t$scope.queryParams = {\r\n\t\t\tpageRows:10,\r\n\t\t\tcurrentPage:1\r\n\t\t}\r\n\t\t$scope.item = \"\";\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.posts = [];\r\n\t\t$scope.replys = [];\r\n\t\t$scope.user = {};\r\n\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = false;\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t$scope.getQuery();\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//切换导航条\r\n\t\t$scope.switch = function(p){\r\n\t\t\tif(p===\"publish\"){\r\n\t\t\t\t$scope.params.hasPublish = true;\r\n\t\t\t\t$scope.posts = [];\r\n\t\t\t\t$scope.replys = [];\r\n\t\t\t\t$scope.queryParams.currentPage =  1;\r\n\t\t\t\t$scope.loadNext =function(){\r\n\t\t\t\t\t$scope.queryParams.currentPage++;\r\n\t\t\t\t\t$scope.queryPost();\r\n\t\t\t\t}\r\n\t\t\t\t$scope.queryPost();\r\n\t\t\t\tif($scope.params.hasReply){\r\n\t\t\t\t\t$scope.params.hasReply = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(p===\"reply\"){  \r\n\t\t\t\t$scope.params.hasReply = true;\r\n\t\t\t\t$scope.posts = [];\r\n\t\t\t\t$scope.replys = [];\r\n\t\t\t\t$scope.queryParams.currentPage =  1;\r\n\t\t\t\t$scope.loadNext =function(){\r\n\t\t\t\t\t$scope.queryParams.currentPage++;\r\n\t\t\t\t\t$scope.queryReply();\r\n\t\t\t\t}\r\n\t\t\t\t$scope.queryReply();\r\n\t\t\t\tif($scope.params.hasPublish){\r\n\t\t\t\t\t$scope.params.hasPublish = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//清空数据\r\n\t\t$scope.clearData = function(){\r\n\t\t\t$scope.posts = [];\r\n\t\t\t$scope.replys = [];\r\n\t\t\t$scope.noProduct = false;\r\n\t\t\t$scope.queryParams.currentPage = 1;\r\n\t\t}\r\n\r\n\t\t//获取查询参数\r\n\t\t$scope.getQuery = function(){\r\n\t\t\tif($location.search().item){\r\n\t\t\t\t$scope.item = $location.search().item;\r\n\t\t\t\t$scope.switch($scope.item);\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/uesr\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 查询我的回复\r\n\t\t$scope.queryReply = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/repliesMessage/myReply\",\r\n\t\t\t\tparams:$scope.queryParams,\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code===0){\r\n\t\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\t\tif($scope.replys.length<1){\r\n\t\t\t\t\t\t\t$scope.noProductText = \"您还没有评论哦!\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$scope.noProductText = \"已经没有评论了!\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdata.data.forEach(function(item){\r\n\t\t\t\t\t\t\titem.dataStr = item.createDateStr.slice(5,10);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t$scope.replys = $scope.replys.concat(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"获取评论信息失败!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"获取帖子信息失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 加载我的帖子数据\r\n\t\t$scope.queryPost = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/myPost\",\r\n\t\t\t\tparams:$scope.queryParams,\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\tif($scope.posts.length<1){\r\n\t\t\t\t\t\t$scope.noProductText = \"您还没有发布帖子!\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.noProductText = \"已经没有了!\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdata.data.forEach(function(item){\r\n\t\t\t\t\t\tif(item.visitNum==null||item.visitNum==\"\"){\r\n\t\t\t\t\t\t\titem.visitNum=0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(item.commentNum==\"\"||item.commentNum==null){\r\n\t\t\t\t\t\t\titem.commentNum = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t$scope.posts = $scope.posts.concat(data.data);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"获取帖子信息失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($rootScope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 跳转到帖子页面\r\n\t\t$scope.goPost = function(id){\r\n\t\t\tTool.changeRoute(\"/interaction/detail\",\"id=\"+id);\r\n\t\t}\r\n\r\n\t\t//删除帖子\r\n\t\t$scope.deletePost = function(id,$event){\r\n\t\t\t$event.stopPropagation();\r\n\t\t\tTool.comfirm(\"确定要删除吗?\",function(){\r\n\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/post/deletePost\",\r\n\t\t\t\t\tparams:{postId:id,accessToken:Tool.userInfo.accessToken},\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.deleteObj(id,$scope.posts);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"删除失败!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t$scope.deleteReply = function(postid,id){\r\n\t\t\tTool.comfirm(\"确定要删除吗?\",function(){\r\n\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/repliesMessage/deleteReplies\",\r\n\t\t\t\t\tparams:{postId:postid,repliesId:id,accessToken:Tool.userInfo.accessToken},\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.switch(\"reply\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"删除失败!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t//从帖子数据中删除指定帖子\r\n\t\t$scope.deleteObj = function(id,array){\r\n\t\t\tfor(var index in array){\r\n\t\t\t\tif(array[index].id==id){\r\n\t\t\t\t\tarray.splice(index,1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})"],"sourceRoot":"/source/"}