{"version":3,"sources":["discount.js"],"names":["define","$scope","$rootScope","Tool","Ajax","itemState","discountSelect","currentPage","productInfo","noProduct","noProductText","loading","init","hasBgColor","loadGift","url","host","post","params","headers","accessToken","then","data","code","length","mergeProdcut","concat","alert","message","items","forEach","item","priceunit","preferPriceType","pricetype","money","preferPrice","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","switchState","detail","proId","hospitalId","query","changeRoute","question"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,WAAWC,KAAKC,MACtCH,OAAOI,UAAY,WACnBJ,OAAOK,gBAAiB,EACxBL,OAAOM,YAAc,EACrBN,OAAOO,eACPP,OAAOQ,WAAY,EACnBR,OAAOS,cAAgB,GACvBT,OAAOU,SAAU,EAGjBV,OAAOW,KAAO,WACbV,WAAWW,YAAa,EACxBZ,OAAOa,YAIRb,OAAOa,SAAW,WACjB,GAAqB,YAAlBb,OAAOI,UACT,GAAIU,KAAMZ,KAAKa,KAAK,4BAEpB,IAAID,KAAMZ,KAAKa,KAAK,qBAErBZ,MAAKa,MACJF,IAAIA,IACJG,QAAQX,YAAYN,OAAOM,aAC3BY,SACCC,YAAY,MAEXC,KAAK,SAASC,MACF,GAAXA,KAAKC,KACJD,KAAKA,KAAKE,OAAO,GAChBvB,OAAOO,YAAYgB,OAAO,EAC5BvB,OAAOS,cAAgB,sBAEvBT,OAAOS,cAAgB,WAExBT,OAAOQ,WAAY,IAEnBR,OAAOwB,aAAaH,KAAKA,MACzBrB,OAAOO,YAAcP,OAAOO,YAAYkB,OAAOJ,KAAKA,OAGrDnB,KAAKwB,MAAML,KAAKM,WApBlBxB,SAsBS,WACRH,OAAOQ,WAAY,EACnBN,KAAKwB,MAAM,qBAxBZvB,WAyBW,WACVF,WAAWS,SAAU,KAKvBV,OAAOwB,aAAe,SAASI,OAC9BA,MAAMC,QAAQ,SAASC,MACH,MAAhBA,KAAKC,WAAiC,IAAhBD,KAAKC,UAC7BD,KAAKE,gBAAkBF,KAAKG,UAAU,IAAIH,KAAKC,UAE/CD,KAAKE,gBAAkBF,KAAKG,UAE1BH,KAAKI,QACPJ,KAAKK,YAAcL,KAAKI,UAM3BE,OAAOC,SAAW,WACjB,IAAGpC,WAAWS,UAASV,OAAOQ,UAA9B,CAGA,GAAI8B,MAAOC,SAASD,KAChBE,KAAOD,SAASE,gBAChBC,OAASC,KAAKC,IAAKN,KAAKO,aAAcP,KAAKQ,aAAaN,KAAKO,aAAcP,KAAKK,aAAcL,KAAKM,aACpGJ,QAAON,OAAOY,aACZN,OAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClDhD,OAAOkD,aAMVlD,OAAOkD,SAAW,WACjBlD,OAAOM,cACPN,OAAOa,YAIRb,OAAOmD,YAAc,SAASrB,MACpB,YAANA,KACC9B,OAAOI,WAAW0B,OACpB9B,OAAOM,YAAc,EACrBN,OAAOK,gBAAiB,EACxBL,OAAOQ,WAAY,EACnBR,OAAOI,UAAY0B,KACnB9B,OAAOO,eACPP,OAAOa,YAGLb,OAAOI,WAAW0B,OACpB9B,OAAOM,YAAc,EACrBN,OAAOK,gBAAiB,EACxBL,OAAOQ,WAAY,EACnBR,OAAOI,UAAY0B,KACnB9B,OAAOO,eACPP,OAAOa,aAMVb,OAAOoD,OAAS,SAASC,MAAMC,WAAWnB,aACzC,GAAIoB,OAAQ,aAAaF,MAAM,eAAeC,UACzB,aAAlBtD,OAAOI,UACTmD,OAAS,YACmB,SAApBvD,OAAOI,YACfmD,OAAS,iCAAiCpB,aAE3CjC,KAAKsD,YAAY,kBAAkBD,QAIpCvD,OAAOyD,SAAW,WACjBvD,KAAKwB,MAAM","file":"discount.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,Tool,Ajax){\r\n\t\t$scope.itemState = \"discount\";\r\n\t\t$scope.discountSelect = true;\r\n\t\t$scope.currentPage = 1;\r\n\t\t$scope.productInfo = [];\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.loading = false;\r\n\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = false;\r\n\t\t\t$scope.loadGift();\r\n\t\t}\r\n\r\n\t\t// 加载特惠数据\r\n\t\t$scope.loadGift = function(){\r\n\t\t\tif($scope.itemState==\"discount\"){\r\n\t\t\t\tvar url = Tool.host+\"/wx/order/queryByGift\";\r\n\t\t\t}else{\r\n\t\t\t\tvar url = Tool.host+\"/wx/order/queryGift\";\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:url,\r\n\t\t\t\tparams:{currentPage:$scope.currentPage},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\taccessToken:\"\"\r\n\t\t\t\t}\t\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\t\tif($scope.productInfo.length<1){\r\n\t\t\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t\t$scope.productInfo = $scope.productInfo.concat(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\tTool.alert(\"获取项目信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 处理特惠数据\r\n\t\t$scope.mergeProdcut = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.money){\r\n\t\t\t\t\titem.preferPrice = item.money;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($rootScope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载下一页\r\n\t\t$scope.loadNext = function(){\r\n\t\t\t$scope.currentPage++;\r\n\t\t\t$scope.loadGift();\r\n\t\t}\r\n\r\n\t\t// 切换最低和本月优惠\r\n\t\t$scope.switchState = function(item){\r\n\t\t\tif(item==\"discount\"){\r\n\t\t\t\tif($scope.itemState!=item){\r\n\t\t\t\t\t$scope.currentPage = 1;\r\n\t\t\t\t\t$scope.discountSelect = true;\r\n\t\t\t\t\t$scope.noProduct = false;\r\n\t\t\t\t\t$scope.itemState = item;\r\n\t\t\t\t\t$scope.productInfo = [];\r\n\t\t\t\t\t$scope.loadGift();\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif($scope.itemState!=item){\r\n\t\t\t\t\t$scope.currentPage = 1;\r\n\t\t\t\t\t$scope.discountSelect = false;\r\n\t\t\t\t\t$scope.noProduct = false;\r\n\t\t\t\t\t$scope.itemState = item;\r\n\t\t\t\t\t$scope.productInfo = [];\r\n\t\t\t\t\t$scope.loadGift();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 跳转到项目详细信息\r\n\t\t$scope.detail = function(proId,hospitalId,preferPrice){\r\n\t\t\tvar query = \"productId=\"+proId+\"&hospitalId=\"+hospitalId;\r\n\t\t\tif($scope.itemState==\"discount\"){\r\n\t\t\t\tquery += \"&code=123\";\r\n\t\t\t}else if($scope.itemState == \"month\"){\r\n\t\t\t\tquery += \"&discountid=123&flag=11&money=\"+preferPrice;\r\n\t\t\t}\r\n\t\t\tTool.changeRoute(\"/product/detail\",query);\r\n\t\t}\r\n\r\n\t\t// 疑问按钮处理函数\r\n\t\t$scope.question = function(){\r\n\t\t\tTool.alert(\"如有疑问，请致电0755-26905699\");\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}