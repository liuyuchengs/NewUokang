{"version":3,"sources":["order.js"],"names":["define","$scope","$rootScope","$location","Ajax","Tool","orders","cancelOrderId","noOrder","status","btnParams","toPay","payed","canceled","tocancel","finish","filterParams","all","has","val","toHos","toAssess","init","hasBgColor","noWindowListen","checkLogin","loadUserinfo","getParams","loadOrder","changeRoute","search","p","params","post","url","host","userId","userInfo","id","headers","accessToken","then","data","code","length","merge","alert","message","loading","forEach","item","index","array","statusMes","discountprice","parseFloat","toFixed","order","setSession","appid","redirect_uri","goUrl","toCancel","comfirm","cancelFn","hasTip","switchOrder","select"],"mappings":"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","file":"order.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,Ajax,Tool){\r\n\t\t$scope.orders;\r\n\t\t$scope.cancelOrderId;\r\n\t\t$scope.noOrder = false;\r\n\t\t$scope.status = \"\";\r\n\t\t$scope.btnParams = {\r\n\t\t\ttoPay:false,\r\n\t\t\tpayed:false,\r\n\t\t\tcanceled:false,\r\n\t\t\ttocancel:false,\r\n\t\t\tfinish:false,\r\n\t\t}\r\n\t\t$scope.filterParams = {\r\n\t\t\tall:{has:false,val:\"\"},\r\n\t\t\ttoPay:{has:false,val:\"0\"},\r\n\t\t\ttoHos:{has:false,val:\"2\"},\r\n\t\t\ttoAssess:{has:false,val:\"4\"}\r\n\t\t}\r\n\r\n\t\t//初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t$scope.getParams();\r\n\t\t\t\t$scope.loadOrder();\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 获取查询参数\r\n\t\t$scope.getParams = function(){\r\n\t\t\tif($location.search().p){\r\n\t\t\t\tvar params = $location.search().p;\r\n\t\t\t\t$scope.filterParams[params].has=true;\r\n\t\t\t\t$scope.status = $scope.filterParams[params].val;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载订单数据\r\n\t\t$scope.loadOrder = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/queryOrderList\",\r\n\t\t\t\tparams:{userId:Tool.userInfo.id,status:$scope.status},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length==0){\r\n\t\t\t\t\t\t$scope.noOrder=true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.noOrder = false;\r\n\t\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.orders = data.data;\r\n\t\t\t\t}else if(data.code==1){\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"获取订单信息失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"获取订单信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading=false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 根据订单状态码，生成对应的状态信息,如支付中...\r\n\t\t$scope.merge = function(orders){\r\n\t\t\torders.forEach(function(item,index,array){\r\n\t\t\t\titem.toPay = false;\r\n\t\t\t\titem.payed = false;\r\n\t\t\t\titem.canceled = false;\r\n\t\t\t\titem.tocancel = false;\r\n\t\t\t\titem.finish = false;\r\n\t\t\t\tswitch(item.status){\r\n\t\t\t\t\tcase -1:\r\n\t\t\t\t\t\titem.statusMes = \"已取消\";\r\n\t\t\t\t\t\titem.canceled = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\titem.statusMes = \"待支付\";\r\n\t\t\t\t\t\titem.toPay = true;\r\n\t\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\titem.statusMes = \"待确认\";\r\n\t\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\titem.statusMes = \"待就医\";\r\n\t\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\titem.statusMes = \"就医中\";\r\n\t\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\titem.statusMes = \"就医完成\";\r\n\t\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\titem.statusMes = \"就医完成\";\r\n\t\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\titem.statusMes = \"退款中\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\titem.statusMes = \"退款完成\";\r\n\t\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\titem.discountprice = parseFloat(item.discountprice).toFixed(2);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 支付订单\r\n\t\t$scope.toPay = function(order){\r\n\t\t\tTool.setSession(\"order\",order);\r\n\t\t\tvar appid = \"wx0229404bc9eeea00\";\r\n\t\t\tvar redirect_uri = Tool.host+\"/v2/htmls/temp.html\";\r\n\t\t\tvar url = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+appid+\"&redirect_uri=\"+redirect_uri+\"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect\";\r\n\t\t\tTool.goUrl(url);\r\n\t\t}\r\n\r\n\t\t// 取消订单\r\n\t\t$scope.toCancel = function(id){\r\n\t\t\t$scope.cancelOrderId = id;\r\n\t\t\tTool.comfirm(\"确定要取消订单吗？\",$scope.cancelFn);\r\n\t\t}\r\n\r\n\t\t// 取消订单提示框，确认按钮回调\r\n\t\t$scope.cancelFn =function(){\r\n\t\t\tif($rootScope.hasTip){\r\n\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/orderCacel\",\r\n\t\t\t\tparams:{id:$scope.cancelOrderId},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.status = \"\";\r\n\t\t\t\t\t$scope.loadOrder();\r\n\t\t\t\t}else if(data.code==1){\r\n\t\t\t\t\tTool.alert(\"订单取消失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"订单取消失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 切换导航条\r\n\t\t$scope.switchOrder = function(item){\r\n\t\t\tTool.select(item,$scope.filterParams);\r\n\t\t\t$scope.status = $scope.filterParams[item].val;\r\n\t\t\t$scope.loadOrder();\r\n\t\t}\r\n\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}