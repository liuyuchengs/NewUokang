{"version":3,"sources":["grabCode.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","queryParams","productId","hospitalId","dayDate","code","userInfo","loadQueryParams","search","angular","element","document","ready","hasBgColor","noWindowListen","checkLogin","loadUserinfo","checkCode","length","alert","post","url","host","params","headers","accessToken","then","data","getGift","message","loading","user","getLocal","giftCode","setLocal","changeRoute"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,WAAWC,UAAUC,KAAKC,MAChDJ,OAAOK,aACNC,UAAU,GACVC,WAAW,GACXC,QAAQ,GACRC,KAAK,IAENT,OAAOU,YAGPV,OAAOW,gBAAkB,WACrBT,UAAUU,SAASN,YACrBN,OAAOK,YAAYC,UAAYJ,UAAUU,SAASN,WAEhDJ,UAAUU,SAASL,aACrBP,OAAOK,YAAYE,WAAaL,UAAUU,SAASL,YAEjDL,UAAUU,SAASJ,UACrBR,OAAOK,YAAYG,QAAUN,UAAUU,SAASJ,UAKlDK,QAAQC,QAAQC,UAAUC,MAAM,WAC/Bf,WAAWgB,YAAa,EACxBd,KAAKe,iBACLlB,OAAOW,kBACJR,KAAKgB,cACPhB,KAAKiB,iBAKPpB,OAAOqB,UAAY,WACfrB,OAAOK,YAAYI,KAAKa,OAAO,EACjCnB,KAAKoB,MAAM,WAC6B,GAAhCvB,OAAOK,YAAYI,KAAKa,OAChCnB,KAAKoB,MAAM,yCAC8B,GAAjCvB,OAAOK,YAAYI,KAAKa,QAChClB,KAAKoB,MACJC,IAAItB,KAAKuB,KAAK,sBACdC,OAAO3B,OAAOK,YACduB,SACCC,YAAc1B,KAAKO,SAASmB,eAE3BC,KAAK,SAASC,MACF,GAAXA,KAAKtB,KACPT,OAAOgC,QAAQhC,OAAOK,aAEtBF,KAAKoB,MAAMQ,KAAKE,WAVlB7B,SAYS,WACRD,KAAKoB,MAAM,mBAbZnB,WAcW,WACVH,WAAWiC,SAAU,KAMxBlC,OAAOgC,QAAU,SAAS3B,aACzBD,KAAKoB,MACJC,IAAItB,KAAKuB,KAAK,0BACdC,OAAOtB,YACPuB,SACCC,YAAc1B,KAAKO,SAASmB,eAE3BC,KAAK,SAASC,MAChB,GAAe,GAAZA,KAAKtB,KAAS,CAChB,GAAI0B,MAAOhC,KAAKiC,SAAS,OACzBD,MAAKE,SAAW,EAChBlC,KAAKmC,SAAS,OAAOH,MACrBhC,KAAKmC,SAAS,OAAOP,KAAKA,MAC1B5B,KAAKoC,YAAY,kBAZnBnC,SAcS,WACRD,KAAKoB,MAAM,mBAfZnB,WAgBW,WACVH,WAAWiC,SAAU","file":"grabCode.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,Tool,Ajax){\r\n\t\t$scope.queryParams = {\r\n\t\t\tproductId:\"\",\r\n\t\t\thospitalId:\"\",\r\n\t\t\tdayDate:\"\",\r\n\t\t\tcode:\"\",\r\n\t\t}\r\n\t\t$scope.userInfo = {};\r\n\r\n\t\t// 获取查询字符串参数\r\n\t\t$scope.loadQueryParams = function(){\r\n\t\t\tif($location.search().productId){\r\n\t\t\t\t$scope.queryParams.productId = $location.search().productId;\r\n\t\t\t}\r\n\t\t\tif($location.search().hospitalId){\r\n\t\t\t\t$scope.queryParams.hospitalId = $location.search().hospitalId;\r\n\t\t\t}\r\n\t\t\tif($location.search().dayDate){\r\n\t\t\t\t$scope.queryParams.dayDate = $location.search().dayDate;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 页面初始化\r\n\t\tangular.element(document).ready(function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.loadQueryParams();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// 检查可生成惠赠订单\r\n\t\t$scope.checkCode = function(){\r\n\t\t\tif($scope.queryParams.code.length<1){\r\n\t\t\t\tTool.alert(\"请填写惠赠码!\");\r\n\t\t\t}else if($scope.queryParams.code.length!=5){\r\n\t\t\t\tTool.alert(\"惠赠码错误，请填写正确的惠赠码！如需帮助请致电：0755-26905699\")\r\n\t\t\t}else if($scope.queryParams.code.length ==5){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/order/checkCode\",\r\n\t\t\t\t\tparams:$scope.queryParams,\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.getGift($scope.queryParams);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"数据连接失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 生成惠赠订单\r\n\t\t$scope.getGift = function(queryParams){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/gift/getgiftproduct\",\r\n\t\t\t\tparams:queryParams,\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code ==0){\r\n\t\t\t\t\tvar user = Tool.getLocal(\"user\");\r\n\t\t\t\t\tuser.giftCode = 0;\r\n\t\t\t\t\tTool.setLocal(\"user\",user);\r\n\t\t\t\t\tTool.setLocal(\"gift\",data.data);\r\n\t\t\t\t\tTool.changeRoute(\"/grab/order\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试！\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})"],"sourceRoot":"/source/"}