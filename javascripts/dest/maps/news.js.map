{"version":3,"sources":["news.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","news","navValue","currentPage","pageRows","loading","noProduct","noProductText","imgStyle","width","screen","navParam","all","has","val","yake","meirong","fck","zhongyi","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","init","hasBgColor","initSwiper","loadNews","Swiper","loop","pagination","autoplay","autoplayDisableOnInteraction","observeParents","observer","type","select","post","url","host","params","then","data","code","length","mergeImg","concat","alert","message","items","forEach","item","picture","toDetail","id","changeRoute","detail","initDetail","search","noWindowListen","loadDetail","content","mergeDetail","str","arrayStr","split","index","trim"],"mappings":"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","file":"news.js","sourcesContent":["/**\r\n * 资讯控制器\r\n */\r\ndefine(function(){\r\n\treturn function($scope,$rootScope,$location,Tool,Ajax){\r\n\t\t$scope.news = [];\r\n\t\t$scope.navValue = \"all\";\r\n\t\t$scope.currentPage = 1;\r\n\t\t$scope.pageRows = 10;\r\n\t\t$scope.loading = false;\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.imgStyle = {\r\n\t\t\t\"width\":screen.width\r\n\t\t}\r\n\t\t$scope.navParam = {\r\n\t\t\t\"all\":{\r\n\t\t\t\thas:true,\r\n\t\t\t\tval:\"综合\"\r\n\t\t\t},\r\n\t\t\t\"yake\":{\r\n\t\t\t\thas:false,\r\n\t\t\t\tval:\"牙科\"\r\n\t\t\t},\r\n\t\t\t\"meirong\":{\r\n\t\t\t\thas:false,\r\n\t\t\t\tval:\"美容\"\r\n\t\t\t},\r\n\t\t\t\"fck\":{\r\n\t\t\t\thas:false,\r\n\t\t\t\tval:\"妇产科\"\r\n\t\t\t},\r\n\t\t\t\"zhongyi\":{\r\n\t\t\t\thas:false,\r\n\t\t\t\tval:\"中医理疗\"\r\n\t\t\t},\r\n\t\t}\r\n\r\n\t\t//滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = false;\r\n\t\t\t$scope.initSwiper();\r\n\t\t\t$scope.loadNews();\r\n\t\t}\r\n\r\n\t\t// 初始化图片轮播插件\r\n\t\t$scope.initSwiper = function(){\r\n\t\t\tvar myswiper = new Swiper(\".swiper-container\",{\r\n\t\t\t\tloop: false,\r\n\t\t\t\tpagination: '.swiper-pagination',\r\n\t\t\t\tautoplay: 5000,\r\n\t\t\t\tautoplayDisableOnInteraction:false,\r\n\t\t\t\tobserveParents:true,  //\r\n\t\t\t\tobserver:true,\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 切换导航栏\r\n\t\t$scope.switch = function(type){\r\n\t\t\tif(type!=$scope.navValue){\r\n\t\t\t\t$scope.navValue = type;\r\n\t\t\t\tTool.select(type,$scope.navParam);\r\n\t\t\t\t$scope.news = [];\r\n\t\t\t\t$scope.currentPage = 1;\r\n\t\t\t\t$scope.noProduct = false;\r\n\t\t\t\t$scope.loadNews();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 查询数据\r\n\t\t$scope.loadNews = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/health/queryByType\",\r\n\t\t\t\tparams:{type:$scope.navParam[$scope.navValue].val,currentPage:$scope.currentPage,pageRows:$scope.pageRows},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\t\tif($scope.news.length<1){\r\n\t\t\t\t\t\t\t$scope.noProductText = \"暂时没有资讯信息!\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.mergeImg(data.data);\r\n\t\t\t\t\t\t$scope.news = $scope.news.concat(data.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\tTool.alert(\"查询数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 分页查询，查询下一页\r\n\t\t$scope.loadNext = function(){\r\n\t\t\t$scope.currentPage++;\r\n\t\t\t$scope.loadNews();\r\n\t\t}\r\n\r\n\t\t// 图片为空时，设置默认图片\r\n\t\t$scope.mergeImg = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tif(item.picture==\"\"||item.picture == null){\r\n\t\t\t\t\titem.picture = \"../contents/img/p_default.png\";\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 跳转到详细页面\r\n\t\t$scope.toDetail = function(id){\r\n\t\t\tTool.changeRoute(\"/news/detail\",\"id=\"+id);\r\n\t\t}\r\n\r\n\t\t$scope.detail = {};\r\n\t\t$scope.id = null;\r\n\r\n\t\t//初始化页面\r\n\t\t$scope.initDetail = function(){\r\n\t\t\t$scope.id = $location.search().id;\r\n\t\t\t$rootScope.hasBgColor =false;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.loadDetail();\r\n\t\t}\r\n\r\n\t\t//加载资讯信息\r\n\t\t$scope.loadDetail = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/health/querydetail\",\r\n\t\t\t\tparams:{id:$scope.id},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tdata.data.content = $scope.mergeDetail(data.data.content);\r\n\t\t\t\t\t$scope.detail = data.data;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"查询数据失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"查询数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 对资讯信息进行排版\r\n\t\t */\r\n\t\t$scope.mergeDetail = function(str){\r\n\t\t\tvar arrayStr = str.split(\"\\r\\n\");\r\n\t\t\tfor(var index in arrayStr){\r\n\t\t\t\tarrayStr[index] = arrayStr[index].trim();\r\n\t\t\t}\r\n\t\t\treturn arrayStr;\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}