{"version":3,"sources":["doctorDetail.js"],"names":["define","$scope","$rootScope","$location","$anchorScroll","Ajax","Tool","loading","hasTime","hasProduct","description","has","val","use","follow","hasFollow","followText","id","doctorInfo","assessInfo","time","hasSelect","openSelect","selectDay","selectTime","selectId","noTime","timeList","order","hospitalId","doctorId","productId","scheduleId","doctorName","treatmentTime","hospitalName","hospitalAddress","preferPrice","productName","flag","dealMoney","payMoney","realMoney","giftMoney","code","discountid","queryParams","currentPage","pageRows","init","hasBgColor","noWindowListen","getParams","queryDoctor","querySchedule","initSwiper","queryAssess","mySwiper","Swiper","slidesPerView","slidesPerGroup","observeParents","observer","toPage","params","$event","slidePrev","slideNext","stopPropagation","selectProduct","search","changeRoute","showDescription","showUse","needPackageInfo","checkLogin","loadUserinfo","accessToken","userInfo","post","url","host","then","data","hospitalname","hospitaladdress","focusState","dentallist","forEach","item","priceunit","preferPriceType","pricetype","alert","mergeDoctor","items","score","length","mergeSchedule","first","property","date","slice","value","totalscore","switchDay","select","day","days","index","scheduleid","orderDetail","title","price","isUserInfoComplete","headers","parseFloat","setSession","comfirm","hasTip","hideSelect","ask","goAssess","switchFollow","cacelFollow","tofollow","userId","back","window","history"],"mappings":"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","file":"doctorDetail.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,$anchorScroll,Ajax,Tool){\r\n\t\t$scope.loading = false;\r\n\t\t$scope.hasTime = false;\r\n\t\t$scope.hasProduct = false;\r\n\t\t$scope.description ={\r\n\t\t\thas:false,\r\n\t\t\tval:\"查看全部\",\r\n\t\t}\r\n\t\t$scope.use = {\r\n\t\t\thas:false,\r\n\t\t\tval:\"查看全部\"\r\n\t\t}\r\n\t\t$scope.follow = {\r\n\t\t\thasFollow:false,\r\n\t\t\tfollowText:\"关注\"\r\n\t\t}\r\n\t\t$scope.id = null;\r\n\t\t$scope.doctorInfo = {};\r\n\t\t$scope.assessInfo = [];\r\n\t\t$scope.time = {\r\n\t\t\thasSelect:false,\r\n\t\t\topenSelect:false,\r\n\t\t\tselectDay:null,\r\n\t\t\tselectTime:null,\r\n\t\t\tselectId:null,\r\n\t\t\tnoTime:false,\r\n\t\t\ttimeList:{}\r\n\t\t}\r\n\t\t$scope.order = {\r\n\t\t\thospitalId:\"\",\r\n\t\t\tdoctorId:\"\",\r\n\t\t\tproductId:\"\",\r\n\t\t\tscheduleId:\"\",\r\n\t\t\tdoctorName:\"\",\r\n\t\t\ttreatmentTime:\"\",\r\n\t\t\thospitalName:\"\",\r\n\t\t\thospitalAddress:\"\",\r\n\t\t\tpreferPrice:\"\",\r\n\t\t\tproductName:\"\",\r\n\t\t\tflag:1,\r\n\t\t\tdealMoney:\"\",\r\n\t\t\tpayMoney:\"\",\r\n\t\t\trealMoney:\"\",\r\n\t\t\tgiftMoney:\"\",\r\n\t\t\tcode:null,\r\n\t\t\tdiscountid:null,\r\n\t\t}\r\n\t\t// 医生评价参数\r\n\t\t$scope.queryParams = {\r\n\t\t\tid:null,\r\n\t\t\tcurrentPage:1,\r\n\t\t\tpageRows:10,\r\n\t\t}\r\n\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.getParams();\r\n\t\t\t$scope.queryDoctor();\r\n\t\t\t$scope.querySchedule();\r\n\t\t\t$scope.initSwiper();\r\n\t\t\t$scope.queryAssess();\r\n\t\t}\r\n\r\n\t\t// 初始化swiper\r\n\t\t$scope.initSwiper = function(){\r\n\t\t\t$scope.mySwiper = new Swiper('.swiper-container', {\r\n\t\t\t\tslidesPerView : 4,\r\n\t\t\t\tslidesPerGroup : 4,\r\n\t\t\t\tobserveParents:true,  //\r\n\t\t\t\tobserver:true\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// swiper跳转到指定页\r\n\t\t$scope.toPage = function(params,$event){\r\n\t\t\tif(params===\"per\"){\r\n\t\t\t\t$scope.mySwiper.slidePrev();\r\n\t\t\t}\r\n\t\t\tif(params===\"next\"){\r\n\t\t\t\t$scope.mySwiper.slideNext();\r\n\t\t\t}\r\n\t\t\t$event.stopPropagation();\r\n\t\t}\r\n\r\n\t\t// 切换选择就医时间\r\n\t\t$scope.selectTime = function(){\r\n\t\t\t$scope.hasTime = !$scope.hasTime;\r\n\t\t}\r\n\r\n\t\t// 切换选择就医项目\r\n\t\t$scope.selectProduct = function(){\r\n\t\t\t$scope.hasProduct = !$scope.hasProduct;\r\n\t\t}\r\n\r\n\t\t// 获取查询参数\r\n\t\t$scope.getParams = function(){\r\n\t\t\tif($location.search().id){\r\n\t\t\t\t$scope.id = $location.search().id;\r\n\t\t\t\t$scope.queryParams.id = $scope.id;\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/doctor\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 收起和隐藏医生简介\r\n\t\t$scope.showDescription = function(){\r\n\t\t\t$scope.description.has = !$scope.description.has;\r\n\t\t\tif($scope.description.has){\r\n\t\t\t\t$scope.description.val = \"收起简介\";\r\n\t\t\t}else{\r\n\t\t\t\t$scope.description.val = \"查看全部\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 收起和隐藏擅长简介\r\n\t\t$scope.showUse = function(){\r\n\t\t\t$scope.use.has = !$scope.use.has;\r\n\t\t\tif($scope.use.has){\r\n\t\t\t\t$scope.use.val = \"收起简介\";\r\n\t\t\t}else{\r\n\t\t\t\t$scope.use.val = \"查看全部\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 获取医生信息\r\n\t\t$scope.queryDoctor = function(){\r\n\t\t\tvar params = {needPackageInfo:true,id:$scope.id}\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tparams.accessToken = Tool.userInfo.accessToken;\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/doctor/queryDoctorDetailInfo\",\r\n\t\t\t\tparams:params,\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.order.doctorName = data.data.doctorName;\r\n\t\t\t\t\t$scope.order.doctorId = data.data.id;\r\n\t\t\t\t\t$scope.order.hospitalId = data.data.hospitalId;\r\n\t\t\t\t\t$scope.order.hospitalName = data.data.hospitalname;\r\n\t\t\t\t\t$scope.order.hospitalAddress = data.data.hospitaladdress;\r\n\t\t\t\t\tif(data.data.focusState==1){\r\n\t\t\t\t\t\t$scope.follow.hasFollow= true;\r\n\t\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata.data.dentallist.forEach(function(item){\r\n\t\t\t\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t$scope.doctorInfo = data.data;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 检查医生信息\r\n\t\t$scope.mergeDoctor = function(items){\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\titem.score==null|item.score==\"\"?item.score=\"暂无评分\":item.score+=\"分\";\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 获取医生排班信息\r\n\t\t$scope.querySchedule = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/querybydoctorid\",\r\n\t\t\t\tparams:{doctorId:$scope.id},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.length>0){\r\n\t\t\t\t\t\t$scope.mergeSchedule(data.data);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.time.noTime = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"数据连接失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"数据连接失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 检查医生排班信息\r\n\t\t$scope.mergeSchedule = function(items){\r\n\t\t\tvar first = true;\r\n\t\t\titems.forEach(function(item){\r\n\t\t\t\tvar property = item.date.slice(5,10);\r\n\t\t\t\titem.date = property;\r\n\t\t\t\tif(first){\r\n\t\t\t\t\t$scope.time.timeList[property] = {\r\n\t\t\t\t\t\thas:true,\r\n\t\t\t\t\t\tvalue:item\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.time.timeList[property] = {\r\n\t\t\t\t\t\thas:false,\r\n\t\t\t\t\t\tvalue:item\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 获取医生评价信息\r\n\t\t$scope.queryAssess = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/review/showdoctorreview\",\r\n\t\t\t\tparams:$scope.queryParams\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tdata.data.forEach(function(item){\r\n\t\t\t\t\t\tif(item.totalscore==null){\r\n\t\t\t\t\t\t\titem.totalscore = \"暂无评分\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\titem.totalscore = item.totalscore+\"分\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t$scope.assessInfo = data.data;\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"数据连接失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 切换导航栏\r\n\t\t$scope.switchDay = function(property){\r\n\t\t\tTool.select(property,$scope.time.timeList);\r\n\t\t}\r\n\r\n\t\t// 选择时间\r\n\t\t$scope.selectTime = function(id,time,day){\r\n\t\t\tif($scope.time.selectDay!=null&&$scope.time.selectId!=null){\r\n\t\t\t\tvar selectDay = $scope.time.selectDay;\r\n\t\t\t\tvar selectId = $scope.time.selectId;\r\n\t\t\t\tif($scope.time.timeList[selectDay]){\r\n\t\t\t\t\tvar days = $scope.time.timeList[selectDay].value;\r\n\t\t\t\t\tfor(var index in days.timeList){\r\n\t\t\t\t\t\tif(days.timeList[index].scheduleid == selectId){\r\n\t\t\t\t\t\t\tdays.timeList[index].has = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif($scope.time.timeList[day]){\r\n\t\t\t\tvar days = $scope.time.timeList[day].value;\r\n\t\t\t\tfor(var index in days.timeList){\r\n\t\t\t\t\tif(days.timeList[index].scheduleid==id){\r\n\t\t\t\t\t\tdays.timeList[index].has = true;\r\n\t\t\t\t\t\t$scope.time.selectDay = day;\r\n\t\t\t\t\t\t$scope.time.selectId = id;\r\n\t\t\t\t\t\t$scope.time.selectTime = time;\r\n\t\t\t\t\t\t$scope.time.hasSelect = true;\r\n\t\t\t\t\t\t$scope.order.scheduleId = id;\r\n\t\t\t\t\t\t$scope.order.treatmentTime = day+\" \"+time;\r\n\t\t\t\t\t\t$scope.time.openSelect = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 获取money以及跳转页面\r\n\t\t$scope.orderDetail = function(id,title,price){\r\n\t\t\tif(!$scope.time.noTime){\r\n\t\t\t\tif($scope.time.hasSelect){\r\n\t\t\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\t\t\tTool.comfirm(\"请先登录并完善个人信息\",function(){\r\n\t\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else if(!Tool.isUserInfoComplete()){\r\n\t\t\t\t\t\tTool.comfirm(\"请完善个人信息!\",function(){\r\n\t\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/user/userInfo\");\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.order.productId = id;\r\n\t\t\t\t\t\t$scope.order.productName = title;\r\n\t\t\t\t\t\t$scope.order.preferPrice = \"￥\"+price;\r\n\t\t\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t\t\tAjax.post({\r\n\t\t\t\t\t\t\turl:Tool.host+\"/wx/order/checkCodeMoney\",\r\n\t\t\t\t\t\t\tparams:{productId:$scope.order.productId},\r\n\t\t\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t\t\t$scope.order.dealMoney = data.dealMoney;\r\n\t\t\t\t\t\t\t$scope.order.payMoney = data.payMoney;\r\n\t\t\t\t\t\t\t$scope.order.realMoney = data.realMoney;\r\n\t\t\t\t\t\t\t$scope.order.giftMoney = data.giftMoney;\r\n\t\t\t\t\t\t\tif(parseFloat($scope.order.giftMoney)<=0){\r\n\t\t\t\t\t\t\t\t$scope.order.flag = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tTool.setSession(\"makeorder\",$scope.order);\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/makeorder\");\r\n\t\t\t\t\t\t}).catch(function(){\r\n\t\t\t\t\t\t\tTool.alert(\"加载App付款金额失败!\");\r\n\t\t\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请先预约就医时间!\");\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"此医生没有排班，暂不能下单。去其他医生看看吧!\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 打开时间选择窗口\r\n\t\t$scope.openSelect = function(){\r\n\t\t\tif($scope.time.noTime){\r\n\t\t\t\tTool.alert(\"此医生没有排班，暂不能下单。去其他医生看看吧!\");\r\n\t\t\t}else{\r\n\t\t\t\t$scope.time.openSelect = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 隐藏时间选择窗口\r\n\t\t$scope.hideSelect = function($event){\r\n\t\t\t$scope.time.openSelect = false;\r\n\t\t}\r\n\r\n\t\t// 跳转到咨询页面\r\n\t\t$scope.ask = function(){\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tTool.changeRoute(\"/doctor/askDoctor\",\"id=\"+$scope.id);\r\n\t\t\t}else{\r\n\t\t\t\tTool.comfirm(\"请先登录\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 跳到医生评价\r\n\t\t$scope.goAssess = function(){\r\n\t\t\t$anchorScroll(\"doctorAssess\");\r\n\t\t}\r\n\r\n\t\t// 关注按钮处理函数\r\n\t\t$scope.switchFollow = function(){\r\n\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\tTool.comfirm(\"请先登录!\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tif($scope.follow.hasFollow){\r\n\t\t\t\t\t$scope.cacelFollow();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.tofollow();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 关注发帖医生\r\n\t\t$scope.tofollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/focus\",\r\n\t\t\t\tparams:{flag:2,userId:$scope.id},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 取消关注医生\r\n\t\t$scope.cacelFollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/cacelFocus\",\r\n\t\t\t\tparams:{flag:2,userId:$scope.id},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = false;\r\n\t\t\t\t\t$scope.follow.followText = \"关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"取消关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t//返回按钮\r\n\t\t$scope.back = function(){\r\n\t\t\twindow.history.back();\r\n\t\t}\r\n\t}\r\n})"],"sourceRoot":"/source/"}