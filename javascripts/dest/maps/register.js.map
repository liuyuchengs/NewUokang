{"version":3,"sources":["register.js"],"names":["define","$scope","$rootScope","$location","$interval","Tool","Ajax","phone","password","passwordAgian","code","codeText","referralCode","codeState","disable","phoneCheckResult","init","hasBgColor","noWindowListen","search","register","check","codeCheck","registering","test","length","alert","getCode","post","url","host","params","then","data","time","interval","cancel","message","loading","phoneCheck","name","param","callback","p","verifyCode","setLocal","hasTip","changeRoute"],"mappings":"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","file":"register.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,$interval,Tool,Ajax){\r\n\t\t$scope.phone=\"\"; //手机号码\r\n\t\t$scope.password=\"\"; //密码\r\n\t\t$scope.passwordAgian=\"\"; //确认密码\r\n\t\t$scope.code=\"\"; //验证码\r\n\t\t$scope.codeText=\"获取短信验证码\";\r\n\t\t$scope.referralCode = \"\";\r\n\t\t$scope.codeState = true; //验证码按钮是否可用\r\n\t\t$scope.disable = false;\r\n\t\t$scope.phoneCheckResult = false;\r\n\r\n\t\t// 加载host\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tif($location.search().code){\r\n\t\t\t\t$scope.referralCode = $location.search().code;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 注册按钮处理函数\r\n\t\t$scope.register = function(){\r\n\t\t\tif($scope.check()){\r\n\t\t\t\t$scope.codeCheck($scope.registering);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 检查输入是否符合要求\r\n\t\t$scope.check = function(){\r\n\t\t\tif(/^1[3|4|5|7|8]\\d{9}$/.test($scope.phone)&&$scope.password.length>=8&&$scope.password.length<=20&$scope.password==$scope.passwordAgian){\r\n\t\t\t\treturn true;\r\n\t\t\t}else{\r\n\t\t\t\tif(!(/^1[3|4|5|7|8]\\d{9}$/.test($scope.phone))){\r\n\t\t\t\t\tTool.alert(\"手机号码错误，请仔细检查!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else if($scope.password.length<8|$scope.password.length>20){\r\n\t\t\t\t\tTool.alert(\"密码长度不符合要求，请输入8-20位的密码!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else if($scope.password!=$scope.passwordAgian){\r\n\t\t\t\t\tTool.alert(\"两次输入的密码不一致，请重新输入!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"手机号码或者密码错误，请重新输入!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 验证码按钮处理函数\r\n\t\t$scope.getCode = function(){\r\n\t\t\tif($scope.codeState){\r\n\t\t\t\tif($scope.phoneCheckResult){\r\n\t\t\t\t\t// 发送短信验证码\r\n\t\t\t\t\tAjax.post({\r\n\t\t\t\t\t\turl:Tool.host+\"/wx/register/sendsmsregistercode\",\r\n\t\t\t\t\t\tparams:{\"phone\":$scope.phone}\r\n\t\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t\tvar time = 59;\r\n\t\t\t\t\t\t\t$scope.codeState = false;\r\n\t\t\t\t\t\t\tvar interval = $interval(function(){\r\n\t\t\t\t\t\t\t\t$scope.codeText = (time+\" S\");\r\n\t\t\t\t\t\t\t\ttime--;\r\n\t\t\t\t\t\t\t},1000,60).then(function(){\r\n\t\t\t\t\t\t\t\t$scope.codeText = \"获取短信验证码\";\r\n\t\t\t\t\t\t\t\t$scope.codeState = true;\r\n\t\t\t\t\t\t\t\t$interval.cancel(interval);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(function(){\r\n\t\t\t\t\t\tTool.alert(\"发送验证码失败，请稍后再试!\");\r\n\t\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请填写正确手机号码!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 检查手机号码是否可以注册\r\n\t\t$scope.phoneCheck = function(){\r\n\t\t\tif(/^1[3|4|5|7|8]\\d{9}$/.test($scope.phone)){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/register/registercheck\",\r\n\t\t\t\t\tparams:{name:\"phone\",param:$scope.phone},\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.phoneCheckResult = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"手机号码检查失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\t$scope.phoneCheckResult = false;\r\n\t\t\t\tTool.alert(\"手机号码不正确！\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 验证短信验证码是否正确\r\n\t\t$scope.codeCheck = function(callback){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/register/registercheck\",\r\n\t\t\t\tparams:{name:\"verifyCode\",param:$scope.code,p:$scope.phone},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"验证码验证失败，请重试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 注册\r\n\t\t$scope.registering = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/register/register\",\r\n\t\t\t\tparams:{phone:$scope.phone,verifyCode:$scope.code,password:$scope.password,referralCode:$scope.referralCode},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tTool.setLocal(\"user\",data.data);\r\n\t\t\t\t\tTool.alert(\"注册成功!\",function(){\r\n\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"注册失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}