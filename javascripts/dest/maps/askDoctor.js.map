{"version":3,"sources":["askDoctor.js"],"names":["define","$","$scope","$rootScope","$location","$http","Tool","Ajax","hasSee","content","noSelect","postData","FormData","doctorId","params","input1","has","url","val","input2","input3","input4","input5","input6","init","hasBgColor","noWindowListen","getParams","checkLogin","loadUserinfo","comfirm","hasTip","changeRoute","listen","search","id","history","back","chooseSee","on","getUrl","this","files","$apply","obj","undefined","window","createObjectURL","URL","webkitURL","choosePic","count","item","prototype","click","alert","remove","clear","selector","element","document","getElementById","outerHTML","mergePic","imgStr","pStr","afterCount","file","Blob","type","index","beforeParams","append","get","send","host","loading","post","headers","Content-Type","accessToken","userInfo","success","data","code","error"],"mappings":"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","file":"askDoctor.js","sourcesContent":["define([\"jquery\"],function($){\r\n\treturn function($scope,$rootScope,$location,$http,Tool,Ajax){\r\n\t\t$scope.hasSee = true;\r\n\t\t$scope.content = null;\r\n\t\t$scope.noSelect = true;\r\n\t\t$scope.postData = new FormData();\r\n\t\t$scope.doctorId = null;\r\n\t\t\r\n\t\t//input控件参数\r\n\t\t$scope.params = {\r\n\t\t\tinput1:{has:false,url:\"\",val:\"#input1\"},\r\n\t\t\tinput2:{has:false,url:\"\",val:\"#input2\"},\r\n\t\t\tinput3:{has:false,url:\"\",val:\"#input3\"},\r\n\t\t\tinput4:{has:false,url:\"\",val:\"#input4\"},\r\n\t\t\tinput5:{has:false,url:\"\",val:\"#input5\"},\r\n\t\t\tinput6:{has:false,url:\"\",val:\"#input6\"},\r\n\t\t}\r\n\t\t\r\n\t\t// 初始化页面\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.getParams();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t}else{\r\n\t\t\t\tTool.comfirm(\"请先登录\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t$scope.listen();\r\n\t\t}\r\n\r\n\t\t// 获取医生id参数\r\n\t\t$scope.getParams = function(){\r\n\t\t\tif($location.search().id){\r\n\t\t\t\t$scope.doctorId = $location.search().id;\r\n\t\t\t}else{\r\n\t\t\t\thistory.back();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 切换是否医生可见\r\n\t\t$scope.chooseSee = function(){\r\n\t\t\t$scope.hasSee = !$scope.hasSee;\r\n\t\t}\r\n\r\n\t\t// 监听input元素选择图片\r\n\t\t$scope.listen = function(){\r\n\t\t\t$(\"#input1\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input1.has = true;\r\n\t\t\t\t$scope.params.input1.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input2\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input2.has = true;\r\n\t\t\t\t$scope.params.input2.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input3\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input3.has = true;\r\n\t\t\t\t$scope.params.input3.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input4\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input4.has = true;\r\n\t\t\t\t$scope.params.input4.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input5\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input5.has = true;\r\n\t\t\t\t$scope.params.input5.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t\t$(\"#input6\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.params.input6.has = true;\r\n\t\t\t\t$scope.params.input6.url = url;\r\n\t\t\t\t$scope.noSelect = false;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 获取input元素图片的url，做图片预览\r\n\t\t$scope.getUrl = function(obj){\r\n\t\t\tvar url = null;\r\n\t\t\tif (window.createObjectURL != undefined) { // basic\r\n\t\t\t\turl = window.createObjectURL(obj);\r\n\t\t\t} else if (window.URL != undefined) { // mozilla(firefox)\r\n\t\t\t\turl = window.URL.createObjectURL(obj);\r\n\t\t\t} else if (window.webkitURL != undefined) { // webkit or chrome\r\n\t\t\t\turl = window.webkitURL.createObjectURL(obj);\r\n\t\t\t}\r\n\t\t\treturn url;\r\n\t\t}\r\n\r\n\t\t// 触发随便说说选择照片\r\n\t\t$scope.choosePic = function(){\r\n\t\t\tvar count = 0;\r\n\t\t\tfor(var item in $scope.params){\r\n\t\t\t\tvar prototype = $scope.params[item];\r\n\t\t\t\tcount++;\r\n\t\t\t\tif(!prototype.has){\r\n\t\t\t\t\t$(prototype.val).click();\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(count==6){\r\n\t\t\t\tTool.alert($scope,\"最多只能上传6张图片!\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 删除图片\r\n\t\t$scope.remove = function(item){\r\n\t\t\tif($scope.params[item]){\r\n\t\t\t\t$scope.params[item].has=false;\r\n\t\t\t\t$scope.params[item].url=\"\";\r\n\t\t\t\t$scope.clear(item);\r\n\t\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 重新替换要重新选择图片的input元素\r\n\t\t$scope.clear = function(selector){\r\n\t\t\tvar element = document.getElementById(selector);\r\n\t\t\telement.outerHTML = element.outerHTML; //重新替换Input元素\r\n\t\t}\r\n\r\n\t\t// 调整照片参数\r\n\t\t$scope.mergePic = function(){\r\n\t\t\tvar imgStr = \"img\";\r\n\t\t\tvar pStr = \"p\";\r\n\t\t\tvar count = 1;\r\n\t\t\tvar afterCount = 3;\r\n\t\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\t\tfor(var index in $scope.beforeParams){\r\n\t\t\t\tvar prototype = $scope.beforeParams[index];\r\n\t\t\t\tif(prototype.has){\r\n\t\t\t\t\tif(count<4){\r\n\t\t\t\t\t\t$scope.postData.append(imgStr+count,$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(count;count<7;count++){\r\n\t\t\t\tif(count<4){\r\n\t\t\t\t\t$scope.postData.append(imgStr+count,file);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),file);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 提交提问\r\n\t\t$scope.send = function(){\r\n\t\t\tif($scope.content===null||$scope.content===\"\"){\r\n\t\t\t\tTool.alert(\"请填写咨询内容!\");\r\n\t\t\t}else{\r\n\t\t\t\tvar url = Tool.host+\"/wx/post/addPost\";\r\n\t\t\t\t$scope.mergePic();\r\n\t\t\t\t$scope.postData.append(\"postName\",\"\");\r\n\t\t\t\t$scope.postData.append(\"postContent\",$scope.content);\r\n\t\t\t\t$scope.postData.append(\"postFlags\",3);\r\n\t\t\t\t$scope.postData.append(\"doctorId\",$scope.doctorId);\r\n\t\t\t\t$rootScope.loading = true;\r\n\t\t\t\t$rootScope.loading = true;\r\n\t\t\t\t$http.post(url,$scope.postData,{\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\"Content-Type\":undefined,\r\n\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).success(function(data){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\thistory.back();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}).error(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t$scope.postData = new FormData();\r\n\t\t\t\t\tTool.alert(\"连接失败，请稍后再试!\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 返回上一页\r\n\t\t$scope.back = function(){\r\n\t\t\thistory.back();\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}