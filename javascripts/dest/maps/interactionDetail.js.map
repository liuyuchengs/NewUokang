{"version":3,"sources":["interactionDetail.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","post","replyMess","showReplyInputId","showPostinput","messageId","replyId","inputStyle","noProduct","noProductText","postId","follow","hasFollow","followText","queryParams","id","pageRows","currentPage","imgStyle","width","screen","swiperParams","hasSwiper","showBefore","showAfter","init","hasBgColor","getQueryString","queryPost","queryMessage","initSwiper","Swiper","loop","autoplayDisableOnInteraction","observeParents","observer","switchSwiper","item","has","search","changeRoute","window","onscroll","loading","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","obj","checkLogin","loadUserinfo","accessToken","userInfo","url","host","params","then","data","code","faceImage","list1","length","hasList1","list2","hasList2","focusState","alert","message","commentList","mergeMessage","concat","comment","counts","outIndex","reply","count","hasReplyInput","createDateStr","trim","slice","parseInt","praiseNum","repliesMessageList","hasReply","replyList","inIndex","replyListItem","replyName","isReply","comfirm","hasTip","thumb","flag","index","headers","showReplyInput","showPostInput","hidePostInput","hideReplyInput","sendPost","content","replyState","userId","mergeNewReply","push","userImage","user","getLocal","sex","sendReply","clickFollow","cacelFollow","tofollow","goDoctor","goProduct","productId","hospitalId"],"mappings":"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","file":"interactionDetail.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,Tool,Ajax){\r\n\t\t$scope.post = {};\r\n\t\t$scope.replyMess = {};\r\n\t\t$scope.showReplyInputId = null;\r\n\t\t$scope.showPostinput = false;\r\n\t\t$scope.messageId = null; //评论id\r\n\t\t$scope.replyId = null; //被回复人id\r\n\t\t//回复输入框提示本文\r\n\t\t$scope.inputStyle = \"输入你的回复...\";\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.postId = \"\";\r\n\t\t$scope.follow = {\r\n\t\t\thasFollow:false,\r\n\t\t\tfollowText:\"关注\"\r\n\t\t}\r\n\t\t$scope.queryParams = {\r\n\t\t\tid:\"\",\r\n\t\t\tpageRows:10,\r\n\t\t\tcurrentPage:1\r\n\t\t}\r\n\r\n\t\t$scope.imgStyle = {\r\n\t\t\t\"width\":screen.width\r\n\t\t}\r\n        $scope.swiperParams = {\r\n\t\t\thasSwiper:false,\r\n            showBefore:false,\r\n            showAfter:false\r\n        }\r\n\r\n\t\t// 页面初始化\r\n\t\t$scope.init =function(){\t\r\n\t\t\t$rootScope.hasBgColor = false;\t\r\n\t\t\t$scope.getQueryString();\r\n\t\t\t$scope.queryPost();\r\n\t\t\t$scope.queryMessage();\r\n\t\t\t$scope.initSwiper();\r\n\t\t}\r\n\r\n\t\t// 初始化图片轮播插件\r\n\t\t$scope.initSwiper = function(){\r\n\t\t\t//初始化swiper\r\n\t\t\tvar myswiper1 = new Swiper(\"#swiper1\",{\r\n\t\t\t\tloop:false,\r\n\t\t\t\tautoplayDisableOnInteraction:false,\r\n\t\t\t\tobserveParents:true,  \r\n\t\t\t\tobserver:true,\r\n\t\t\t})\r\n\r\n\t\t\tvar myswiper2 = new Swiper(\"#swiper2\",{\r\n\t\t\t\tloop:false,\r\n\t\t\t\tautoplayDisableOnInteraction:false,\r\n\t\t\t\tobserveParents:true,  \r\n\t\t\t\tobserver:true,\r\n\t\t\t})\r\n\t\t}\r\n\r\n        //切换预览显示\r\n        $scope.switchSwiper = function(item,has){\r\n\t\t\t$scope.swiperParams.hasSwiper = has;\r\n            if(item===\"before\"){\r\n                $scope.swiperParams.showBefore = has;\r\n            }\r\n            if(item===\"after\"){\r\n                $scope.swiperParams.showAfter = has;\r\n            }\r\n        }\r\n\r\n\t\t// 获取帖子id\r\n\t\t$scope.getQueryString = function(){\r\n\t\t\tif($location.search().id){\r\n\t\t\t\t$scope.postId = $location.search().id;\r\n\t\t\t\t$scope.queryParams.id = $location.search().id;\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/interaction\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 滚动监听\r\n\t\twindow.onscroll = function(){\r\n\t\t\tif($rootScope.loading||$scope.noProduct){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar body = document.body;\r\n\t\t\tvar html = document.documentElement;\r\n\t\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\t\tif(height>window.innerHeight){\r\n\t\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t\t$scope.loadNext();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载下一页数据\r\n\t\t$scope.loadNext = function(){\r\n\t\t\t$scope.queryParams.currentPage++;\r\n\t\t\t$scope.queryMessage();\r\n\t\t}\r\n\r\n\t\t// 获取帖子详细信息\r\n\t\t$scope.queryPost = function(){\r\n\t\t\tvar obj = {\r\n\t\t\t\tid:$scope.postId,\r\n\t\t\t}\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tobj.accessToken = Tool.userInfo.accessToken;\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/postDetail\",\r\n\t\t\t\tparams:obj\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.post = data.data;\r\n\t\t\t\t\tif($scope.post.faceImage!==null||$scope.post.faceImage!==\"\"){\r\n\t\t\t\t\t\t$scope.post.faceImage = \"https://biz.uokang.com/\"+$scope.post.faceImage;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.post.list1.length>0?$scope.post.hasList1=true:$scope.post.hasList1=false;\r\n\t\t\t\t\t$scope.post.list2.length>0?$scope.post.hasList2=true:$scope.post.hasList2=false;\r\n\t\t\t\t\tif(data.data.focusState===1){\r\n\t\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"帖子信息加载失败!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 查询评论信息\r\n\t\t$scope.queryMessage = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/postMessage\",\r\n\t\t\t\tparams:$scope.queryParams\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tif(data.data.commentList.length<1){\r\n\t\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.mergeMessage(data.data);\r\n\t\t\t\t\tif($scope.replyMess.commentList){\r\n\t\t\t\t\t\t$scope.replyMess.commentList =  $scope.replyMess.commentList.concat(data.data.commentList);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.replyMess = data.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 检查评论信息\r\n\t\t$scope.mergeMessage = function(post){\r\n\t\t\tpost.message = \"\";\r\n\t\t\tvar comment  = post.commentList;\r\n\t\t\tif($scope.replyMess.commentList){\r\n\t\t\t\tvar counts = $scope.replyMess.commentList.length;\r\n\t\t\t}else{\r\n\t\t\t\tvar counts = 0;\r\n\t\t\t}\r\n\t\t\tif(comment.length>0){\r\n\t\t\t\tfor(var outIndex in comment){\r\n\t\t\t\t\tvar reply = comment[outIndex];\r\n\t\t\t\t\treply.count = counts+1;\r\n\t\t\t\t\tcounts++;\r\n\t\t\t\t\treply.hasReplyInput = false;\r\n\t\t\t\t\treply.message = \"\";\r\n\t\t\t\t\tif(reply.createDateStr){\r\n\t\t\t\t\t\treply.createDateStr =  reply.createDateStr.trim();\r\n\t\t\t\t\t\treply.createDateStr = reply.createDateStr.slice(5,10);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(parseInt(reply.praiseNum)<1){\r\n\t\t\t\t\t\treply.praiseNum = \"点赞\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(reply.repliesMessageList.length>0){\r\n\t\t\t\t\t\treply.hasReply=true;\r\n\t\t\t\t\t\tvar replyList = reply.repliesMessageList;\r\n\t\t\t\t\t\tfor(var inIndex in replyList){\r\n\t\t\t\t\t\t\tvar replyListItem = replyList[inIndex];\r\n\t\t\t\t\t\t\tif(replyListItem.replyName==\"\"||replyListItem.replyName==null){\r\n\t\t\t\t\t\t\t\treplyListItem.isReply = false;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\treplyListItem.isReply = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treply.hasReply=false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 检查是否登录\r\n\t\t$scope.checkLogin = function(){\r\n\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\tTool.comfirm(\"请先登录！\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t\treturn false;\r\n\t\t\t}else{\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 点赞，flag:0->帖子,flag:1->评论\r\n\t\t$scope.thumb = function(id,flag){\r\n\t\t\tif($scope.checkLogin()){\r\n\t\t\t\tvar reply = \"\";\r\n\t\t\t\tif(flag==0){\r\n\t\t\t\t\treply = $scope.post;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var index in $scope.replyMess.commentList){\r\n\t\t\t\t\t\tif($scope.replyMess.commentList[index].id==id){\r\n\t\t\t\t\t\t\treply = $scope.replyMess.commentList[index];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/post/thumbUp\",\r\n\t\t\t\t\tparams:{postId:id,flag:flag},\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\taccessToken:Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\treply.praiseNum = data.data;\r\n\t\t\t\t\t}else if(data.code==1){\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 显示评论回复输入框\r\n\t\t$scope.showReplyInput = function(id,replyId,replyName){\r\n\t\t\tif($scope.checkLogin()){\r\n\t\t\t\tif($scope.showReplyInputId!=id){\r\n\t\t\t\t\tvar post = $scope.replyMess;\r\n\t\t\t\t\t$scope.messageId = id;\r\n\t\t\t\t\tif(replyId&&replyId!=Tool.userInfo.id){\r\n\t\t\t\t\t\t$scope.replyId = replyId;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif($scope.showReplyInputId==null){\r\n\t\t\t\t\t\tfor(var index in post.commentList){\r\n\t\t\t\t\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = true;\r\n\t\t\t\t\t\t\t\t$scope.inputStyle = \"输入你的回复...\";\r\n\t\t\t\t\t\t\t\tif(replyId && replyId != Tool.userInfo.id){\r\n\t\t\t\t\t\t\t\t\t$scope.inputStyle= \"回复 \"+replyName+\": \";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tfor(var index in post.commentList){\r\n\t\t\t\t\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = true;\r\n\t\t\t\t\t\t\t\t$scope.inputStyle = \"输入你的回复...\";\r\n\t\t\t\t\t\t\t\tif(replyId && replyId != Tool.userInfo.id){\r\n\t\t\t\t\t\t\t\t\t$scope.inputStyle = \"回复 \"+replyName+\": \";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(post.commentList[index].id==$scope.showReplyInputId){\r\n\t\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.showReplyInputId = id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 显示评论输入框\r\n\t\t$scope.showPostInput = function(){\r\n\t\t\tif($scope.checkLogin()){\r\n\t\t\t\tif($scope.showPostinput == false){\r\n\t\t\t\t\t$scope.showPostinput = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 隐藏评论输入框\r\n\t\t$scope.hidePostInput = function(){\r\n\t\t\tif($scope.showPostinput ==true){\r\n\t\t\t\t$scope.showPostinput = false;\r\n\t\t\t\t$scope.post.message = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 隐藏评论回复输入框\r\n\t\t$scope.hideReplyInput = function(id){\r\n\t\t\tvar post = $scope.replyMess;\r\n\t\t\tfor(var index in post.commentList){\r\n\t\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\t\tpost.commentList[index].hasReplyInput = false;\r\n\t\t\t\t\tpost.commentList[index].message = \"\";\r\n\t\t\t\t\t$scope.inputStyle= \"输入你的回复...\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif($scope.showReplyInputId){\r\n\t\t\t\t$scope.showReplyInputId = null;\r\n\t\t\t}\r\n\t\t\tif($scope.messageId){\r\n\t\t\t\t$scope.messageId = null; //评论id\r\n\t\t\t}\r\n\t\t\tif($scope.replyId){\r\n\t\t\t\t$scope.replyId = null; //被回复人id\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 发表评论\r\n\t\t$scope.sendPost = function(content){\r\n\t\t\tif(content==\"\"||content==null){\r\n\t\t\t\tTool.alert(\"消息为空!\");\r\n\t\t\t}else{\r\n\t\t\t\tvar params = {\r\n\t\t\t\t\tpostId:$scope.post.id,\r\n\t\t\t\t\treplyState:0,\r\n\t\t\t\t\tcontent:content,\r\n\t\t\t\t\tuserId:Tool.userInfo.id,\r\n\t\t\t\t}\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/repliesMessage/addRepliesMessage\",\r\n\t\t\t\t\tparams:params,\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.hidePostInput();\r\n\t\t\t\t\t\tdata.data.count = $scope.replyMess.commentList.length+1;\r\n\t\t\t\t\t\t$scope.mergeNewReply(data.data);\r\n\t\t\t\t\t\t$scope.replyMess.commentList.push(data.data);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"连接数据失败，请稍后重试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 检查新发表的评论信息\r\n\t\t$scope.mergeNewReply = function(reply){\r\n\t\t\tif(reply.userImage===null||reply.userImage===\"\"){\r\n\t\t\t\tvar user = Tool.getLocal(\"user\");\r\n\t\t\t\tif(user.sex===\"男\"||user.sex===\"\"||user.sex===null){\r\n\t\t\t\t\treply.userImage = \"../contents/img/men-head.png\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\treply.userImage = \"../contents/img/women-head.png\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 发表回复\r\n\t\t$scope.sendReply = function(content,id){\r\n\t\t\tif(content==\"\"||content==null){\r\n\t\t\t\tTool.alert($scope,\"消息为空！\");\r\n\t\t\t}else{\r\n\t\t\t\tvar params = {\r\n\t\t\t\t\tpostId:$scope.post.id,\r\n\t\t\t\t\treplyState:1,\r\n\t\t\t\t\tcontent:content,\r\n\t\t\t\t\tuserId:Tool.userInfo.id,\r\n\t\t\t\t\tmessageId:$scope.messageId,\r\n\t\t\t\t}\r\n\t\t\t\tif($scope.replyId){\r\n\t\t\t\t\tparams.replyId = $scope.replyId;\r\n\t\t\t\t}\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/repliesMessage/addRepliesMessage\",\r\n\t\t\t\t\tparams:params,\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.showReplyInputId = null;\r\n\t\t\t\t\t\t$scope.messageId = null; //评论id\r\n\t\t\t\t\t\t$scope.replyId = null; //被回复人id\r\n\t\t\t\t\t\t$scope.hideReplyInput(id);\r\n\t\t\t\t\t\tfor(var index in $scope.replyMess.commentList){\r\n\t\t\t\t\t\t\tif($scope.replyMess.commentList[index].id==id){\r\n\t\t\t\t\t\t\t\tif(data.data.replyName==\"\"||data.data.replyName==null){\r\n\t\t\t\t\t\t\t\t\tdata.data.isReply = false;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tdata.data.isReply = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$scope.replyMess.commentList[index].hasReply = true;\r\n\t\t\t\t\t\t\t\t$scope.replyMess.commentList[index].repliesMessageList.push(data.data);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"连接数据失败，请稍后重试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 关注按钮处理函数\r\n\t\t$scope.clickFollow = function(){\r\n\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\tTool.comfirm(\"请先登录!\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tif($scope.follow.hasFollow){\r\n\t\t\t\t\t$scope.cacelFollow();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.tofollow();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 关注发帖人\r\n\t\t$scope.tofollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/focus\",\r\n\t\t\t\tparams:{\r\n\t\t\t\t\tflag:1,\r\n\t\t\t\t\tuserId:$scope.post.userId\r\n\t\t\t\t},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 取消关注发帖人\r\n\t\t$scope.cacelFollow = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/post/cacelFocus\",\r\n\t\t\t\tparams:{\r\n\t\t\t\t\tflag:1,\r\n\t\t\t\t\tuserId:$scope.post.userId\r\n\t\t\t\t},\r\n\t\t\t\theaders:{\r\n\t\t\t\t\taccessToken:Tool.userInfo.accessToken\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.follow.hasFollow = false;\r\n\t\t\t\t\t$scope.follow.followText = \"关注\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"取消关注失败，稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"连接数据失败，稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 跳转到医生页面\r\n\t\t$scope.goDoctor = function(id){\r\n\t\t\tTool.changeRoute(\"/doctor/detail\",\"id=\"+id);\r\n\t\t}\r\n\r\n\t\t// 跳转到项目页面\r\n\t\t$scope.goProduct = function(productId,hospitalId){\r\n\t\t\tTool.changeRoute(\"/product/detail\",\"flag=1&productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}