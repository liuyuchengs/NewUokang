{"version":3,"sources":["examDetail.js"],"names":["define","$scope","$rootScope","$location","Tool","Ajax","productId","hospitalId","product","productItem","schedules","hospital","hospitalImg","noSchedule","noSelectTime","scheduleParams","filterParams","has","notice","order","doctorId","scheduleId","doctorName","treatmentTime","hospitalName","hospitalAddress","preferPrice","productName","flag","dealMoney","payMoney","realMoney","giftMoney","code","discountid","init","noWindowListen","loadParams","loadProduct","loadHospital","loadHopitalImg","loadProductItem","loadSchedule","item","select","back","window","history","search","post","url","host","params","then","data","length","mergeSchedule","alert","loading","items","index","scheduleid","val","dateStr","packageid","mergeProduct","title","preferPriceType","priceunit","pricetype","smallImg","id","mergeHospital","address","name","logo","type","mainId","selectTimeBtn","hasSelectTime","cancelTime","selectTime","detail","checkLogin","isUserInfoComplete","loadUserinfo","headers","accessToken","userInfo","parseFloat","setSession","changeRoute","comfirm","hasTip"],"mappings":"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","file":"examDetail.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,Tool,Ajax){\r\n\t\t$scope.productId = null;\r\n\t\t$scope.hospitalId = null;\r\n\t\t$scope.product = null;\r\n\t\t$scope.productItem = [];\r\n\t\t$scope.schedules = [];\r\n\t\t$scope.hospital = null;\r\n\t\t$scope.hospitalImg = null;\r\n\t\t$scope.noSchedule = false;\r\n\t\t$scope.noSelectTime = false;\r\n\t\t$scope.scheduleParams = {};\r\n\t\t$scope.filterParams = {\r\n\t\t\tproduct:{has:true},\r\n\t\t\thospital:{has:false},\r\n\t\t\tnotice:{has:false},\r\n\t\t}\r\n\t\t$scope.order = {\r\n\t\t\thospitalId:\"\",\r\n\t\t\tdoctorId:\"\",\r\n\t\t\tproductId:\"\",\r\n\t\t\tscheduleId:\"\",\r\n\t\t\tdoctorName:\"\",\r\n\t\t\ttreatmentTime:\"\",\r\n\t\t\thospitalName:\"\",\r\n\t\t\thospitalAddress:\"\",\r\n\t\t\tpreferPrice:\"\",\r\n\t\t\tproductName:\"\",\r\n\t\t\tflag:1,\r\n\t\t\tdealMoney:\"\",\r\n\t\t\tpayMoney:\"\",\r\n\t\t\trealMoney:\"\",\r\n\t\t\tgiftMoney:\"\",\r\n\t\t\tcode:null,\r\n\t\t\tdiscountid:null,\r\n\t\t}\r\n\r\n\t\t// 页面初始化\r\n\t\t$scope.init = function(){\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$scope.loadParams();\r\n\t\t\t$scope.loadProduct();\r\n\t\t\t$scope.loadHospital();\r\n\t\t\t$scope.loadHopitalImg();\r\n\t\t\t$scope.loadProductItem();\r\n\t\t\t$scope.loadSchedule();\r\n\t\t}\r\n\r\n\t\t// 切换导航条\r\n\t\t$scope.switch = function(item){\r\n\t\t\tTool.select(item,$scope.filterParams);\r\n\t\t}\r\n\r\n\t\t// 返回上一页\r\n\t\t$scope.back = function(){\r\n\t\t\twindow.history.back();\r\n\t\t}\r\n\r\n\t\t// 获取url参数\r\n\t\t$scope.loadParams = function(){\r\n\t\t\tif($location.search().productId){\r\n\t\t\t\t$scope.productId = $location.search().productId;\r\n\t\t\t\t$scope.order.productId = $scope.productId;\r\n\t\t\t}\r\n\t\t\tif($location.search().hospitalId){\r\n\t\t\t\t$scope.hospitalId = $location.search().hospitalId;\r\n\t\t\t\t$scope.order.hospitalId = $scope.hospitalId;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载排班信息\r\n\t\t$scope.loadSchedule = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/schedule/querybyhospitalid\",\r\n\t\t\t\tparams:{hospitalId:$scope.hospitalId},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.length>0){\r\n\t\t\t\t\t$scope.mergeSchedule(data);\r\n\t\t\t\t\t$scope.schedules = data;\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.noSchedule = true;\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"加载排班信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 保存排班信息\r\n\t\t$scope.mergeSchedule = function(items){\r\n\t\t\tfor(var index in items){\r\n\t\t\t\tvar item  = items[index];\r\n\t\t\t\tif(index==0){\r\n\t\t\t\t\t$scope.scheduleParams[item.scheduleid] = {\r\n\t\t\t\t\t\thas:true,\r\n\t\t\t\t\t\tval:item.dateStr,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.order.treatmentTime = item.dateStr;\r\n\t\t\t\t\t$scope.order.scheduleId = item.scheduleid;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.scheduleParams[item.scheduleid] = {\r\n\t\t\t\t\t\thas:false,\r\n\t\t\t\t\t\tval:item.dateStr,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载体检套餐信息\r\n\t\t$scope.loadProduct = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/product/packagedetal\",\r\n\t\t\t\tparams:{packageid:$scope.productId},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.mergeProduct(data.data);\r\n\t\t\t\t\t$scope.product = data.data;\r\n\t\t\t\t\t$scope.order.productName = $scope.product.title;\r\n\t\t\t\t\t$scope.order.preferPrice = $scope.product.preferPrice+$scope.product.preferPriceType;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"加载套餐信息失败，请稍后再试!\");\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"加载套餐信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 体检套餐为空时，使用默认图片\r\n\t\t$scope.mergeProduct = function(item){\r\n\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t}else{\r\n\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t}\r\n\t\t\tif(item.smallImg==\"\"||item.smallImg==null){\r\n\t\t\t\titem.smallImg = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载体检套餐的项目信息\r\n\t\t$scope.loadProductItem = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/product/packagedetalItem\",\r\n\t\t\t\tparams:{packageid:$scope.productId},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\t$scope.productItem = data;\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"加载体检项目失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading =false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 加载医院信息\r\n\t\t$scope.loadHospital = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/product/hospitalbyid\",\r\n\t\t\t\tparams:{id:$scope.hospitalId},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.mergeHospital(data.data);\r\n\t\t\t\t\t$scope.hospital = data.data;\r\n\t\t\t\t\t$scope.order.hospitalAddress = $scope.hospital.address;\r\n\t\t\t\t\t$scope.order.hospitalName = $scope.hospital.name;\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"加载医院信息失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 医院图片为空时，使用默认图片\r\n\t\t$scope.mergeHospital = function(item){\r\n\t\t\tif(item.logo==\"\"||item.logo==null){\r\n\t\t\t\titem.logo = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 加载医院图片\r\n\t\t$scope.loadHopitalImg = function(){\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/image/querybymainid\",\r\n\t\t\t\tparams:{type:\"HOSPITAL\",mainId:$scope.hospitalId},\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data[0].url==\"\"|data[0].url==null){\r\n\t\t\t\t\tdata[0].url = \"../contents/img/p_default.png\";\r\n\t\t\t\t}\r\n\t\t\t\t$scope.hospitalImg = data[0].url;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 打开选择时间按钮\r\n\t\t$scope.selectTimeBtn = function(){\r\n\t\t\tif(!$scope.noSchedule){\r\n\t\t\t\t$scope.hasSelectTime = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 取消选择时间\r\n\t\t$scope.cancelTime = function(){\r\n\t\t\t$scope.hasSelectTime = false;\r\n\t\t}\r\n\r\n\t\t// 选择时间\r\n\t\t$scope.selectTime = function(id){\r\n\t\t\tif(!$scope.noSchedule){\r\n\t\t\t\tTool.select(id,$scope.scheduleParams);\r\n\t\t\t\t$scope.order.treatmentTime = $scope.scheduleParams[id].val;\r\n\t\t\t\t$scope.order.scheduleId = id;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// 跳转到详细页面\r\n\t\t$scope.detail = function(){\r\n\t\t\tif(!Tool.checkLogin()){\r\n\t\t\t\tTool.comfirm(\"请先登录并完善个人信息!\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t})\r\n\t\t\t}else if(!Tool.isUserInfoComplete()){\r\n\t\t\t\tTool.comfirm(\"请完善个人信息!\",function(){\r\n\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\tTool.changeRoute(\"/user/userinfo\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/order/checkCodeMoney\",\r\n\t\t\t\t\tparams:{productId:$scope.order.productId},\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t$scope.order.dealMoney = data.dealMoney;\r\n\t\t\t\t\t$scope.order.payMoney = data.payMoney;\r\n\t\t\t\t\t$scope.order.realMoney = data.realMoney;\r\n\t\t\t\t\t$scope.order.giftMoney = data.giftMoney;\r\n\t\t\t\t\tif(parseFloat($scope.order.giftMoney)<=0){\r\n\t\t\t\t\t\t$scope.order.flag = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tTool.setSession(\"makeorder\",$scope.order);\r\n\t\t\t\t\tTool.changeRoute(\"/makeorder\");\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert($scope,\"加载App付款金额失败!\")\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}