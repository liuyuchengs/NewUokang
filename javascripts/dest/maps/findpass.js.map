{"version":3,"sources":["findpass.js"],"names":["define","$scope","$rootScope","$location","$interval","Tool","Ajax","phone","code","pwd","getPhone","search","getCodes","hasSendCode","codeText","sendCodes","angular","element","document","ready","noWindowListen","hasBgColor","checkPhone","test","post","url","host","params","name","param","then","data","changeRoute","alert","message","loading","checkCode","length","p","date","changePwd","password","hasTip","getCode","time","interval","cancel","mesage"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,WAAWC,UAAUC,UAAUC,KAAKC,MAC1DL,OAAOM,MAAQ,GACfN,OAAOO,KAAO,GACdP,OAAOQ,IAAM,GACbR,OAAOS,SAAWP,UAAUQ,SAASJ,OAAO,GAC5CN,OAAOW,SAAWT,UAAUQ,SAASH,MAAM,GAC3CP,OAAOY,aAAc,EACrBZ,OAAOa,SAAW,UAClBb,OAAOc,WAAY,EAEnBC,QAAQC,QAAQC,UAAUC,MAAM,WAC/Bd,KAAKe,iBACLlB,WAAWmB,YAAa,IAIzBpB,OAAOqB,WAAa,WAChB,sBAAsBC,KAAKtB,OAAOM,OACpCD,KAAKkB,MACJC,IAAIpB,KAAKqB,KAAK,kCACdC,QAAQC,KAAK,QAAQC,MAAM5B,OAAOM,SAChCuB,KAAK,SAASC,MACF,GAAXA,KAAKvB,KACPH,KAAK2B,YAAY,gBAAgB,SAAS/B,OAAOM,OAEjDF,KAAK4B,MAAMF,KAAKG,WAPlB5B,SASS,WACRD,KAAK4B,MAAM,qBAVZ3B,WAWW,WACVJ,WAAWiC,SAAS,IAGrB9B,KAAK4B,MAAM,gBAKbhC,OAAOmC,UAAY,WACfnC,OAAOc,UACc,GAApBd,OAAOO,KAAK6B,OACd/B,KAAKkB,MACJC,IAAIpB,KAAKqB,KAAK,kCACdC,QAAQC,KAAK,aAAaC,MAAM5B,OAAOO,KAAK8B,EAAErC,OAAOS,YACnDoB,KAAK,SAASC,MACF,GAAXA,KAAKvB,KACPH,KAAK2B,YAAY,eAAe,SAAS/B,OAAOS,SAAS,SAAST,OAAOO,MAEzEH,KAAK4B,MAAMM,KAAKL,WAPlB5B,SASS,WACRD,KAAK4B,MAAM,YAVZ3B,WAWW,WACVJ,WAAWiC,SAAS,IAGrB9B,KAAK4B,MAAM,YAGZ5B,KAAK4B,MAAM,YAKbhC,OAAOuC,UAAY,WACfvC,OAAOQ,IAAI4B,QAAQ,GAAGpC,OAAOQ,IAAI4B,QAAQ,IAC3C/B,KAAKkB,MACJC,IAAIpB,KAAKqB,KAAK,yBACdC,QAAQpB,MAAMN,OAAOS,SAASF,KAAKP,OAAOW,SAAS6B,SAASxC,OAAOQ,OACjEqB,KAAK,SAASC,MACF,GAAXA,KAAKvB,KACPH,KAAK4B,MAAM,UAAU,WACpB/B,WAAWwC,QAAS,EACpBrC,KAAK2B,YAAY,YAGlB3B,KAAK4B,MAAMF,KAAKG,WAVlB5B,SAYS,WACRD,KAAK4B,MAAM,mBAbZ3B,WAcW,WACVJ,WAAWiC,SAAS,KAMvBlC,OAAO0C,QAAU,WACZ1C,OAAOY,aACVP,KAAKkB,MACJC,IAAIpB,KAAKqB,KAAK,mCACdC,QAAQpB,MAAMN,OAAOS,YACnBoB,KAAK,SAASC,MAChB,GAAc,GAAXA,KAAKvB,KAAQ,CACfP,OAAOY,aAAc,EACrBZ,OAAOc,WAAY,CACnB,IAAI6B,MAAO,GACPC,SAAWzC,UAAU,WACxBH,OAAOa,SAAY8B,KAAK,KACxBA,QACC,IAAK,IAAId,KAAK,WACf7B,OAAOa,SAAW,UAClBb,OAAOY,aAAc,EACrBT,UAAU0C,OAAOD,gBAGlBxC,MAAK4B,MAAMF,KAAKgB,UAjBlBzC,SAmBS,WACRD,KAAK4B,MAAM,oBApBZ3B,WAqBW,WACVJ,WAAWiC,SAAS","file":"findpass.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,$interval,Tool,Ajax){\r\n\t\t$scope.phone = \"\"; //手机号码\r\n\t\t$scope.code = \"\"; //验证码\r\n\t\t$scope.pwd = \"\"; //密码\r\n\t\t$scope.getPhone = $location.search().phone||\"\"; //跳转页面缓存手机号码\r\n\t\t$scope.getCodes = $location.search().code||\"\"; //跳转页面缓存验证码\r\n\t\t$scope.hasSendCode = false; //是否是发送验证码状态\r\n\t\t$scope.codeText = \"获取短信验证码\";\r\n\t\t$scope.sendCodes = false;\r\n\t\t\r\n\t\tangular.element(document).ready(function(){\r\n\t\t\tTool.noWindowListen();\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t})\r\n\r\n\t\t// 检测手机号码是否有注册\r\n\t\t$scope.checkPhone = function(){\r\n\t\t\tif(/^1[3|4|5|7|8]\\d{9}$/.test($scope.phone)){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/findpass/findPassPhontCheck\",\r\n\t\t\t\t\tparams:{name:\"phone\",param:$scope.phone}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.changeRoute(\"/findpwd/code\",\"phone=\"+$scope.phone);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"检查手机号码失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"请输入正确的手机号码!\");\r\n\t\t\t}\t\t\r\n\t\t}\r\n\r\n\t\t// 检测验证码是否正确\r\n\t\t$scope.checkCode = function(){\r\n\t\t\tif($scope.sendCodes){\r\n\t\t\t\tif($scope.code.length==4){\r\n\t\t\t\t\tAjax.post({\r\n\t\t\t\t\t\turl:Tool.host+\"/wx/findpass/findPassPhontCheck\",\r\n\t\t\t\t\t\tparams:{name:\"verifyCode\",param:$scope.code,p:$scope.getPhone},\r\n\t\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/findpwd/pwd\",\"phone=\"+$scope.getPhone+\"&code=\"+$scope.code);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tTool.alert(date.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(function(){\r\n\t\t\t\t\t\tTool.alert(\"验证码错误!\");\r\n\t\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请输入4位验证码\");\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"请先获取验证码\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 修改密码\r\n\t\t$scope.changePwd = function(){\r\n\t\t\tif($scope.pwd.length>=8&&$scope.pwd.length<=20){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/findpass/changepwd\",\r\n\t\t\t\t\tparams:{phone:$scope.getPhone,code:$scope.getCodes,password:$scope.pwd}\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.alert(\"密码修改成功!\",function(){\r\n\t\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/login\");\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"密码修改失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 发送短信验证码\r\n\t\t$scope.getCode = function(){\r\n\t\t\tif(!$scope.hasSendCode){\r\n\t\t\t\tAjax.post({\r\n\t\t\t\t\turl:Tool.host+\"/wx/findpass/sendsmsfindpasscode\",\r\n\t\t\t\t\tparams:{phone:$scope.getPhone},\r\n\t\t\t\t}).then(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t$scope.hasSendCode = true;\r\n\t\t\t\t\t\t$scope.sendCodes = true;\r\n\t\t\t\t\t\tvar time = 59;\r\n\t\t\t\t\t\tvar interval = $interval(function(){\r\n\t\t\t\t\t\t\t$scope.codeText = (time+\" S\");\r\n\t\t\t\t\t\t\ttime--;\r\n\t\t\t\t\t\t},1000,60).then(function(){\r\n\t\t\t\t\t\t\t$scope.codeText = \"获取短信验证码\";\r\n\t\t\t\t\t\t\t$scope.hasSendCode = false;\r\n\t\t\t\t\t\t\t$interval.cancel(interval);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert(data.mesage);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(function(){\r\n\t\t\t\t\tTool.alert(\"发送验证码失败，请稍后再试!\");\r\n\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t$rootScope.loading =false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}