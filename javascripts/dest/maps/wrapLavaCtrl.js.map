{"version":3,"sources":["wrapLavaCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","productInfo","noProduct","noProductText","loading","queryParams","flag","city","area","professionId","itemId","currentPage","init","loadHost","loadGift","url","host","params","convertParams","post","headers","Content-type","success","data","code","length","mergeProdcut","concat","alert","message","error","items","forEach","item","priceunit","preferPriceType","pricetype","samllimg","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","detail","proId","hospitalId","path","itemState","goPage","question"],"mappings":"AAAAA,IAAIC,WAAW,gBAAgB,SAAS,QAAQ,OAAO,OAAO,SAASC,OAAOC,MAAMC,KAAKC,MACxFH,OAAOI,eACPJ,OAAOK,WAAY,EACnBL,OAAOM,cAAgB,GACvBN,OAAOO,SAAU,EACjBP,OAAOQ,aACNC,KAAK,EACLC,KAAK,KACLC,KAAK,GACLC,aAAa,IACbC,OAAO,GACPC,YAAY,GAIbd,OAAOe,KAAO,WACbZ,KAAKa,SAAShB,OAAO,WACpBA,OAAOiB,cAKTjB,OAAOiB,SAAW,WACjBjB,OAAOO,SAAU,CACjB,IAAIW,KAAMlB,OAAOmB,KAAK,0BAClBC,OAASlB,KAAKmB,cAAcrB,OAAOQ,YACvCP,OAAMqB,KAAKJ,IAAIE,QACdG,SACGC,eAAe,qDAEhBC,QAAQ,SAASC,MACL,GAAXA,KAAKC,KACJD,KAAKA,KAAKE,OAAO,GAChB5B,OAAOI,YAAYwB,OAAO,EAC5B5B,OAAOM,cAAgB,sBAEvBN,OAAOM,cAAgB,WAExBN,OAAOK,WAAY,IAEnBL,OAAO6B,aAAaH,KAAKA,MACzB1B,OAAOI,YAAcJ,OAAOI,YAAY0B,OAAOJ,KAAKA,OAGrDxB,KAAK6B,MAAM/B,OAAO0B,KAAKM,SAExBhC,OAAOO,SAAU,IACf0B,MAAM,WACRjC,OAAOK,WAAY,EACnBH,KAAK6B,MAAM/B,OAAO,mBAClBA,OAAOO,SAAU,KAMnBP,OAAO6B,aAAe,SAASK,OAC9BA,MAAMC,QAAQ,SAASC,MACH,MAAhBA,KAAKC,WAAiC,IAAhBD,KAAKC,UAC7BD,KAAKE,gBAAkBF,KAAKG,UAAU,IAAIH,KAAKC,UAE/CD,KAAKE,gBAAkBF,KAAKG,UAEX,IAAfH,KAAKI,UAA6B,MAAfJ,KAAKI,WAC1BJ,KAAKI,SAAW,oCAMnBC,OAAOC,SAAW,WACjB,IAAG1C,OAAOO,UAASP,OAAOK,UAA1B,CAGA,GAAIsC,MAAOC,SAASD,KACbE,KAAOD,SAASE,gBACnBC,OAASC,KAAKC,IAAKN,KAAKO,aAAcP,KAAKQ,aAAaN,KAAKO,aAAcP,KAAKK,aAAcL,KAAKM,aACpGJ,QAAON,OAAOY,aACZN,OAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClDrD,OAAOuD,aAMVvD,OAAOuD,SAAW,WACjBvD,OAAOQ,YAAYM,cACnBd,OAAOiB,YAIRjB,OAAOwD,OAAS,SAASC,MAAMC,YAC9B,GAAIC,MAAO,6CAA6CF,MAAM,eAAeC,UACxD,aAAlB1D,OAAO4D,UACTD,MAAQ,YACoB,SAApB3D,OAAO4D,YACfD,MAAQ,2BAETzD,KAAK2D,OAAOF,OAIb3D,OAAO8D,SAAW,WACjB5D,KAAK6B,MAAM/B,OAAO","file":"wrapLavaCtrl.js","sourcesContent":["app.controller(\"wrapLavaCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.productInfo = [];\r\n\t$scope.noProduct = false;\r\n\t$scope.noProductText = \"\";\r\n\t$scope.loading = false;\r\n\t$scope.queryParams = {\r\n\t\tflag:3,\r\n\t\tcity:\"深圳\",\r\n\t\tarea:\"\",\r\n\t\tprofessionId:\"2\",\r\n\t\titemId:\"\",\r\n\t\tcurrentPage:1,\r\n\t}\r\n\r\n\t//初始化页面\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loadGift();\r\n\t\t})\r\n\t}\r\n\r\n\t//获取项目信息\r\n\t$scope.loadGift = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar url = $scope.host+\"/wx/product/queryByMidd\";\r\n\t\tvar params = Tool.convertParams($scope.queryParams);\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders: {\r\n\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t }\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\tif($scope.productInfo.length<1){\r\n\t\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t$scope.productInfo = $scope.productInfo.concat(data.data);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.noProduct = true;\r\n\t\t\tTool.alert($scope,\"获取项目信息失败，请稍后再试!\");\r\n\t\t\t$scope.loading = false;\r\n\t\t})\r\n\r\n\t}\r\n\r\n\t//处理项目信息\r\n\t$scope.mergeProdcut = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t}else{\r\n\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t}\r\n\t\t\tif(item.samllimg==\"\"||item.samllimg==null){\r\n\t\t\t\titem.samllimg = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//滚动监听\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t    var html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 加载下一页\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.queryParams.currentPage++;\r\n\t\t$scope.loadGift();\r\n\t}\r\n\r\n\t// 跳转到项目详细信息\r\n\t$scope.detail = function(proId,hospitalId){\r\n\t\tvar path = \"/new/htmls/product-detail.html#?productId=\"+proId+\"&hospitalId=\"+hospitalId;\r\n\t\tif($scope.itemState==\"discount\"){\r\n\t\t\tpath += \"&code=123\";\r\n\t\t}else if($scope.itemState == \"month\"){\r\n\t\t\tpath += \"&discountid=123&flag=11\";\r\n\t\t}\r\n\t\tTool.goPage(path);\r\n\t}\r\n\r\n\t// 疑问按钮处理函数\r\n\t$scope.question = function(){\r\n\t\tTool.alert($scope,\"如有疑问，请致电0755-26905699\");\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}