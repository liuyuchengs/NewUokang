{"version":3,"sources":["userInfoChange.js"],"names":["define","$scope","$rootScope","$location","$timeout","$http","Ajax","Tool","title","tip","val","hasImg","input","has","url","sexparams","men","women","payParams","flag","state","account","accessToken","titleParams","realname","sex","phone","age","nickname","wxpay","alipay","tipParams","listen","$","on","getUrl","this","files","$apply","choosePic","click","obj","undefined","window","createObjectURL","URL","webkitURL","removePic","element","document","getElementById","outerHTML","change","check","item","userInfo","post","host","params","then","data","code","setLocal","alert","hasTip","changeRoute","loading","infoData","FormData","append","get","Blob","type","headers","Content-Type","success","message","error","length","test","parseInt","select","value","back","angular","ready","hasBgColor","noWindowListen","checkLogin","loadUserinfo","search","hassex","hasinput"],"mappings":"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","file":"userInfoChange.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,$location,$timeout,$http,Ajax,Tool){\r\n\t\t$scope.title;\r\n\t\t$scope.tip;\r\n\t\t$scope.val=\"\";\r\n\t\t$scope.hasImg = false;\r\n\t\t$scope.input = {\r\n\t\t\thas:false,\r\n\t\t\turl:null\r\n\t\t}\r\n\t\t$scope.sexparams={\r\n\t\t\tmen:true,\r\n\t\t\twomen:false\r\n\t\t}\r\n\t\t$scope.payParams = {\r\n\t\t\tflag:null,\r\n\t\t\tstate:null,\r\n\t\t\taccount:null,\r\n\t\t\taccessToken:null,\r\n\t\t}\r\n\t\t$scope.titleParams = {\r\n\t\t\t\"realname\":\"真实姓名\",\r\n\t\t\t\"sex\":\"选择性别\",\r\n\t\t\t\"phone\":\"手机号码\",\r\n\t\t\t\"age\":\"年龄\",\r\n\t\t\t\"nickname\":\"昵称\",\r\n\t\t\t\"wxpay\":\"账号\",\r\n\t\t\t\"alipay\":\"账号\"\r\n\t\t}\r\n\t\t$scope.tipParams = {\r\n\t\t\t\"realname\":\"请填写姓名\",\r\n\t\t\t\"sex\":\"请填写性别\",\r\n\t\t\t\"phone\":\"请填写手机号码\",\r\n\t\t\t\"age\":\"请填写年龄\",\r\n\t\t\t\"nickname\":\"请填写昵称\",\r\n\t\t\t\"wxpay\":\"请填写微信账号\",\r\n\t\t\t\"alipay\":\"请填写支付宝账号\",\r\n\t\t}\r\n\r\n\t\t//监听input\r\n\t\t$scope.listen = function(){\r\n\t\t\t$(\"#input1\").on(\"change\",function(){\r\n\t\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t\t$scope.input.has = true;\r\n\t\t\t\t$scope.input.url = url;\r\n\t\t\t\t$scope.$apply();\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t//选择图片\r\n\t\t$scope.choosePic = function(){\r\n\t\t\t$timeout(function(){\r\n\t\t\t\t$(\"#input1\").click();\r\n\t\t\t},0)\r\n\t\t}\r\n\r\n\t\t// 获取input元素图片的url，做图片预览\r\n\t\t$scope.getUrl = function(obj){\r\n\t\t\tvar url = null;\r\n\t\t\tif (window.createObjectURL != undefined) { // basic\r\n\t\t\t\turl = window.createObjectURL(obj);\r\n\t\t\t} else if (window.URL != undefined) { // mozilla(firefox)\r\n\t\t\t\turl = window.URL.createObjectURL(obj);\r\n\t\t\t} else if (window.webkitURL != undefined) { // webkit or chrome\r\n\t\t\t\turl = window.webkitURL.createObjectURL(obj);\r\n\t\t\t}\r\n\t\t\treturn url;\r\n\t\t}\r\n\r\n\t\t//删除选定图片\r\n\t\t$scope.removePic = function(){\r\n\t\t\t$scope.input.has = false;\r\n\t\t\t$scope.input.url = \"\";\r\n\t\t\tvar element = document.getElementById(\"input1\");\r\n\t\t\telement.outerHTML = element.outerHTML;\r\n\t\t\t$scope.listen(); \r\n\t\t}\r\n\r\n\t\t//修改信息\r\n\t\t$scope.change = function(){\r\n\t\t\tif($scope.check()){\r\n\t\t\t\tif($scope.item===\"wxpay\"||$scope.item===\"alipay\"){\r\n\t\t\t\t\t$scope.payParams.account = $scope.val;\r\n\t\t\t\t\t$scope.payParams.accessToken = Tool.userInfo.accessToken;\r\n\t\t\t\t\tAjax.post({\r\n\t\t\t\t\t\turl:Tool.host+\"/wx/withDraw/bound\",\r\n\t\t\t\t\t\tparams:$scope.payParams,\r\n\t\t\t\t\t}).then(function(data){\r\n\t\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t\tif($scope.payParams.flag==1){\r\n\t\t\t\t\t\t\t\tTool.userInfo.alipay = $scope.val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif($scope.payParams.flag==2){\r\n\t\t\t\t\t\t\t\tTool.userInfo.wxpay = $scope.val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tTool.setLocal(\"user\",Tool.userInfo);\r\n\t\t\t\t\t\t\tTool.alert(\"绑定成功!\",function(){\r\n\t\t\t\t\t\t\t\t$rootScope.hasTip = false;\r\n\t\t\t\t\t\t\t\tTool.changeRoute(\"/user/userinfo\");\r\n\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tTool.alert(\"绑定失败,请稍后再试!\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(function(){\r\n\t\t\t\t\t\tTool.alert(\"绑定失败，请稍后再试！\");\r\n\t\t\t\t\t}).finally(function(){\r\n\t\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$rootScope.loading = true;\r\n\t\t\t\t\tvar infoData = new FormData();\r\n\t\t\t\t\tvar url = Tool.host+\"/wx/mycount/updateUserInfo\";\r\n\t\t\t\t\tinfoData.append(\"name\",$scope.item);\r\n\t\t\t\t\tinfoData.append(\"val\",$scope.val);\r\n\t\t\t\t\tif($scope.input.has){\r\n\t\t\t\t\t\tinfoData.append(\"headImage\",$(\"#input1\").get(0).files[0]);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tinfoData.append(\"headImage\",new Blob([\"\"],{type:\"image/jpeg\"}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$http.post(url,infoData,{\r\n\t\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\t\"accessToken\":Tool.userInfo.accessToken,\r\n\t\t\t\t\t\t\t\"Content-Type\":undefined,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).success(function(data){\r\n\t\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\t\tTool.setLocal(\"user\",data.data);\r\n\t\t\t\t\t\t\tTool.changeRoute(\"/user/userinfo\");\r\n\t\t\t\t\t\t}else if(data.code==1){\r\n\t\t\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).error(function(){\r\n\t\t\t\t\t\t$rootScope.loading = false;\r\n\t\t\t\t\t\tTool.alert(\"数据更新失败!\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//检查内容是否符合要求\r\n\t\t$scope.check = function(){\r\n\t\t\tif($scope.val.length==0){\r\n\t\t\t\tTool.alert(\"填写内容为空！\");\r\n\t\t\t\treturn false;\r\n\t\t\t}else if($scope.item==\"realname\"|$scope.item==\"nickname\"){\r\n\t\t\t\tif($scope.val.length>1&$scope.val.length<10){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请输入正确长度的名称！\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}else if($scope.item==\"sex\"){\r\n\t\t\t\tif($scope.val==\"男\"||$scope.val==\"女\"){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请输入正确的性别！\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}else if($scope.item==\"phone\"){\r\n\t\t\t\tif(/^1[3|4|5|7|8]\\d{9}$/.test($scope.val)){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请输入正确的手机号码!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}else if($scope.item==\"age\"){\r\n\t\t\t\tif(parseInt($scope.val)>0&&parseInt($scope.val)<150){\r\n\t\t\t\t\t$scope.val = parseInt($scope.val);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请输入正确的年龄!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}else if($scope.item==\"wxpay\"||$scope.item==\"alipay\"){\r\n\t\t\t\tif($scope.val.length<3){\r\n\t\t\t\t\tTool.alert(\"长度过低!\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}else if($scope.item==\"img\"){\r\n\t\t\t\tif($scope.input.has){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(\"请选择照片\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert(\"未识别需要修改的项目,请稍后再试!\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//选择性别\r\n\t\t$scope.select = function(value){\r\n\t\t\tif(value==\"男\"){\r\n\t\t\t\tif(!$scope.sexparams.men){\r\n\t\t\t\t\t$scope.sexparams.men = true;\r\n\t\t\t\t\t$scope.sexparams.women = false;\r\n\t\t\t\t\t$scope.val = \"男\";\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}else if(value=\"女\"){\r\n\t\t\t\tif(!$scope.sexparams.women){\r\n\t\t\t\t\t$scope.sexparams.men = false;\r\n\t\t\t\t\t$scope.sexparams.women = true;\r\n\t\t\t\t\t$scope.val = \"女\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//返回按钮\r\n\t\t$scope.back = function(){\r\n\t\t\tTool.changeRoute(\"/user/userinfo\");\r\n\t\t}\r\n\t\t\r\n\t\t//页面初始化\r\n\t\tangular.element(document).ready(function(){\r\n\t\t\t$rootScope.hasBgColor = true;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tif(Tool.checkLogin()){\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\t$scope.item = $location.search().item;\r\n\t\t\t\t$scope.title = $scope.titleParams[$scope.item];\r\n\t\t\t\t$scope.tip = $scope.tipParams[$scope.item];\r\n\t\t\t\tTool.loadUserinfo();\r\n\t\t\t\tif($scope.item==\"sex\"){\r\n\t\t\t\t\t$scope.hassex = true;\r\n\t\t\t\t\t$scope.val = \"男\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.hasinput = true;\r\n\t\t\t\t}\r\n\t\t\t\tif($scope.item===\"img\"){\r\n\t\t\t\t\t$scope.hasImg = true;\r\n\t\t\t\t\t$scope.val = \"img\";\r\n\t\t\t\t\t$scope.listen();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.hasImg = false;\r\n\t\t\t\t}\r\n\t\t\t\tif($scope.item===\"wxpay\"){\r\n\t\t\t\t\t$scope.payParams.flag = 2;\r\n\t\t\t\t}\r\n\t\t\t\tif($scope.item===\"alipay\"){\r\n\t\t\t\t\t$scope.payParams.flag = 1;\r\n\t\t\t\t}\r\n\t\t\t\tif($location.search().state){\r\n\t\t\t\t\t$scope.payParams.state = $location.search().state;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tTool.changeRoute(\"/user\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t}\r\n})\r\n"],"sourceRoot":"/source/"}