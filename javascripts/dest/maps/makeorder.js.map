{"version":3,"sources":["makeorder.js"],"names":["define","$scope","$rootScope","Tool","Ajax","hasCheck","hasGift","noUserInfo","giftText","orderInfo","getSession","patientName","getLocal","realname","patientTelephone","phone","userInfo","hasDoctor","init","hasBgColor","noWindowListen","loadUserinfo","checkGift","selectCush","payMoney","parseFloat","giftMoney","flag","toFixed","doctorName","makeorder","params","productId","scheduleId","dealMoney","realMoney","code","post","url","host","headers","accessToken","then","data","removeSession","setSession","appid","redirect_uri","href","goUrl","alert","message","loading","back","window","history"],"mappings":"AAAAA,OAAO,WACN,MAAO,UAASC,OAAOC,WAAWC,KAAKC,MACtCH,OAAOI,UAAW,EAClBJ,OAAOK,SAAU,EACjBL,OAAOM,YAAa,EACpBN,OAAOO,SAAW,YAClBP,OAAOQ,UAAYN,KAAKO,WAAW,aACnCT,OAAOQ,UAAUE,YAAcR,KAAKS,SAAS,QAAQC,SACrDZ,OAAOQ,UAAUK,iBAAmBX,KAAKS,SAAS,QAAQG,MAC1Dd,OAAOe,SACPf,OAAOgB,WAAY,EAGnBhB,OAAOiB,KAAO,WACbhB,WAAWiB,YAAa,EACxBhB,KAAKiB,iBACLjB,KAAKkB,eACLpB,OAAOqB,aAIRrB,OAAOsB,WAAa,WACnB,GAAGtB,OAAOK,QAAQ,CACjBL,OAAOI,UAAYJ,OAAOI,QAC1B,IAAImB,UAAWC,WAAWxB,OAAOQ,UAAUe,UACvCE,UAAYD,WAAWxB,OAAOQ,UAAUiB,UACzCzB,QAAOI,SACTJ,OAAOQ,UAAUe,SAAWA,SAAWE,WAEvCzB,OAAOQ,UAAUe,SAAWA,SAAWE,UACvCzB,OAAOQ,UAAUkB,KAAK,MAEvB1B,OAAOQ,UAAUe,SAASI,QAAQ,KAKpC3B,OAAOqB,UAAY,WACfG,WAAWxB,OAAOQ,UAAUiB,WAAW,IACzCzB,OAAOI,UAAW,EAClBJ,OAAOK,SAAU,EACjBL,OAAOO,SAAW,cAEa,IAA7BP,OAAOQ,UAAUoB,YAA6C,MAA7B5B,OAAOQ,UAAUoB,aACpD5B,OAAOgB,WAAY,IAKrBhB,OAAO6B,UAAY,WAClB,GAAIC,SACHC,UAAW/B,OAAOQ,UAAUuB,UAC5BC,WAAYhC,OAAOQ,UAAUwB,WAC7BtB,YAAaV,OAAOQ,UAAUE,YAC9BG,iBAAkBb,OAAOQ,UAAUK,iBACnCoB,UAAUjC,OAAOQ,UAAUyB,UAC3BC,UAAUlC,OAAOQ,UAAU0B,UAC3BX,SAASvB,OAAOQ,UAAUe,SAGxBvB,QAAOQ,UAAU2B,OACnBL,OAAOK,KAAOnC,OAAOQ,UAAU2B,MAG7BnC,OAAOQ,UAAUkB,OACnBI,OAAOJ,KAAO1B,OAAOQ,UAAUkB,MAEhCvB,KAAKiC,MACJC,IAAInC,KAAKoC,KAAK,iBACdR,OAAOA,OACPS,SACCC,YAActC,KAAKa,SAASyB,eAE3BC,KAAK,SAASC,MAChB,GAAc,GAAXA,KAAKP,KAAQ,CACfjC,KAAKyC,cAAc,aACnBzC,KAAK0C,WAAW,QAAQF,KAAKA,KAC7B,IAAIG,OAAQ,qBACRC,aAAe5C,KAAKoC,KAAK,sBACzBS,KAAO,6DAA6DF,MAAM,iBAAiBC,aAAa,oEAC5G5C,MAAK8C,MAAMD,UAEX7C,MAAK+C,MAAMP,KAAKQ,WAflB/C,SAiBS,WACRD,KAAK+C,MAAM,mBAlBZ9C,WAmBW,WACVF,WAAWkD,SAAU,KAKvBnD,OAAOoD,KAAO,WACbC,OAAOC,QAAQF","file":"makeorder.js","sourcesContent":["define(function(){\r\n\treturn function($scope,$rootScope,Tool,Ajax){\r\n\t\t$scope.hasCheck = false;\r\n\t\t$scope.hasGift = false;\r\n\t\t$scope.noUserInfo = true;\r\n\t\t$scope.giftText = \"本订单无可用代金券\";\r\n\t\t$scope.orderInfo = Tool.getSession(\"makeorder\");\r\n\t\t$scope.orderInfo.patientName = Tool.getLocal(\"user\").realname;\r\n\t\t$scope.orderInfo.patientTelephone = Tool.getLocal(\"user\").phone;\r\n\t\t$scope.userInfo;\r\n\t\t$scope.hasDoctor = true;\r\n\r\n\t\t// 页面初始化\r\n\t\t$scope.init = function(){\r\n\t\t\t$rootScope.hasBgColor = false;\r\n\t\t\tTool.noWindowListen();\r\n\t\t\tTool.loadUserinfo();\r\n\t\t\t$scope.checkGift();\r\n\t\t}\r\n\r\n\t\t// 是否使用代金券\r\n\t\t$scope.selectCush = function(){\r\n\t\t\tif($scope.hasGift){\r\n\t\t\t\t$scope.hasCheck = !$scope.hasCheck;\r\n\t\t\t\tvar payMoney = parseFloat($scope.orderInfo.payMoney);\r\n\t\t\t\tvar giftMoney = parseFloat($scope.orderInfo.giftMoney);\r\n\t\t\t\tif($scope.hasCheck){\r\n\t\t\t\t\t$scope.orderInfo.payMoney = payMoney - giftMoney;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.orderInfo.payMoney = payMoney + giftMoney;\r\n\t\t\t\t\t$scope.orderInfo.flag=null;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.orderInfo.payMoney.toFixed(1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 判定是否有代金券可用\r\n\t\t$scope.checkGift = function(){\r\n\t\t\tif(parseFloat($scope.orderInfo.giftMoney)>0){\r\n\t\t\t\t$scope.hasCheck = true;\r\n\t\t\t\t$scope.hasGift = true;\r\n\t\t\t\t$scope.giftText = \"本订单可使用代金券￥\";\r\n\t\t\t}\r\n\t\t\tif($scope.orderInfo.doctorName==\"\"||$scope.orderInfo.doctorName==null){\r\n\t\t\t\t$scope.hasDoctor = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 下单按钮\r\n\t\t$scope.makeorder = function(){\r\n\t\t\tvar params = {\r\n\t\t\t\tproductId: $scope.orderInfo.productId,\r\n\t\t\t\tscheduleId: $scope.orderInfo.scheduleId,\r\n\t\t\t\tpatientName: $scope.orderInfo.patientName,\r\n\t\t\t\tpatientTelephone: $scope.orderInfo.patientTelephone,\r\n\t\t\t\tdealMoney:$scope.orderInfo.dealMoney,\r\n\t\t\t\trealMoney:$scope.orderInfo.realMoney,\r\n\t\t\t\tpayMoney:$scope.orderInfo.payMoney,\r\n\t\t\t}\r\n\t\t\t//特惠专区传入任意code\r\n\t\t\tif($scope.orderInfo.code){\r\n\t\t\t\tparams.code = $scope.orderInfo.code;\r\n\t\t\t}\r\n\t\t\t//使用代金券flag=1,不使用不传入flag\r\n\t\t\tif($scope.orderInfo.flag){\r\n\t\t\t\tparams.flag = $scope.orderInfo.flag;\r\n\t\t\t}\r\n\t\t\tAjax.post({\r\n\t\t\t\turl:Tool.host+\"/wx/order/make\",\r\n\t\t\t\tparams:params,\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'accessToken':Tool.userInfo.accessToken\r\n\t\t\t\t}\r\n\t\t\t}).then(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tTool.removeSession(\"makeorder\");\r\n\t\t\t\t\tTool.setSession(\"order\",data.data);\r\n\t\t\t\t\tvar appid = \"wx0229404bc9eeea00\";\r\n\t\t\t\t\tvar redirect_uri = Tool.host+\"/v2/htmls/temp.html\";\r\n\t\t\t\t\tvar href = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+appid+\"&redirect_uri=\"+redirect_uri+\"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect\";\r\n\t\t\t\t\tTool.goUrl(href);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert(data.message);\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(){\r\n\t\t\t\tTool.alert(\"创建订单失败，请稍后再试!\");\r\n\t\t\t}).finally(function(){\r\n\t\t\t\t$rootScope.loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 返回按钮\r\n\t\t$scope.back = function(){\r\n\t\t\twindow.history.back();\r\n\t\t}\r\n\t}\r\n})"],"sourceRoot":"/source/"}