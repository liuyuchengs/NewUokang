app.controller("doctorDetailCtrl",["$scope","$http","$location","Ajax","Tool",function($scope,$http,$location,Ajax,Tool){
	$scope.hasTime = false;
	$scope.hasProduct = false;
	$scope.hasShowDescription = false;
	$scope.btnValue = "查看全部";
	$scope.id = null;
	$scope.doctorInfo = {};
	/**
	** 初始化页面
	*/
	$scope.init = function(){
		Ajax.loadHost($scope,function(){
			$scope.getParams();
			$scope.queryDoctor();
			$scope.initSwiper();
		})
	}

	/**
	* 初始化swiper
	*/
	$scope.initSwiper = function(){
		$scope.mySwiper = new Swiper('.swiper-container', {
			slidesPerView : 3,
			slidesPerGroup : 3,
		})
	}

	/**
	** swiper跳转到指定页
	*/
	$scope.toPage = function(params){
		if(params==="per"){
			$scope.mySwiper.slidePrev();
		}
		if(params==="next"){
			$scope.mySwiper.slideNext();
		}
	}

	$scope.selectTime = function(){
		$scope.hasTime = !$scope.hasTime;
	}

	$scope.selectProduct = function(){
		$scope.hasProduct = !$scope.hasProduct;
	}

	$scope.getParams = function(){
		if($location.search().id){
			$scope.id = $location.search().id;
		}else{
			Tool.goPage("/new/htmls/doctor.html");
		}
	}

	/**
	* 收起和隐藏医生简介
	*/
	$scope.showDescription = function(){
		$scope.hasShowDescription = !$scope.hasShowDescription;
		if($scope.hasShowDescription){
			$scope.btnValue = "收起简介";
		}else{
			$scope.btnValue = "查看全部";
		}
	}

	/**
	* 获取医生信息
	*/
	$scope.queryDoctor = function(){
		var url = $scope.host+"/wx/doctor/queryDoctorDetailInfo";
		var params = "id="+$scope.id;
		$http.post(url,params,{
			headers:{
				"content-type":'application/x-www-form-urlencoded;charset=UTF-8',
			}
		}).success(function(data){
			if(data.code==0){
				$scope.doctorInfo = data.data;
			}else{
				Tool.alert($scope,"连接数据失败，请稍后再试!");
			}
		}).error(function(){
			Tool.alert($scope,"连接数据失败，请稍后再试!");
		})
	}

	/**
	* 检查医生信息
	*/
	$scope.mergeDoctor = function(items){
		items.forEach(function(item){
			item.score==null|item.score==""?item.score="暂无评分":item.score+="分";
		})
	}
}])
