app.controller("writeCtrl",["$scope","$http","Tool","Ajax",function($scope,$http,Tool,Ajax){
	$scope.queryParams ={
		postName:null,
		postIntro:null,
		postContent:null,
		hospitalId:null,
		doctorId:null,
		productId:null,
		img1:null,
		img2:null,
		img3:null,
		p1:null,
		p2:null,
		p3:null,
		flag:1
	}
	//发帖类型信息
	$scope.switchParams = {
		kanya:{has:true,val:1},
		qiumei:{has:false,val:2},
		yunsheng:{has:false,val:3}
	}

	/**
	** 页面初始化
	*/
	$scope.load = function(){
		Ajax.loadHost($scope,function(){
			Tool.loadUserinfo($scope,function(){
				Tool.comfirm($scope,"您还没有登录，请先登录",function(){
					Tool.goPage("/new/htmls/user.html");
				})
			});
		});
	}

	/**
	** 切换发帖类型
	*/
	$scope.switch =function(item){
		Tool.select(item,$scope.switchParams);
		if($scope.switchParams[item]){
			$scope.queryParams.flag = $scope.switchParams[item].val;
		}
	}

	/**
	** 跳转到具体的发帖页面
	*/
	$scope.goTo = function(url){
		if(Tool.isLogin()){
			Tool.goPage(url);
		}else{
			Tool.comfirm($scope,"您还没有登录，请先登录",function(){
				Tool.goPage("/new/htmls/user.html");
			})
		}
	}

	/**
	** 发帖
	*/
	$scope.addPost = function(){
		var url = $scope.host+"/wx/post/addPost";
		var paramsStr = Tool.convertParams($scope.queryParams);
		$http.post(url,paramsStr,{
			headers:{
				'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',
				'accessToken':$scope.userInfo.accessToken
			}
		}).success(function(data){

		}).error(function(){})
	}
}])
