app.controller("orderCtrl",["$scope","$http","Tool",function($scope,$http,Tool){
	$scope.orders;
	$scope.btnParams = {
		toPay:false,
		payed:false,
		canceled:false,
		tocancel:false,
		finish:false,
	}
	$scope.load = function(){
		var url = Tool.getSession("host")+"/wx/order/queryOrderList";
		$http.post(url)
		.success(function(data){
			if(data.code==0){
				$scope.merge(data.data);
				$scope.orders = data.data;
			}else if(data.code==1){
				Tool.comfirm($scope,data.message);
			}else{
				Tool.comfirm($scope,"获取订单信息失败，请稍后再试!");
			}
		}).error(function(){
			Tool.comfirm($scope,"获取订单信息失败，请稍后再试!");
		})
	}
	$scope.merge = function(orders){
		orders.forEach(function(item,index,array){
			item.toPay = false;
			item.payed = false;
			item.canceled = false;
			item.tocancel = false;
			item.finish = false;
			switch(item.status){
				case -1:
					item.statusMes = "已取消";
					item.canceled = true;
					break;
				case 0:
					item.statusMes = "待支付";
					item.toPay = true;
					item.tocancel = true;
					break;
                case 1:
                    item.statusMes = "待确认";
					item.payed = true;
					item.tocancel = true;
					break;
                case 2:
                    item.statusMes = "待就医";
					item.payed = true;
					item.tocancel = true;
					break;
                case 3:
                    item.statusMes = "就医中";
					item.payed = true;
					break;
				case 4:
					item.statusMes = "就医完成";
					item.finish = true;
					break;
				case 5:
					item.statusMes = "就医完成";
					item.finish = true;
					break;
                case 6:
                    item.statusMes = "退款中";
					break;
                case 7:
                    item.statusMes = "退款完成";
					item.finish = true;
					break;
			}
		});
	}
}])
