{"version":3,"sources":["findpassCtrl.js"],"names":["app","controller","$scope","$http","$location","$interval","Tool","phone","code","pwd","getPhone","search","getCodes","hasSendCode","codeText","sendCodes","checkPhone","url","getSession","params","post","headers","Content-type","success","data","goPage","alert","message","error","checkCode","length","date","changePwd","getCode","time","interval","then","cancel","mesage"],"mappings":"AAAAA,IAAIC,WAAW,gBAAgB,SAAS,QAAQ,YAAY,YAAY,OAAO,SAASC,EAAOC,EAAMC,EAAUC,EAAUC,GACxHJ,EAAOK,MAAQ,GACfL,EAAOM,KAAO,GACdN,EAAOO,IAAM,GACbP,EAAOQ,SAAWN,EAAUO,SAASJ,OAAO,GAC5CL,EAAOU,SAAWR,EAAUO,SAASH,MAAM,GAC3CN,EAAOW,aAAc,EACrBX,EAAOY,SAAW,UAClBZ,EAAOa,WAAY,EAInBb,EAAOc,WAAa,WACnB,GAAIC,GAAMX,EAAKY,WAAW,QAAQ,kCAC9BC,EAAS,oBAAoBjB,EAAOK,KACxCJ,GAAMiB,KAAKH,EAAIE,GACdE,SACCC,eAAe,qDAEdC,QAAQ,SAASC,GACL,GAAXA,EAAKhB,KACPF,EAAKmB,OAAO,uCAAuCvB,EAAOK,OAE1DD,EAAKoB,MAAMxB,EAAOsB,EAAKG,WAEtBC,MAAM,WACRtB,EAAKoB,MAAMxB,EAAO,sBAOpBA,EAAO2B,UAAY,WAClB,GAAG3B,EAAOa,UACT,GAAuB,GAApBb,EAAOM,KAAKsB,OAAU,CACxB,GAAIb,GAAMX,EAAKY,WAAW,QAAQ,kCAC9BC,EAAS,yBAAyBjB,EAAOM,KAAK,MAAMN,EAAOQ,QAC/DP,GAAMiB,KAAKH,EAAIE,GACdE,SACCC,eAAe,qDAEdC,QAAQ,SAASC,GACL,GAAXA,EAAKhB,KACPF,EAAKmB,OAAO,sCAAsCvB,EAAOQ,SAAS,SAASR,EAAOM,MAElFF,EAAKoB,MAAMxB,EAAO6B,KAAKJ,WAEtBC,MAAM,WACRtB,EAAKoB,MAAMxB,EAAO,gBAGnBI,GAAKoB,MAAMxB,EAAO,gBAGnBI,GAAKoB,MAAMxB,EAAO,YAOpBA,EAAO8B,UAAY,WAClB,GAAG9B,EAAOO,IAAIqB,QAAQ,GAAG5B,EAAOO,IAAIqB,QAAQ,GAAG,CAC9C,GAAIb,GAAMX,EAAKY,WAAW,QAAQ,yBAC9BC,EAAS,SAASjB,EAAOQ,SAAS,SAASR,EAAOU,SAAS,aAAaV,EAAOO,GACnFN,GAAMiB,KAAKH,EAAIE,GACdE,SACCC,eAAe,qDAEdC,QAAQ,SAASC,GACL,GAAXA,EAAKhB,KACPF,EAAKoB,MAAMxB,EAAO,UAAU,WAC3BI,EAAKmB,OAAO,2BAGbnB,EAAKoB,MAAMxB,EAAOsB,EAAKG,WAEtBC,MAAM,WACRtB,EAAKoB,MAAMxB,EAAO,qBAQrBA,EAAO+B,QAAU,WAChB,IAAI/B,EAAOW,YAAY,CACtB,GAAII,GAAMX,EAAKY,WAAW,QAAQ,mCAC9BM,EAAO,SAAStB,EAAOQ,QAC3BP,GAAMiB,KAAKH,EAAIO,GACdH,SACGC,eAAe,qDAEhBC,QAAQ,SAASC,GACnB,GAAc,GAAXA,EAAKhB,KAAQ,CACfN,EAAOW,aAAc,EACrBX,EAAOa,WAAY,CACnB,IAAImB,GAAO,GACPC,EAAW9B,EAAU,WACxBH,EAAOY,SAAYoB,EAAK,KACxBA,KACC,IAAK,IAAIE,KAAK,WACflC,EAAOY,SAAW,UAClBZ,EAAOW,aAAc,EACrBR,EAAUgC,OAAOF,SAGlB7B,GAAKoB,MAAMxB,EAAOsB,EAAKc,UAEtBV,MAAM,WACRtB,EAAKoB,MAAMxB,EAAO","file":"findpassCtrl.js","sourcesContent":["app.controller(\"findpassCtrl\",[\"$scope\",\"$http\",\"$location\",\"$interval\",\"Tool\",function($scope,$http,$location,$interval,Tool){\r\n\t$scope.phone = \"\"; //手机号码\r\n\t$scope.code = \"\"; //验证码\r\n\t$scope.pwd = \"\"; //密码\r\n\t$scope.getPhone = $location.search().phone||\"\"; //跳转页面缓存手机号码\r\n\t$scope.getCodes = $location.search().code||\"\"; //跳转页面缓存验证码\r\n\t$scope.hasSendCode = false; //是否是发送验证码状态\r\n\t$scope.codeText = \"获取短信验证码\";\r\n\t$scope.sendCodes = false;\r\n\t/*\r\n\t** 检测手机号码是否有注册\r\n\t*/\r\n\t$scope.checkPhone = function(){\r\n\t\tvar url = Tool.getSession(\"host\")+\"/wx/findpass/findPassPhontCheck\";\r\n\t\tvar params = \"name=phone&param=\"+$scope.phone;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tTool.goPage(\"/new/htmls/findpwd-code.html#?phone=\"+$scope.phone);\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"检查手机号码失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 检测验证码是否正确\r\n\t*/\r\n\t$scope.checkCode = function(){\r\n\t\tif($scope.sendCodes){\r\n\t\t\tif($scope.code.length==4){\r\n\t\t\t\tvar url = Tool.getSession(\"host\")+\"/wx/findpass/findPassPhontCheck\";\r\n\t\t\t\tvar params = \"name=verifyCode&param=\"+$scope.code+\"&p=\"+$scope.getPhone;\r\n\t\t\t\t$http.post(url,params,{\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t\t}\r\n\t\t\t\t}).success(function(data){\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.goPage(\"/new/htmls/findpwd-pwd.html#?phone=\"+$scope.getPhone+\"&code=\"+$scope.code);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert($scope,date.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).error(function(){\r\n\t\t\t\t\tTool.alert($scope,\"验证码错误!\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"请输入4位验证码\");\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tTool.alert($scope,\"请先获取验证码\");\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 修改密码\r\n\t*/\r\n\t$scope.changePwd = function(){\r\n\t\tif($scope.pwd.length>=8&&$scope.pwd.length<=20){\r\n\t\t\tvar url = Tool.getSession(\"host\")+\"/wx/findpass/changepwd\";\r\n\t\t\tvar params = \"phone=\"+$scope.getPhone+\"&code=\"+$scope.getCodes+\"&password=\"+$scope.pwd;\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\tTool.alert($scope,\"密码修改成功!\",function(){\r\n\t\t\t\t\t\tTool.goPage(\"/new/htmls/login.html\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"密码修改失败，请稍后再试!\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 发送短信验证码\r\n\t*/\r\n\t$scope.getCode = function(){\r\n\t\tif(!$scope.hasSendCode){\r\n\t\t\tvar url = Tool.getSession(\"host\")+\"/wx/findpass/sendsmsfindpasscode\";\r\n\t\t\tvar data = \"phone=\"+$scope.getPhone;\r\n\t\t\t$http.post(url,data,{\r\n\t\t\t\theaders: {\r\n\t\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t }\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.hasSendCode = true;\r\n\t\t\t\t\t$scope.sendCodes = true;\r\n\t\t\t\t\tvar time = 59;\r\n\t\t\t\t\tvar interval = $interval(function(){\r\n\t\t\t\t\t\t$scope.codeText = (time+\" S\");\r\n\t\t\t\t\t\ttime--;\r\n\t\t\t\t\t},1000,60).then(function(){\r\n\t\t\t\t\t\t$scope.codeText = \"获取短信验证码\";\r\n\t\t\t\t\t\t$scope.hasSendCode = false;\r\n\t\t\t\t\t\t$interval.cancel(interval);\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert($scope,data.mesage);\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"发送验证码失败，请稍后再试!\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}