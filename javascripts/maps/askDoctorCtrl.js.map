{"version":3,"sources":["askDoctorCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","hasSee","content","noSelect","postData","FormData","params","input1","has","url","val","input2","input3","input4","input5","input6","init","loadHost","loadUserinfo","comfirm","goPage","listen","chooseSee","$","on","getUrl","this","files","$apply","obj","undefined","window","createObjectURL","URL","webkitURL","choosePic","count","item","prototype","click","alert","remove","clear","selector","element","document","getElementById","outerHTML","mergePic","imgStr","pStr","afterCount","file","Blob","type","index","beforeParams","append","get","send","host","loading","ajax","dataType","processData","contentType","cache","data","beforeSend","request","setRequestHeader","userInfo","accessToken","success","code","error","back","history"],"mappings":"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","file":"askDoctorCtrl.js","sourcesContent":["app.controller(\"askDoctorCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.hasSee = true;\r\n\t$scope.content = null;\r\n\t$scope.noSelect = true;\r\n\t$scope.postData = new FormData();\r\n\t$scope.params = {\r\n\t\tinput1:{has:false,url:\"\",val:\"#input1\"},\r\n\t\tinput2:{has:false,url:\"\",val:\"#input2\"},\r\n\t\tinput3:{has:false,url:\"\",val:\"#input3\"},\r\n\t\tinput4:{has:false,url:\"\",val:\"#input4\"},\r\n\t\tinput5:{has:false,url:\"\",val:\"#input5\"},\r\n\t\tinput6:{has:false,url:\"\",val:\"#input6\"},\r\n\t}\r\n\t\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\tTool.loadUserinfo($scope,function(){\r\n\t\t\t\tTool.comfirm($scope,\"您还没有登录，请先登录\",function(){\r\n\t\t\t\t\tTool.goPage(\"/new/htmls/user.html\");\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t});\r\n\t\t$scope.listen();\r\n\t}\r\n\r\n\t/*\r\n\t** 切换是否医生可见\r\n\t*/\r\n\t$scope.chooseSee = function(){\r\n\t\t$scope.hasSee = !$scope.hasSee;\r\n\t}\r\n\r\n\t/**\r\n\t** 监听input元素选择图片\r\n\t*/\r\n\t$scope.listen = function(){\r\n\t\t$(\"#input1\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input1.has = true;\r\n\t\t\t$scope.params.input1.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input2\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input2.has = true;\r\n\t\t\t$scope.params.input2.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input3\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input3.has = true;\r\n\t\t\t$scope.params.input3.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input4\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input4.has = true;\r\n\t\t\t$scope.params.input4.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input5\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input5.has = true;\r\n\t\t\t$scope.params.input5.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input6\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.params.input6.has = true;\r\n\t\t\t$scope.params.input6.url = url;\r\n\t\t\t$scope.noSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t** 获取input元素图片的url，做图片预览\r\n\t*/\r\n\t$scope.getUrl = function(obj){\r\n\t\tvar url = null;\r\n\t\tif (window.createObjectURL != undefined) { // basic\r\n\t\t\turl = window.createObjectURL(obj);\r\n\t\t} else if (window.URL != undefined) { // mozilla(firefox)\r\n\t\t\turl = window.URL.createObjectURL(obj);\r\n\t\t} else if (window.webkitURL != undefined) { // webkit or chrome\r\n\t\t\turl = window.webkitURL.createObjectURL(obj);\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t/**\r\n\t** 触发随便说说选择照片\r\n\t*/\r\n\t$scope.choosePic = function(){\r\n\t\tvar count = 0;\r\n\t\tfor(var item in $scope.params){\r\n\t\t\tvar prototype = $scope.params[item];\r\n\t\t\tcount++;\r\n\t\t\tif(!prototype.has){\r\n\t\t\t\t$(prototype.val).click();\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(count==6){\r\n\t\t\tTool.alert($scope,\"最多只能上传6张图片!\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 删除图片\r\n\t*/\r\n\t$scope.remove = function(item){\r\n\t\tif($scope.params[item]){\r\n\t\t\t$scope.params[item].has=false;\r\n\t\t\t$scope.params[item].url=\"\";\r\n\t\t\t$scope.clear(item);\r\n\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 重新替换要重新选择图片的input元素\r\n\t*/\r\n\t$scope.clear = function(selector){\r\n\t\tvar element = document.getElementById(selector);\r\n\t\telement.outerHTML = element.outerHTML; //重新替换Input元素\r\n\t}\r\n\r\n\t/*\r\n\t** 调整照片参数\r\n\t*/\r\n\t$scope.mergePic = function(){\r\n\t\tvar imgStr = \"img\";\r\n\t\tvar pStr = \"p\";\r\n\t\tvar count = 1;\r\n\t\tvar afterCount = 3;\r\n\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\tfor(var index in $scope.beforeParams){\r\n\t\t\tvar prototype = $scope.beforeParams[index];\r\n\t\t\tif(prototype.has){\r\n\t\t\t\tif(count<4){\r\n\t\t\t\t\t$scope.postData.append(imgStr+count,$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(count;count<7;count++){\r\n\t\t\tif(count<4){\r\n\t\t\t\t$scope.postData.append(imgStr+count,file);\r\n\t\t\t}else{\r\n\t\t\t\t$scope.postData.append(pStr+(count-afterCount),file);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 提交提问\r\n\t*/\r\n\t$scope.send = function(){\r\n\t\tif($scope.content===null||$scope.content===\"\"){\r\n\t\t\tTool.alert($scope,\"请填写咨询内容!\");\r\n\t\t}else{\r\n\t\t\tvar url = $scope.host+\"/new/htmls/ask\";\r\n\t\t\t$scope.mergePic();\r\n\t\t\t$scope.postData.append(\"postContent\",$scope.content);\r\n\t\t\t$scope.loading = true;\r\n\t\t\t$.ajax({\r\n\t\t\t    type: \"POST\",\r\n\t\t\t    url: url,\r\n\t\t\t    dataType: 'json',\r\n\t\t\t    processData: false,\r\n\t\t\t    contentType: false,\r\n\t\t\t    cache: false,\r\n\t\t\t    data: $scope.postData,\r\n\t\t\t\tbeforeSend: function (request) {\r\n\t\t\t\t\trequest.setRequestHeader(\"accessToken\", $scope.userInfo.accessToken);\r\n\t\t\t\t},\r\n\t\t\t\tsuccess:function(data){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.goPage(\"/new/htmls/interaction.html\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror:function(){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t$scope.postData = new FormData();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/*\r\n\t** 返回上一页\r\n\t*/\r\n\t$scope.back = function(){\r\n\t\thistory.back();\r\n\t}\r\n\r\n}])\r\n"],"sourceRoot":"/source/"}