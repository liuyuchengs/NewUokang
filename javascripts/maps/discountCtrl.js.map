{"version":3,"sources":["discountCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","itemState","discountSelect","currentPage","productInfo","noProduct","noProductText","loading","init","loadHost","loadGift","url","host","params","post","headers","Content-type","accessToken","success","data","code","length","mergeProdcut","concat","alert","message","error","items","forEach","item","priceunit","preferPriceType","pricetype","samllimg","money","preferPrice","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","switchState","detail","proId","hospitalId","path","goPage","question"],"mappings":"AAAAA,IAAIC,WAAW,gBAAgB,SAAS,QAAQ,OAAO,OAAO,SAASC,EAAOC,EAAMC,EAAKC,GACxFH,EAAOI,UAAY,WACnBJ,EAAOK,gBAAiB,EACxBL,EAAOM,YAAc,EACrBN,EAAOO,eACPP,EAAOQ,WAAY,EACnBR,EAAOS,cAAgB,GACvBT,EAAOU,SAAU,EAEjBV,EAAOW,KAAO,WACbR,EAAKS,SAASZ,EAAO,WACpBA,EAAOa,cAKTb,EAAOa,SAAW,WACjBb,EAAOU,SAAU,CACjB,IAAII,GAAM,EAETA,GADoB,YAAlBd,EAAOI,UACHJ,EAAOe,KAAK,wBAEZf,EAAOe,KAAK,qBAEnB,IAAIC,GAAS,eAAehB,EAAOM,WACnCL,GAAMgB,KAAKH,EAAIE,GACdE,SACGC,eAAe,kDACfC,YAAc,MAEfC,QAAQ,SAASC,GACL,GAAXA,EAAKC,KACJD,EAAKA,KAAKE,OAAO,GAChBxB,EAAOO,YAAYiB,OAAO,EAC5BxB,EAAOS,cAAgB,sBAEvBT,EAAOS,cAAgB,WAExBT,EAAOQ,WAAY,IAEnBR,EAAOyB,aAAaH,EAAKA,MACzBtB,EAAOO,YAAcP,EAAOO,YAAYmB,OAAOJ,EAAKA,OAGrDpB,EAAKyB,MAAM3B,EAAOsB,EAAKM,SAExB5B,EAAOU,SAAU,IACfmB,MAAM,WACR7B,EAAOQ,WAAY,EACnBN,EAAKyB,MAAM3B,EAAO,mBAClBA,EAAOU,SAAU,KAKnBV,EAAOyB,aAAe,SAASK,GAC9BA,EAAMC,QAAQ,SAASC,GACH,MAAhBA,EAAKC,WAAiC,IAAhBD,EAAKC,UAC7BD,EAAKE,gBAAkBF,EAAKG,UAAU,IAAIH,EAAKC,UAE/CD,EAAKE,gBAAkBF,EAAKG,UAEX,IAAfH,EAAKI,UAA6B,MAAfJ,EAAKI,WAC1BJ,EAAKI,SAAW,iCAEdJ,EAAKK,QACPL,EAAKM,YAAcN,EAAKK,UAM3BE,OAAOC,SAAW,WACjB,IAAGxC,EAAOU,UAASV,EAAOQ,UAA1B,CAGA,GAAIiC,GAAOC,SAASD,KACbE,EAAOD,SAASE,gBACnBC,EAASC,KAAKC,IAAKN,EAAKO,aAAcP,EAAKQ,aAAaN,EAAKO,aAAcP,EAAKK,aAAcL,EAAKM,aACpGJ,GAAON,OAAOY,aACZN,EAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClDnD,EAAOqD,aAQVrD,EAAOqD,SAAW,WACjBrD,EAAOM,cACPN,EAAOa,YAMRb,EAAOsD,YAAc,SAAStB,GACpB,YAANA,EACChC,EAAOI,WAAW4B,IACpBhC,EAAOM,YAAc,EACrBN,EAAOK,gBAAiB,EACxBL,EAAOQ,WAAY,EACnBR,EAAOI,UAAY4B,EACnBhC,EAAOO,eACPP,EAAOa,YAGLb,EAAOI,WAAW4B,IACpBhC,EAAOM,YAAc,EACrBN,EAAOK,gBAAiB,EACxBL,EAAOQ,WAAY,EACnBR,EAAOI,UAAY4B,EACnBhC,EAAOO,eACPP,EAAOa,aAQVb,EAAOuD,OAAS,SAASC,EAAMC,EAAWnB,GACzC,GAAIoB,GAAO,6CAA6CF,EAAM,eAAeC,CACxD,aAAlBzD,EAAOI,UACTsD,GAAQ,YACoB,SAApB1D,EAAOI,YACfsD,GAAQ,iCAAiCpB,GAE1CpC,EAAKyD,OAAOD,IAMb1D,EAAO4D,SAAW,WACjB1D,EAAKyB,MAAM3B,EAAO","file":"discountCtrl.js","sourcesContent":["app.controller(\"discountCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.itemState = \"discount\";\r\n\t$scope.discountSelect = true;\r\n\t$scope.currentPage = 1;\r\n\t$scope.productInfo = [];\r\n\t$scope.noProduct = false;\r\n\t$scope.noProductText = \"\";\r\n\t$scope.loading = false;\r\n\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loadGift();\r\n\t\t})\r\n\t\t\r\n\t}\r\n\r\n\t$scope.loadGift = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar url = \"\";\r\n\t\tif($scope.itemState==\"discount\"){\r\n\t\t\turl = $scope.host+\"/wx/order/queryByGift\";\r\n\t\t}else{\r\n\t\t\turl = $scope.host+\"/wx/order/queryGift\";\r\n\t\t}\r\n\t\tvar params = \"currentPage=\"+$scope.currentPage;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders: {\r\n\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t   'accessToken':\"\",\r\n\t\t\t }\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\tif($scope.productInfo.length<1){\r\n\t\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t$scope.productInfo = $scope.productInfo.concat(data.data);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.noProduct = true;\r\n\t\t\tTool.alert($scope,\"获取项目信息失败，请稍后再试!\");\r\n\t\t\t$scope.loading = false;\r\n\t\t})\r\n\r\n\t}\r\n\r\n\t$scope.mergeProdcut = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t}else{\r\n\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t}\r\n\t\t\tif(item.samllimg==\"\"||item.samllimg==null){\r\n\t\t\t\titem.samllimg = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t\tif(item.money){\r\n\t\t\t\titem.preferPrice = item.money;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//滚动监听\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t    var html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载下一页\r\n\t*/\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.currentPage++;\r\n\t\t$scope.loadGift();\r\n\t}\r\n\r\n\t/*\r\n\t** 切换最低和本月优惠\r\n\t*/\r\n\t$scope.switchState = function(item){\r\n\t\tif(item==\"discount\"){\r\n\t\t\tif($scope.itemState!=item){\r\n\t\t\t\t$scope.currentPage = 1;\r\n\t\t\t\t$scope.discountSelect = true;\r\n\t\t\t\t$scope.noProduct = false;\r\n\t\t\t\t$scope.itemState = item;\r\n\t\t\t\t$scope.productInfo = [];\r\n\t\t\t\t$scope.loadGift();\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif($scope.itemState!=item){\r\n\t\t\t\t$scope.currentPage = 1;\r\n\t\t\t\t$scope.discountSelect = false;\r\n\t\t\t\t$scope.noProduct = false;\r\n\t\t\t\t$scope.itemState = item;\r\n\t\t\t\t$scope.productInfo = [];\r\n\t\t\t\t$scope.loadGift();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 跳转到项目详细信息\r\n\t*/\r\n\t$scope.detail = function(proId,hospitalId,preferPrice){\r\n\t\tvar path = \"/new/htmls/product-detail.html#?productId=\"+proId+\"&hospitalId=\"+hospitalId;\r\n\t\tif($scope.itemState==\"discount\"){\r\n\t\t\tpath += \"&code=123\";\r\n\t\t}else if($scope.itemState == \"month\"){\r\n\t\t\tpath += \"&discountid=123&flag=11&money=\"+preferPrice;\r\n\t\t}\r\n\t\tTool.goPage(path);\r\n\t}\r\n\r\n\t/*\r\n\t** 疑问按钮处理函数\r\n\t*/\r\n\t$scope.question = function(){\r\n\t\tTool.alert($scope,\"如有疑问，请致电0755-26905699\");\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}