{"version":3,"sources":["interactionDetailCtrl.js"],"names":["app","controller","$scope","$http","$location","Tool","Ajax","loading","post","replyMess","showReplyInputId","showPostinput","messageId","replyId","inputStyle","noProduct","noProductText","postId","follow","hasFollow","followText","queryParams","id","pageRows","currentPage","init","loadHost","getQueryString","queryPost","queryMessage","search","goPage","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","url","host","params","isLogin","loadUserinfo","userInfo","accessToken","headers","Content-type","success","data","code","focusState","alert","message","error","convertParams","commentList","length","mergeMessage","concat","comment","counts","outIndex","reply","count","hasReplyInput","createDateStr","trim","slice","parseInt","praiseNum","repliesMessageList","hasReply","replyList","inIndex","replyListItem","replyName","isReply","checkLogin","comfirm","thumb","flag","index","showReplyInput","showPostInput","hidePostInput","hideReplyInput","sendPost","content","replyState","userId","paramsStr","push","sendReply","clickFollow","cacelFollow","tofollow","goDoctor","goProduct","productId","hospitalId"],"mappings":"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","file":"interactionDetailCtrl.js","sourcesContent":["app.controller(\"interactionDetailCtrl\",[\"$scope\",\"$http\",\"$location\",\"Tool\",\"Ajax\",function($scope,$http,$location,Tool,Ajax){\r\n\t$scope.loading = false;\r\n\t$scope.post = {};\r\n\t$scope.replyMess = {};\r\n\t$scope.showReplyInputId = null;\r\n\t$scope.showPostinput = false;\r\n\t$scope.messageId = null; //评论id\r\n\t$scope.replyId = null; //被回复人id\r\n\t//回复输入框提示本文\r\n\t$scope.inputStyle = \"输入你的回复...\";\r\n\t$scope.noProduct = false;\r\n\t$scope.noProductText = \"\";\r\n\t$scope.postId = \"\";\r\n\t$scope.follow = {\r\n\t\thasFollow:false,\r\n\t\tfollowText:\"关注\"\r\n\t}\r\n\t$scope.queryParams = {\r\n\t\tid:\"\",\r\n\t\tpageRows:10,\r\n\t\tcurrentPage:1\r\n\t}\r\n\t/*\r\n\t** 页面初始化\r\n\t*/\r\n\t$scope.init =function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.getQueryString();\r\n\t\t\t$scope.queryPost();\r\n\t\t\t$scope.queryMessage();\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 获取帖子id\r\n\t*/\r\n\t$scope.getQueryString = function(){\r\n\t\tif($location.search().id){\r\n\t\t\t$scope.postId = $location.search().id;\r\n\t\t\t$scope.queryParams.id = $location.search().id;\r\n\t\t}else{\r\n\t\t\tTool.goPage(\"/new/htmls/interaction.html\");\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 滚动监听\r\n\t*/\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t\tvar html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载下一页数据\r\n\t*/\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.queryParams.currentPage++;\r\n\t\t$scope.queryMessage();\r\n\t}\r\n\r\n\t/*\r\n\t** 获取帖子详细信息\r\n\t*/\r\n\t$scope.queryPost = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar url  = $scope.host+\"/wx/post/postDetail\";\r\n\t\tvar params = \"id=\"+$scope.postId;\r\n\t\tif(Tool.isLogin()){\r\n\t\t\tTool.loadUserinfo($scope);\r\n\t\t\tparams += \"&accessToken=\"+$scope.userInfo.accessToken;\r\n\t\t}\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.post = data.data;\r\n\t\t\t\tif(data.data.focusState===1){\r\n\t\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t\t$scope.follow.followText = \"已关注\"\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t\tTool.alert($scope,\"帖子信息加载失败!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t* 查询评论信息\r\n\t*/\r\n\t$scope.queryMessage = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar url = $scope.host+\"/wx/post/postMessage\";\r\n\t\tvar params = Tool.convertParams($scope.queryParams);\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.commentList.length<1){\r\n\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.mergeMessage(data.data);\r\n\t\t\t\tif($scope.replyMess.commentList){\r\n\t\t\t\t\t$scope.replyMess.commentList =  $scope.replyMess.commentList.concat(data.data.commentList);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.replyMess = data.data;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 检查评论信息\r\n\t*/\r\n\t$scope.mergeMessage = function(post){\r\n\t\tpost.message = \"\";\r\n\t\tvar comment  = post.commentList;\r\n\t\tif($scope.replyMess.commentList){\r\n\t\t\tvar counts = $scope.replyMess.commentList.length;\r\n\t\t}else{\r\n\t\t\tvar counts = 0;\r\n\t\t}\r\n\t\tif(comment.length>0){\r\n\t\t\tfor(var outIndex in comment){\r\n\t\t\t\tvar reply = comment[outIndex];\r\n\t\t\t\treply.count = counts+1;\r\n\t\t\t\tcounts++;\r\n\t\t\t\treply.hasReplyInput = false;\r\n\t\t\t\treply.message = \"\";\r\n\t\t\t\tif(reply.createDateStr){\r\n\t\t\t\t\treply.createDateStr =  reply.createDateStr.trim();\r\n\t\t\t\t\treply.createDateStr = reply.createDateStr.slice(5,10);\r\n\t\t\t\t}\r\n\t\t\t\tif(parseInt(reply.praiseNum)<1){\r\n\t\t\t\t\treply.praiseNum = \"点赞\"\r\n\t\t\t\t}\r\n\t\t\t\tif(reply.repliesMessageList.length>0){\r\n\t\t\t\t\treply.hasReply=true;\r\n\t\t\t\t\tvar replyList = reply.repliesMessageList;\r\n\t\t\t\t\tfor(var inIndex in replyList){\r\n\t\t\t\t\t\tvar replyListItem = replyList[inIndex];\r\n\t\t\t\t\t\tif(replyListItem.replyName==\"\"||replyListItem.replyName==null){\r\n\t\t\t\t\t\t\treplyListItem.isReply = false;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\treplyListItem.isReply = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\treply.hasReply=false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 检查是否登录\r\n\t*/\r\n\t$scope.checkLogin = function(){\r\n\t\tif(!Tool.isLogin()){\r\n\t\t\tTool.comfirm($scope,\"请先登录！\",function(){\r\n\t\t\t\tTool.goPage(\"/new/htmls/login.html\");\r\n\t\t\t})\r\n\t\t\treturn false;\r\n\t\t}else{\r\n\t\t\tTool.loadUserinfo($scope);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 点赞，flag:0->帖子,flag:1->评论\r\n\t*/\r\n\t$scope.thumb = function(id,flag){\r\n\t\tif($scope.checkLogin()){\r\n\t\t\tvar reply = \"\";\r\n\t\t\tif(flag==0){\r\n\t\t\t\treply = $scope.post;\r\n\t\t\t}else{\r\n\t\t\t\tfor(var index in $scope.replyMess.commentList){\r\n\t\t\t\t\tif($scope.replyMess.commentList[index].id==id){\r\n\t\t\t\t\t\treply = $scope.replyMess.commentList[index];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar url = $scope.host+\"/wx/post/thumbUp\";\r\n\t\t\tvar params = \"postId=\"+id+\"&flag=\"+flag;\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t\t'accessToken':$scope.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\treply.praiseNum = data.data;\r\n\t\t\t\t}else if(data.code==1){\r\n\t\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 显示评论回复输入框\r\n\t*/\r\n\t$scope.showReplyInput = function(id,replyId,replyName){\r\n\t\tif($scope.checkLogin()){\r\n\t\t\tif($scope.showReplyInputId!=id){\r\n\t\t\t\tvar post = $scope.replyMess;\r\n\t\t\t\t$scope.messageId = id;\r\n\t\t\t\tif(replyId&&replyId!=$scope.userInfo.id){\r\n\t\t\t\t\t$scope.replyId = replyId;\r\n\t\t\t\t}\r\n\t\t\t\tif($scope.showReplyInputId==null){\r\n\t\t\t\t\tfor(var index in post.commentList){\r\n\t\t\t\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = true;\r\n\t\t\t\t\t\t\t$scope.inputStyle = \"输入你的回复...\";\r\n\t\t\t\t\t\t\tif(replyId && replyId != $scope.userInfo.id){\r\n\t\t\t\t\t\t\t\t$scope.inputStyle= \"回复 \"+replyName+\": \";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var index in post.commentList){\r\n\t\t\t\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = true;\r\n\t\t\t\t\t\t\t$scope.inputStyle = \"输入你的回复...\";\r\n\t\t\t\t\t\t\tif(replyId && replyId != $scope.userInfo.id){\r\n\t\t\t\t\t\t\t\t$scope.inputStyle = \"回复 \"+replyName+\": \";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(post.commentList[index].id==$scope.showReplyInputId){\r\n\t\t\t\t\t\t\tpost.commentList[index].hasReplyInput = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$scope.showReplyInputId = id;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 显示评论输入框\r\n\t*/\r\n\t$scope.showPostInput = function(){\r\n\t\tif($scope.checkLogin()){\r\n\t\t\tif($scope.showPostinput == false){\r\n\t\t\t\t$scope.showPostinput = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 隐藏评论输入框\r\n\t*/\r\n\t$scope.hidePostInput = function(){\r\n\t\tif($scope.showPostinput ==true){\r\n\t\t\t$scope.showPostinput = false;\r\n\t\t\t$scope.post.message = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 隐藏评论回复输入框\r\n\t*/\r\n\t$scope.hideReplyInput = function(id){\r\n\t\tvar post = $scope.replyMess;\r\n\t\tfor(var index in post.commentList){\r\n\t\t\tif(post.commentList[index].id==id){\r\n\t\t\t\tpost.commentList[index].hasReplyInput = false;\r\n\t\t\t\tpost.commentList[index].message = \"\";\r\n\t\t\t\t$scope.inputStyle= \"输入你的回复...\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif($scope.showReplyInputId){\r\n\t\t\t$scope.showReplyInputId = null;\r\n\t\t}\r\n\t\tif($scope.messageId){\r\n\t\t\t$scope.messageId = null; //评论id\r\n\t\t}\r\n\t\tif($scope.replyId){\r\n\t\t\t$scope.replyId = null; //被回复人id\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 发表评论\r\n\t*/\r\n\t$scope.sendPost = function(content){\r\n\t\tif(content==\"\"||content==null){\r\n\t\t\tTool.alert($scope,\"消息为空!\");\r\n\t\t}else{\r\n\t\t\tvar params = {\r\n\t\t\t\tpostId:$scope.post.id,\r\n\t\t\t\treplyState:0,\r\n\t\t\t\tcontent:content,\r\n\t\t\t\tuserId:$scope.userInfo.id,\r\n\t\t\t}\r\n\t\t\tvar url = $scope.host+\"/wx/repliesMessage/addRepliesMessage\";\r\n\t\t\tvar paramsStr = Tool.convertParams(params);\r\n\t\t\t$http.post(url,paramsStr,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t\t'accessToken':$scope.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.hidePostInput();\r\n\t\t\t\t\tdata.data.count = $scope.replyMess.commentList.length+1;\r\n\t\t\t\t\t$scope.replyMess.commentList.push(data.data);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后重试!\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 发表回复\r\n\t*/\r\n\t$scope.sendReply = function(content,id){\r\n\t\tif(content==\"\"||content==null){\r\n\t\t\tTool.alert($scope,\"消息为空！\");\r\n\t\t}else{\r\n\t\t\tvar params = {\r\n\t\t\t\tpostId:$scope.post.id,\r\n\t\t\t\treplyState:1,\r\n\t\t\t\tcontent:content,\r\n\t\t\t\tuserId:$scope.userInfo.id,\r\n\t\t\t\tmessageId:$scope.messageId,\r\n\t\t\t}\r\n\t\t\tif($scope.replyId){\r\n\t\t\t\tparams.replyId = $scope.replyId;\r\n\t\t\t}\r\n\t\t\tvar url = $scope.host+\"/wx/repliesMessage/addRepliesMessage\";\r\n\t\t\tvar paramsStr = Tool.convertParams(params);\r\n\t\t\t$http.post(url,paramsStr,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t\t'accessToken':$scope.userInfo.accessToken,\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.showReplyInputId = null;\r\n\t\t\t\t\t$scope.messageId = null; //评论id\r\n\t\t\t\t\t$scope.replyId = null; //被回复人id\r\n\t\t\t\t\t$scope.hideReplyInput(id);\r\n\t\t\t\t\tfor(var index in $scope.replyMess.commentList){\r\n\t\t\t\t\t\tif($scope.replyMess.commentList[index].id==id){\r\n\t\t\t\t\t\t\tif(data.data.replyName==\"\"||data.data.replyName==null){\r\n\t\t\t\t\t\t\t\tdata.data.isReply = false;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tdata.data.isReply = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$scope.replyMess.commentList[index].hasReply = true;\r\n\t\t\t\t\t\t\t$scope.replyMess.commentList[index].repliesMessageList.push(data.data);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert($scope,data.message);\r\n\t\t\t\t}\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后重试!\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 关注按钮处理函数\r\n\t*/\r\n\t$scope.clickFollow = function(){\r\n\t\tif(!Tool.isLogin()){\r\n\t\t\tTool.comfirm($scope,\"请先登录!\",function(){\r\n\t\t\t\tTool.goPage(\"/new/htmls/login.html\");\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tif($scope.follow.hasFollow){\r\n\t\t\t\t$scope.cacelFollow();\r\n\t\t\t}else{\r\n\t\t\t\t$scope.tofollow();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 关注发帖人\r\n\t*/\r\n\t$scope.tofollow = function(){\r\n\t\tvar url = $scope.host+\"/wx/post/focus\";\r\n\t\tvar params = \"flag=1&userId=\"+$scope.post.userId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t'accessToken':$scope.userInfo.accessToken,\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.follow.hasFollow = true;\r\n\t\t\t\t$scope.follow.followText = \"已关注\";\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"关注失败，稍后再试!\");\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t** 取消关注发帖人\r\n\t*/\r\n\t$scope.cacelFollow = function(){\r\n\t\tvar url = $scope.host+\"/wx/post/cacelFocus\";\r\n\t\tvar params = \"flag=1&userId=\"+$scope.post.userId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t'accessToken':$scope.userInfo.accessToken,\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.follow.hasFollow = false;\r\n\t\t\t\t$scope.follow.followText = \"关注\";\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"取消关注失败，稍后再试!\");\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"连接数据失败，稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 跳转到医生页面\r\n\t*/\r\n\t$scope.goDoctor = function(id){\r\n\t\tTool.goPage(\"/new/htmls/doctor-detail.html#?id=\"+id);\r\n\t}\r\n\r\n\t/*\r\n\t** 跳转到项目页面\r\n\t*/\r\n\t$scope.goProduct = function(productId,hospitalId){\r\n\t\tTool.goPage(\"/new/htmls/product-detail.html#?flag=1&productId=\"+productId+\"&hospitalId=\"+hospitalId);\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}