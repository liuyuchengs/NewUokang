{"version":3,"sources":["cushCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","cushs","noCush","activeValue","init","loadHost","loadUserinfo","loadCush","url","host","params","userInfo","id","post","headers","Content-type","accessToken","success","data","code","length","merge","alert","error","items","forEach","item","index","array","flags","money","used","uesd","active"],"mappings":"AAAAA,IAAIC,WAAW,YAAY,SAAS,QAAQ,OAAO,OAAO,SAASC,EAAOC,EAAMC,EAAKC,GACpFH,EAAOI,MACPJ,EAAOK,QAAS,EAChBL,EAAOM,YAAY,GAKnBN,EAAOO,KAAO,WACbJ,EAAKK,SAASR,EAAO,WACpBE,EAAKO,aAAaT,GAClBA,EAAOU,cAKTV,EAAOU,SAAW,WACjB,GAAIC,GAAMX,EAAOY,KAAK,4BAClBC,EAAS,UAAUb,EAAOc,SAASC,EACvCd,GAAMe,KAAKL,EAAIE,GACdI,SACGC,eAAe,kDACfC,YAAcnB,EAAOc,SAASK,eAE/BC,QAAQ,SAASC,GACL,GAAXA,EAAKC,KACc,GAAlBD,EAAKA,KAAKE,OACZvB,EAAOK,QAAS,GAEhBL,EAAOwB,MAAMH,EAAKA,MAClBrB,EAAOI,MAAQiB,EAAKA,MAGrBnB,EAAKuB,MAAMzB,EAAO,mBAEjB0B,MAAM,WACRxB,EAAKuB,MAAMzB,EAAO,oBAKpBA,EAAOwB,MAAQ,SAASG,GACvBA,EAAMC,QAAQ,SAASC,EAAKC,EAAMC,GAC9BF,EAAKG,MAAMH,EAAKI,MAClBJ,EAAKK,MAAO,EAEZL,EAAKM,MAAO,KAMfnC,EAAOoC,OAAS,WACf,GAA8B,GAA3BpC,EAAOM,YAAYiB,OAAU,CAC/B,GAAIZ,GAAMX,EAAOY,KAAK,qBAClBC,EAAS,UAAUb,EAAOc,SAASC,GAAG,SAASf,EAAOM,WAC1DL,GAAMe,KAAKL,EAAIE,GACdI,SACGC,eAAe,kDACfC,YAAcnB,EAAOc,SAASK,eAE/BC,QAAQ,SAASC,GACL,GAAXA,EAAKC,MACPtB,EAAOwB,MAAMH,EAAKA,MAClBrB,EAAOI,MAAQiB,EAAKA,MAEpBnB,EAAKuB,MAAMzB,EAAO,aAEjB0B,MAAM,SAASL,GACjBnB,EAAKuB,MAAMzB,EAAO,kBAGnBE,GAAKuB,MAAMzB,EAAO","file":"cushCtrl.js","sourcesContent":["app.controller(\"cushCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.cushs;\r\n\t$scope.noCush = false;\r\n\t$scope.activeValue=\"\";\r\n\r\n\t/*\r\n\t** 初始化页面\r\n\t*/\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\tTool.loadUserinfo($scope);\r\n\t\t\t$scope.loadCush();\r\n\t\t})\r\n\t}\r\n\r\n\t//加载代金券信息\r\n\t$scope.loadCush = function(){\r\n\t\tvar url = $scope.host+\"/wx/order/findAllVouchers\";\r\n\t\tvar params = \"userId=\"+$scope.userInfo.id;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders: {\r\n\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t   'accessToken':$scope.userInfo.accessToken\r\n\t\t\t }\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.length==0){\r\n\t\t\t\t\t$scope.noCush = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t\t$scope.cushs = data.data;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"数据加载失败，请稍后再试!\");\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"数据加载失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t//判断代金券是否有使用\r\n\t$scope.merge = function(items){\r\n\t\titems.forEach(function(item,index,array){\r\n\t\t\tif(item.flags>item.money){\r\n\t\t\t\titem.used = true;\r\n\t\t\t}else{\r\n\t\t\t\titem.uesd = false;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//激活代金券\r\n\t$scope.active = function(){\r\n\t\tif($scope.activeValue.length==6){\r\n\t\t\tvar url = $scope.host+\"/wx/order/activate\";\r\n\t\t\tvar params = \"userId=\"+$scope.userInfo.id+\"&code=\"+$scope.activeValue;\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders: {\r\n\t\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t   'accessToken':$scope.userInfo.accessToken\r\n\t\t\t\t }\r\n\t\t\t}).success(function(data){\r\n\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t\t$scope.cushs = data.data;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tTool.alert($scope,\"代金券不正确!\");\r\n\t\t\t\t}\r\n\t\t\t}).error(function(data){\r\n\t\t\t\tTool.alert($scope,\"代金券激活失败!\");\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tTool.alert($scope,\"请输入正确长度的代金券!\");\r\n\t\t}\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}