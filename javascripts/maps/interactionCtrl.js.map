{"version":3,"sources":["interactionCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","loading","noProductText","noProduct","hasInteractionMenu","queryParams","flag","pageRows","currentPage","navParams","kanya","has","val","shumei","yunsheng","posts","init","loadHost","queryPost","url","host","params","convertParams","post","headers","Content-type","success","data","length","mergePost","concat","error","alert","items","forEach","item","faceImage","visitNum","commentNum","index","list2","splice","loadNext","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","switchNav","select","detail","id","goPage","menuClick","value"],"mappings":"AAAAA,IAAIC,WAAW,mBAAmB,SAAS,QAAQ,OAAO,OAAO,SAASC,EAAOC,EAAMC,EAAKC,GAC3FH,EAAOI,SAAU,EACjBJ,EAAOK,cAAgB,GACvBL,EAAOM,WAAY,EACnBN,EAAOO,oBAAqB,EAC5BP,EAAOQ,aACNC,KAAK,EACLC,SAAS,GACTC,YAAY,GAEbX,EAAOY,WACNC,OAAOC,KAAI,EAAKC,IAAI,GACpBC,QAAQF,KAAI,EAAMC,IAAI,GACtBE,UAAUH,KAAI,EAAMC,IAAI,IAEzBf,EAAOkB,SAEPlB,EAAOmB,KAAO,WACbhB,EAAKiB,SAASpB,EAAO,WACpBA,EAAOqB,eAOTrB,EAAOqB,UAAY,WAClBrB,EAAOI,SAAS,CAChB,IAAIkB,GAAMtB,EAAOuB,KAAK,oBAClBC,EAAStB,EAAKuB,cAAczB,EAAOQ,YACvCP,GAAMyB,KAAKJ,EAAIE,GACdG,SACCC,eAAe,qDAEdC,QAAQ,SAASC,GAChBA,EAAKA,KAAKC,OAAO,GAChB/B,EAAOkB,MAAMa,OAAO,EACtB/B,EAAOK,cAAgB,sBAEvBL,EAAOK,cAAgB,WAExBL,EAAOM,WAAY,IAEnBN,EAAOgC,UAAUF,EAAKA,MACtB9B,EAAOkB,MAAQlB,EAAOkB,MAAMe,OAAOH,EAAKA,OAEzC9B,EAAOI,SAAU,IACf8B,MAAM,WACRlC,EAAOI,SAAU,EACjBF,EAAKiC,MAAMnC,EAAO,gBAOpBA,EAAOgC,UAAY,SAASI,GAC3BA,EAAMC,QAAQ,SAASC,GACH,IAAhBA,EAAKC,WAA+B,MAAhBD,EAAKC,YAC3BD,EAAKC,UAAY,iCAEA,MAAfD,EAAKE,UAA+B,IAAfF,EAAKE,WAC5BF,EAAKE,SAAS,GAEK,IAAjBF,EAAKG,YAAiC,MAAjBH,EAAKG,aAC5BH,EAAKG,WAAa,EAEnB,KAAI,GAAIC,KAASJ,GAAKK,MACC,IAAnBL,EAAKK,MAAMD,IAA+B,MAAnBJ,EAAKK,MAAMD,IACpCJ,EAAKK,MAAMC,OAAOF,EAAM,MAS5B1C,EAAO6C,SAAW,WACjB7C,EAAOQ,YAAYG,cACnBX,EAAOqB,aAMRyB,OAAOC,SAAW,WACjB,IAAG/C,EAAOI,UAASJ,EAAOM,UAA1B,CAGA,GAAI0C,GAAOC,SAASD,KACbE,EAAOD,SAASE,gBACnBC,EAASC,KAAKC,IAAKN,EAAKO,aAAcP,EAAKQ,aAAaN,EAAKO,aAAcP,EAAKK,aAAcL,EAAKM,aACpGJ,GAAON,OAAOY,aACZN,EAASN,OAAOa,QAAUb,OAAOY,YAAc,KAClD1D,EAAO6C,aAQV7C,EAAO4D,UAAY,SAAStB,GAC3BtC,EAAOQ,YAAYC,KAAOT,EAAOY,UAAU0B,GAAMvB,IACjDb,EAAK2D,OAAOvB,EAAKtC,EAAOY,WACxBZ,EAAOQ,YAAYG,YAAc,EACjCX,EAAOM,WAAY,EACnBN,EAAOK,cAAgB,GACvBL,EAAOkB,SACPlB,EAAOqB,aAMRrB,EAAO8D,OAAS,SAASC,GACxB,GAAIzC,GAAM,0CAA0CyC,CACpD7D,GAAK8D,OAAO1C,IAQbtB,EAAOiE,UAAY,SAASC,GAC3BhE,EAAK+D,UAAUjE,EAAOkE","file":"interactionCtrl.js","sourcesContent":["app.controller(\"interactionCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.loading = false;\r\n\t$scope.noProductText = \"\";\r\n\t$scope.noProduct = false;\r\n\t$scope.hasInteractionMenu = true;\r\n\t$scope.queryParams = {\r\n\t\tflag:1,\r\n\t\tpageRows:10,\r\n\t\tcurrentPage:1\r\n\t}\r\n\t$scope.navParams = {\r\n\t\tkanya:{has:true,val:1},\r\n\t\tshumei:{has:false,val:2},\r\n\t\tyunsheng:{has:false,val:3}\r\n\t}\r\n\t$scope.posts = [];\r\n\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.queryPost();\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载帖子数据\r\n\t*/\r\n\t$scope.queryPost = function(){\r\n\t\t$scope.loading =true;\r\n\t\tvar url = $scope.host+\"/wx/post/postList\";\r\n\t\tvar params = Tool.convertParams($scope.queryParams);\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.data.length<1){\r\n\t\t\t\tif($scope.posts.length<1){\r\n\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t}\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.mergePost(data.data);\r\n\t\t\t\t$scope.posts = $scope.posts.concat(data.data);\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t\tTool.alert($scope,\"获取帖子信息失败!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 处理帖子数据\r\n\t*/\r\n\t$scope.mergePost = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.faceImage==\"\"||item.faceImage==null){\r\n\t\t\t\titem.faceImage = \"../contents/temp/head-img.png\";\r\n\t\t\t}\r\n\t\t\tif(item.visitNum==null||item.visitNum==\"\"){\r\n\t\t\t\titem.visitNum=0;\r\n\t\t\t}\r\n\t\t\tif(item.commentNum==\"\"||item.commentNum==null){\r\n\t\t\t\titem.commentNum = 0;\r\n\t\t\t}\r\n\t\t\tfor(var index in item.list2){\r\n\t\t\t\tif(item.list2[index]==\"\"||item.list2[index]==null){\r\n\t\t\t\t\titem.list2.splice(index,1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载下一页数据\r\n\t*/\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.queryParams.currentPage++;\r\n\t\t$scope.queryPost();\r\n\t}\r\n\r\n\t/*\r\n\t** 滚动监听\r\n\t*/\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t    var html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 切换帖子类型\r\n\t*/\r\n\t$scope.switchNav = function(item){\r\n\t\t$scope.queryParams.flag = $scope.navParams[item].val;\r\n\t\tTool.select(item,$scope.navParams);\r\n\t\t$scope.queryParams.currentPage = 1;\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.posts = [];\r\n\t\t$scope.queryPost();\r\n\t}\r\n\r\n\t/*\r\n\t** 跳转到详细页面,并添加浏览次数\r\n\t*/\r\n\t$scope.detail = function(id){\r\n\t\tvar url = \"/new/htmls/interaction-detail.html#?id=\"+id;\r\n\t\tTool.goPage(url);\r\n\t}\r\n\r\n\r\n\r\n\t/*\r\n\t** 底部按钮事件\r\n\t*/\r\n\t$scope.menuClick = function(value){\r\n\t\tTool.menuClick($scope,value);\r\n\t}\r\n\r\n}])\r\n"],"sourceRoot":"/source/"}