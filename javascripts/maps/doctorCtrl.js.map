{"version":3,"sources":["doctorCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","Params","hasDoctorMenu","loading","hasBg","profValue","profItemValue","doctors","noProduct","noProductText","orderParams","default","has","val","title","score","areaParams","professionalParams","queryParams","professionId","itemid","orderby","city","area","pageRows","currentPage","menuParams","order","professional","init","loadHost","loadDoctor","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","menuClick","value","switchMenu","menu","switchObj","selectMenu","item","obj","ob","resetDate","selectProfression","selectProfressionItem","pro","proId","id","url","host","params","convertParams","post","headers","Content-type","success","data","length","mergeDoctor","concat","error","alert","items","forEach","sales","detail","goPage"],"mappings":"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","file":"doctorCtrl.js","sourcesContent":["app.controller(\"doctorCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",\"Params\",function($scope,$http,Tool,Ajax,Params){\r\n\t$scope.hasDoctorMenu = true;\r\n\t$scope.loading = false;\r\n\t$scope.hasBg = false;\r\n\t$scope.profValue = \"default\";\r\n\t$scope.profItemValue = \"default\";\r\n\t$scope.doctors = [];\r\n\t$scope.noProduct = false;\r\n\t$scope.noProductText = \"\";\r\n\t//下拉菜单项变量\r\n\t$scope.orderParams ={\r\n\t\tdefault:{has:true,val:\"\"},\r\n\t\ttitle:{has:false,val:\"profession_title desc\"},\r\n\t\tscore:{has:false,val:\"score desc\"}\r\n\t}\r\n\t$scope.areaParams = Params.areaParams;\r\n\t$scope.professionalParams = Params.professionalParams;\r\n\r\n\t/**\r\n\t * 查询参数\r\n\t */\r\n\t$scope.queryParams = {\r\n\t\tprofessionId:\"\",\r\n\t\titemid:\"\",\r\n\t\torderby:\"\",\r\n\t\tcity:\"深圳\",\r\n\t\tarea:\"\",\r\n\t\tpageRows:10,\r\n\t\tcurrentPage:1\r\n\t}\r\n\r\n\t//导航栏变量，需定义在上述变量的后面\r\n\t$scope.menuParams = {\r\n\t\tarea:{has:false,val:$scope.areaParams},\r\n\t\torder:{has:false,val:$scope.orderParams},\r\n\t\tprofessional:{has:false,val:$scope.professionalParams},\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化页面\r\n\t */\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loadDoctor();\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 滚动监听\r\n\t*/\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t    var html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t$scope.menuClick = function(value){\r\n\t\tTool.menuClick($scope,value);\r\n\t}\r\n\r\n\t/*\r\n\t** 切换导航菜单\r\n\t*/\r\n\t$scope.switchMenu = function(menu){\r\n\t\t$scope.switchObj(menu,$scope.menuParams,true);\r\n\t}\r\n\r\n\t/*\r\n\t** 选择区域和排序项目\r\n\t*/\r\n\t$scope.selectMenu = function(item,obj){\r\n\t\tvar ob = $scope.menuParams[obj].val;\r\n\t\t$scope.switchObj(item,ob);\r\n\t\tif(obj==\"area\"){\r\n\t\t\t$scope.queryParams.area = ob[item].val;\r\n\t\t}\r\n\t\tif(obj==\"order\"){\r\n\t\t\t$scope.queryParams.orderby = ob[item].val;\r\n\t\t}\r\n\t\t$scope.switchMenu(obj);\r\n\t\t$scope.resetDate();\r\n\t\t$scope.loadDoctor();\r\n\t}\r\n\r\n\t/*\r\n\t** 选择专科\r\n\t*/\r\n\t$scope.selectProfression = function(item){\r\n\t\t$scope.switchObj(item,$scope.professionalParams);\r\n\t}\r\n\r\n\t/*\r\n\t** 选择专科项目\r\n\t*/\r\n\t$scope.selectProfressionItem = function(item,pro){\r\n\t\tif(item!=$scope.profItemValue){\r\n\t\t\tif($scope.profValue==\"\"&&$scope.profItemValue==\"\"){\r\n\t\t\t\t$scope.professionalParams[pro].val[item].has = true;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.professionalParams[$scope.profValue].val[$scope.profItemValue].has = false;\r\n\t\t\t\t$scope.professionalParams[pro].val[item].has = true;\r\n\t\t\t}\r\n\t\t\t$scope.profItemValue = item;\r\n\t\t\t$scope.profValue = pro;\r\n\t\t\t$scope.queryParams.professionId = $scope.professionalParams[pro].proId;\r\n\t\t\t$scope.queryParams.itemid = $scope.professionalParams[pro].val[item].id;\r\n\t\t\t$scope.switchMenu(\"professional\");\r\n\t\t\t$scope.resetDate();\r\n\t\t\t$scope.loadDoctor();\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 切换对象的值\r\n\t*/\r\n\t$scope.switchObj = function(item,obj,hasBg){\r\n\t\tfor(var pro in obj){\r\n\t\t\tif(pro==item){\r\n\t\t\t\tobj[pro].has = !obj[pro].has;\r\n\t\t\t\tif(hasBg){\r\n\t\t\t\t\t$scope.hasBg = obj[pro].has;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tobj[pro].has = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 加载医生数据\r\n\t */\r\n\t$scope.loadDoctor = function(){\r\n\t\t$scope.loading=true;\r\n\t\tvar url = $scope.host+\"/wx/doctor/querydoctorbycityandprofession\";\r\n\t\tvar params = Tool.convertParams($scope.queryParams);\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.data.length<1){\r\n\t\t\t\tif($scope.doctors.length<1){\r\n\t\t\t\t\t$scope.noProductText = \"没有项目信息,请选择其他区域或者时间!\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t}\r\n\t\t\t\t$scope.noProduct = true;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.mergeDoctor(data.data);\r\n\t\t\t\t$scope.doctors = $scope.doctors.concat(data.data);\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t\t$scope.noProduct = true;\r\n\t\t\tTool.alert($scope,\"数据加载失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * 处理医生数据\r\n\t */\r\n\t$scope.mergeDoctor = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.score==\"\"||item.score==null){\r\n\t\t\t\titem.score=\"暂无评\";\r\n\t\t\t}\r\n\t\t\tif(item.sales==\"\"||item.sales==null){\r\n\t\t\t\titem.sales=0;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载下一页数据\r\n\t*/\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.queryParams.currentPage++;\r\n\t\t$scope.loadDoctor();\r\n\t}\r\n\r\n\t/**\r\n\t * 重置查询数据\r\n\t */\r\n\t$scope.resetDate = function(){\r\n\t\t$scope.queryParams.currentPage = 1;\r\n\t\t$scope.noProduct = false;\r\n\t\t$scope.noProductText = \"\";\r\n\t\t$scope.doctors = [];\r\n\t}\r\n\r\n\t/**\r\n\t* 跳转到详情页面\r\n\t*/\r\n\t$scope.detail = function(id){\r\n\t\tTool.goPage(\"/new/htmls/doctor-detail.html#?id=\"+id);\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}