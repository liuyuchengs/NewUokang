{"version":3,"sources":["orderCtrl.min.js"],"names":["app","controller","$scope","$http","Tool","orders","cancelOrderId","noOrder","status","btnParams","toPay","payed","canceled","tocancel","finish","filterParams","all","has","val","toHos","toAssess","angular","element","document","ready","loadUserinfo","loadOrder","url","getSession","params","userInfo","id","post","headers","Content-type","accessToken","success","data","code","length","merge","alert","message","hasTip","error","forEach","item","index","array","statusMes","discountprice","parseFloat","toFixed","order","setSession","appid","redirect_uri","goUrl","toCancel","comfirm","cancelFn","switchOrder","select"],"mappings":"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","file":"orderCtrl.min.js","sourcesContent":["app.controller(\"orderCtrl\",[\"$scope\",\"$http\",\"Tool\",function($scope,$http,Tool){\r\n\t$scope.orders;\r\n\t$scope.cancelOrderId;\r\n\t$scope.noOrder = false;\r\n\t$scope.status = \"\";\r\n\t$scope.btnParams = {\r\n\t\ttoPay:false,\r\n\t\tpayed:false,\r\n\t\tcanceled:false,\r\n\t\ttocancel:false,\r\n\t\tfinish:false,\r\n\t}\r\n\t$scope.filterParams = {\r\n\t\tall:{has:true,val:\"\"},\r\n\t\ttoPay:{has:false,val:\"0\"},\r\n\t\ttoHos:{has:false,val:\"2\"},\r\n\t\ttoAssess:{has:false,val:\"4\"}\r\n\t}\r\n\r\n\tangular.element(document).ready(function(){\r\n\t\tTool.loadUserinfo($scope);\r\n\t\t$scope.loadOrder();\r\n\t})\r\n\r\n\t//加载订单数据\r\n\t$scope.loadOrder = function(){\r\n\t\tvar url = Tool.getSession(\"host\")+\"/wx/order/queryOrderList\";\r\n\t\tvar params = \"userId=\"+$scope.userInfo.id+\"&status=\"+$scope.status;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders: {\r\n\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t   'accessToken':$scope.userInfo.accessToken\r\n\t\t\t }\r\n\t\t})\r\n\t\t.success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.length==0){\r\n\t\t\t\t\t$scope.noOrder=true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.noOrder = false;\r\n\t\t\t\t\t$scope.merge(data.data);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.orders = data.data;\r\n\t\t\t}else if(data.code==1){\r\n\t\t\t\tTool.alert($scope,data.message,function(){\r\n\t\t\t\t\t$scope.hasTip = false;\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"获取订单信息失败，请稍后再试!\",function(){\r\n\t\t\t\t\t$scope.hasTip = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"获取订单信息失败，请稍后再试!\",function(){\r\n\t\t\t\t$scope.hasTip = false;\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t//根据订单状态码，生成对应的状态信息,如支付中...\r\n\t$scope.merge = function(orders){\r\n\t\torders.forEach(function(item,index,array){\r\n\t\t\titem.toPay = false;\r\n\t\t\titem.payed = false;\r\n\t\t\titem.canceled = false;\r\n\t\t\titem.tocancel = false;\r\n\t\t\titem.finish = false;\r\n\t\t\tswitch(item.status){\r\n\t\t\t\tcase -1:\r\n\t\t\t\t\titem.statusMes = \"已取消\";\r\n\t\t\t\t\titem.canceled = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\titem.statusMes = \"待支付\";\r\n\t\t\t\t\titem.toPay = true;\r\n\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\tbreak;\r\n                case 1:\r\n                    item.statusMes = \"待确认\";\r\n\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\tbreak;\r\n                case 2:\r\n                    item.statusMes = \"待就医\";\r\n\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\titem.tocancel = true;\r\n\t\t\t\t\tbreak;\r\n                case 3:\r\n                    item.statusMes = \"就医中\";\r\n\t\t\t\t\titem.payed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\titem.statusMes = \"就医完成\";\r\n\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\titem.statusMes = \"就医完成\";\r\n\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\tbreak;\r\n                case 6:\r\n                    item.statusMes = \"退款中\";\r\n\t\t\t\t\tbreak;\r\n                case 7:\r\n                    item.statusMes = \"退款完成\";\r\n\t\t\t\t\titem.finish = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\titem.discountprice = parseFloat(item.discountprice).toFixed(2);\r\n\t\t});\r\n\t}\r\n\r\n\t//支付订单\r\n\t$scope.toPay = function(order){\r\n\t\tTool.setSession(\"order\",order);\r\n\t\tvar appid = \"wx0229404bc9eeea00\";\r\n\t\tvar redirect_uri = Tool.getSession(\"host\")+\"/new/htmls/pay.html\";\r\n\t\tvar url = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+appid+\"&redirect_uri=\"+redirect_uri+\"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect\";\r\n\t\tTool.goUrl(url);\r\n\t}\r\n\r\n\t//取消订单\r\n\t$scope.toCancel = function(id){\r\n\t\t$scope.cancelOrderId = id;\r\n\t\tTool.comfirm($scope,\"确定要取消订单吗？\",$scope.cancelFn);\r\n\t}\r\n\r\n\t//取消订单提示框，确认按钮回调\r\n\t$scope.cancelFn =function(){\r\n\t\tif($scope.hasTip){\r\n\t\t\t$scope.hasTip = false;\r\n\t\t}\r\n\t\tvar url = Tool.getSession(\"host\")+\"/wx/order/orderCacel\";\r\n\t\tvar params = \"id=\"+$scope.cancelOrderId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t'accessToken':$scope.userInfo.accessToken\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.status = \"\";\r\n\t\t\t\t$scope.loadOrder();\r\n\t\t\t}else if(data.code==1){\r\n\t\t\t\tTool.alert($scope,\"订单取消失败，请稍后再试!\",function(){\r\n\t\t\t\t\t$scope.hasTip = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"订单取消失败!\",function(){\r\n\t\t\t\t$scope.hasTip = false;\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t$scope.switchOrder = function(item){\r\n\t\tTool.select(item,$scope.filterParams);\r\n\t\t$scope.status = $scope.filterParams[item].val;\r\n\t\t$scope.loadOrder();\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}