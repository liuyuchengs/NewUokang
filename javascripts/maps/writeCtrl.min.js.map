{"version":3,"sources":["writeCtrl.min.js"],"names":["app","controller","$scope","$http","Tool","Ajax","postData","FormData","noBeforeSelect","noAfterSelect","beforeParams","input1","has","url","val","input2","input3","input4","input5","input6","afterParams","input7","input8","input9","queryParams","postName","postIntro","postContent","hospitalId","doctorId","productId","img1","img2","img3","p1","p2","p3","flag","switchParams","kanya","qiumei","yunsheng","order","orderInfo","select","value","load","loadHost","loadUserinfo","comfirm","goPage","loadOrder","listen","goTo","isLogin","$","on","getUrl","this","files","$apply","obj","undefined","window","createObjectURL","URL","webkitURL","item","mergeSay","imgStr","pStr","count","afterCount","file","Blob","type","index","prototype","append","get","mergeNote","beforeCount","prototypeB","prototypeA","addPost","merge","alert","host","loading","ajax","dataType","processData","contentType","cache","data","beforeSend","request","setRequestHeader","userInfo","accessToken","success","code","error","addSayPost","addNotePost","chooseSayPic","click","chooseBeforePic","chooseAfterPic","removeBefore","clear","removeAfter","selector","element","document","getElementById","outerHTML","params","id","post","headers","Content-type","result","filter","status","length","chooseOrder","chooseProduct","productName"],"mappings":"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","file":"writeCtrl.min.js","sourcesContent":["app.controller(\"writeCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.postData = new FormData();\r\n\t$scope.noBeforeSelect = true;\r\n\t$scope.noAfterSelect = true;\r\n\t$scope.beforeParams = {\r\n\t\tinput1:{has:false,url:\"\",val:\"#input1\"},\r\n\t\tinput2:{has:false,url:\"\",val:\"#input2\"},\r\n\t\tinput3:{has:false,url:\"\",val:\"#input3\"},\r\n\t\tinput4:{has:false,url:\"\",val:\"#input4\"},\r\n\t\tinput5:{has:false,url:\"\",val:\"#input5\"},\r\n\t\tinput6:{has:false,url:\"\",val:\"#input6\"},\r\n\t}\r\n\t$scope.afterParams = {\r\n\t\tinput7:{has:false,url:\"\",val:\"#input7\"},\r\n\t\tinput8:{has:false,url:\"\",val:\"#input8\"},\r\n\t\tinput9:{has:false,url:\"\",val:\"#input9\"},\r\n\t}\r\n\t$scope.queryParams ={\r\n\t\tpostName:null,\r\n\t\tpostIntro:null,\r\n\t\tpostContent:null,\r\n\t\thospitalId:null,\r\n\t\tdoctorId:null,\r\n\t\tproductId:null,\r\n\t\timg1:null,\r\n\t\timg2:null,\r\n\t\timg3:null,\r\n\t\tp1:null,\r\n\t\tp2:null,\r\n\t\tp3:null,\r\n\t\tflag:1,\r\n\t}\r\n\t//发帖类型信息\r\n\t$scope.switchParams = {\r\n\t\tkanya:{has:true,val:1},\r\n\t\tqiumei:{has:false,val:2},\r\n\t\tyunsheng:{has:false,val:3}\r\n\t}\r\n\t$scope.order = {\r\n\t\thas:false,\r\n\t\torderInfo:null,\r\n\t}\r\n\t$scope.select = {\r\n\t\thas:false,\r\n\t\tvalue:\"\"\r\n\t}\r\n\t/**\r\n\t** 页面初始化\r\n\t*/\r\n\t$scope.load = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\tTool.loadUserinfo($scope,function(){\r\n\t\t\t\tTool.comfirm($scope,\"您还没有登录，请先登录\",function(){\r\n\t\t\t\t\tTool.goPage(\"/new/htmls/user.html\");\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\t$scope.loadOrder();\r\n\t\t});\r\n\t\t$scope.listen();\r\n\t}\r\n\r\n\t/**\r\n\t** 跳转到具体的发帖页面\r\n\t*/\r\n\t$scope.goTo = function(url){\r\n\t\tif(Tool.isLogin()){\r\n\t\t\tTool.goPage(url);\r\n\t\t}else{\r\n\t\t\tTool.comfirm($scope,\"您还没有登录，请先登录\",function(){\r\n\t\t\t\tTool.goPage(\"/new/htmls/user.html\");\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 监听input元素选择图片\r\n\t*/\r\n\t$scope.listen = function(){\r\n\t\t$(\"#input1\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input1.has = true;\r\n\t\t\t$scope.beforeParams.input1.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input2\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input2.has = true;\r\n\t\t\t$scope.beforeParams.input2.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input3\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input3.has = true;\r\n\t\t\t$scope.beforeParams.input3.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input4\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input4.has = true;\r\n\t\t\t$scope.beforeParams.input4.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input5\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input5.has = true;\r\n\t\t\t$scope.beforeParams.input5.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input6\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.beforeParams.input6.has = true;\r\n\t\t\t$scope.beforeParams.input6.url = url;\r\n\t\t\t$scope.noBeforeSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input7\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.afterParams.input7.has = true;\r\n\t\t\t$scope.afterParams.input7.url = url;\r\n\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input8\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.afterParams.input8.has = true;\r\n\t\t\t$scope.afterParams.input8.url = url;\r\n\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t\t$(\"#input9\").on(\"change\",function(){\r\n\t\t\tvar url = $scope.getUrl(this.files[0]);\r\n\t\t\t$scope.afterParams.input9.has = true;\r\n\t\t\t$scope.afterParams.input9.url = url;\r\n\t\t\t$scope.noAfterSelect = false;\r\n\t\t\t$scope.$apply();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t** 获取input元素图片的url，做图片预览\r\n\t*/\r\n\t$scope.getUrl = function(obj){\r\n\t\tvar url = null;\r\n\t\tif (window.createObjectURL != undefined) { // basic\r\n\t\t\turl = window.createObjectURL(obj);\r\n\t\t} else if (window.URL != undefined) { // mozilla(firefox)\r\n\t\t\turl = window.URL.createObjectURL(obj);\r\n\t\t} else if (window.webkitURL != undefined) { // webkit or chrome\r\n\t\t\turl = window.webkitURL.createObjectURL(obj);\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t/**\r\n\t** 切换发帖类型\r\n\t*/\r\n\t$scope.switch =function(item){\r\n\t\tTool.select(item,$scope.switchParams);\r\n\t\tif($scope.switchParams[item]){\r\n\t\t\t$scope.queryParams.flag = $scope.switchParams[item].val;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 调整随便聊聊照片参数\r\n\t*/\r\n\t$scope.mergeSay = function(){\r\n\t\tvar imgStr = \"img\";\r\n\t\tvar pStr = \"p\";\r\n\t\tvar count = 1;\r\n\t\tvar afterCount = 3;\r\n\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\tfor(var index in $scope.beforeParams){\r\n\t\t\tvar prototype = $scope.beforeParams[index];\r\n\t\t\tif(prototype.has){\r\n\t\t\t\tif(count<4){\r\n\t\t\t\t\t$scope.postData.append(imgStr+count,$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.postData.append(pStr+(count-afterCount),$(prototype.val).get(0).files[0]);\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(count;count<7;count++){\r\n\t\t\tif(count<4){\r\n\t\t\t\t$scope.postData.append(imgStr+count,file);\r\n\t\t\t}else{\r\n\t\t\t\t$scope.postData.append(pStr+(count-afterCount),file);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t$scope.postData.append(\"postName\",$scope.queryParams.postName);\r\n\t\t$scope.postData.append(\"postContent\",$scope.queryParams.postContent);\r\n\t\t$scope.postData.append(\"flag\",$scope.queryParams.flag);\r\n\t}\r\n\r\n\t/*\r\n\t** 调整写日记参数\r\n\t*/\r\n\t$scope.mergeNote = function(){\r\n\t\tvar imgStr = \"img\";\r\n\t\tvar beforeCount = 1 ;\r\n\t\tvar file = new Blob([\"\"],{type:\"image/jpeg\"});\r\n\t\tfor(var index in $scope.beforeParams){\r\n\t\t\tvar prototypeB = $scope.beforeParams[index];\r\n\t\t\tif(prototypeB.has){\r\n\t\t\t\t$scope.postData.append(imgStr+beforeCount,$(prototypeB.val).get(0).files[0]);\r\n\t\t\t\tbeforeCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(beforeCount<4){\r\n\t\t\tfor(;beforeCount<4;beforeCount++){\r\n\t\t\t\t$scope.postData.append(imgStr+beforeCount,file);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar pStr = \"p\";\r\n\t\tvar afterCount = 1;\r\n\t\tfor(var index in $scope.afterParams){\r\n\t\t\tvar prototypeA = $scope.afterParams[index];\r\n\t\t\tif(prototypeA.has){\r\n\t\t\t\t$scope.postData.append(pStr+afterCount,$(prototypeA.val).get(0).files[0]);\r\n\t\t\t\tafterCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(afterCount<4){\r\n\t\t\tfor(;afterCount<4;afterCount++){\r\n\t\t\t\t$scope.postData.append(pStr+afterCount,file);\r\n\t\t\t}\r\n\t\t}\r\n\t\t$scope.postData.append(\"postName\",$scope.queryParams.postName);\r\n\t\t$scope.postData.append(\"postContent\",$scope.queryParams.postContent);\r\n\t\t$scope.postData.append(\"flag\",$scope.queryParams.flag);\r\n\t\t$scope.postData.append(\"productId\",$scope.queryParams.productId);\r\n\t\t$scope.postData.append(\"doctorId\",$scope.queryParams.doctorId);\r\n\t\t$scope.postData.append(\"hospitalId\",$scope.queryParams.hospitalId);\r\n\t}\r\n\r\n\t/**\r\n\t** 发帖功能\r\n\t*/\r\n\t$scope.addPost = function(merge){\r\n\t\tif($scope.queryParams.postName==\"\"||$scope.queryParams.postName==null||$scope.queryParams.postContent==\"\"||$scope.queryParams.postContent==null){\r\n\t\t\tTool.alert($scope,\"请填写发帖内容!\");\r\n\t\t}else{\r\n\t\t\tvar url = $scope.host+\"/wx/post/addPost\";\r\n\t\t\tmerge();\r\n\t\t\t$scope.loading = true;\r\n\t\t\t$.ajax({\r\n\t\t\t    type: \"POST\",\r\n\t\t\t    url: url,\r\n\t\t\t    dataType: 'json',\r\n\t\t\t    processData: false,\r\n\t\t\t    contentType: false,\r\n\t\t\t    cache: false,\r\n\t\t\t    data: $scope.postData,\r\n\t\t\t\tbeforeSend: function (request) {\r\n\t\t\t\t\trequest.setRequestHeader(\"accessToken\", $scope.userInfo.accessToken);\r\n\t\t\t\t},\r\n\t\t\t\tsuccess:function(data){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\tif(data.code==0){\r\n\t\t\t\t\t\tTool.goPage(\"/new/htmls/interaction.html\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tTool.alert($scope,\"连接数据失败，请稍后再试!\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror:function(){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t$scope.postData = new FormData();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 发布随便说说帖子\r\n\t*/\r\n\t$scope.addSayPost = function(){\r\n\t\t$scope.addPost($scope.mergeSay);\r\n\t}\r\n\r\n\t/**\r\n\t** 发布写日记\r\n\t*/\r\n\t$scope.addNotePost = function(){\r\n\t\tif(!$scope.select.has){\r\n\t\t\tif($scope.queryParams.productId==null||$scope.queryParams.hospitalId==null||$scope.queryParams.doctorId==null){\r\n\t\t\t\tTool.alert($scope,\"请选择项目信息\");\r\n\t\t\t}else{\r\n\t\t\t\t$scope.addPost($scope.mergeNote);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tTool.alert($scope,\"您还没有已完成的项目，暂不能写日记\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 触发随便说说选择照片\r\n\t*/\r\n\t$scope.chooseSayPic = function(){\r\n\t\tvar count = 0;\r\n\t\tfor(var item in $scope.beforeParams){\r\n\t\t\tvar prototype = $scope.beforeParams[item];\r\n\t\t\tcount++;\r\n\t\t\tif(!prototype.has){\r\n\t\t\t\t$(prototype.val).click();\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(count==6){\r\n\t\t\tTool.alert($scope,\"最多只能上传6张图片!\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 触发写日记选择术前照片\r\n\t*/\r\n\t$scope.chooseBeforePic = function(){\r\n\t\tvar count = 0;\r\n\t\tfor(var item in $scope.beforeParams){\r\n\t\t\tcount++;\r\n\t\t\tif(count<4){\r\n\t\t\t\tvar prototype = $scope.beforeParams[item];\r\n\t\t\t\tif(!prototype.has){\r\n\t\t\t\t\t$(prototype.val).click();\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"术后最多上传三张照片\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 触发写日记选择术后照片\r\n\t*/\r\n\t$scope.chooseAfterPic = function(){\r\n\t\tvar count = 0;\r\n\t\tfor(var item in $scope.afterParams){\r\n\t\t\tcount++;\r\n\t\t\tvar prototype = $scope.afterParams[item];\r\n\t\t\tif(!prototype.has){\r\n\t\t\t\t$(prototype.val).click();\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(count==3){\r\n\t\t\tTool.alert($scope,\"术后最多上传三张照片\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 删除术前图片\r\n\t*/\r\n\t$scope.removeBefore = function(item){\r\n\t\tif($scope.beforeParams[item]){\r\n\t\t\t$scope.beforeParams[item].has=false;\r\n\t\t\t$scope.beforeParams[item].url=\"\";\r\n\t\t\t$scope.clear(item);\r\n\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 删除术后图片\r\n\t*/\r\n\t$scope.removeAfter = function(item){\r\n\t\tif($scope.afterParams[item]){\r\n\t\t\t$scope.afterParams[item].has=false;\r\n\t\t\t$scope.afterParams[item].url=\"\";\r\n\t\t\t$scope.clear(item);\r\n\t\t\t$scope.listen(); //替换input后重新监听\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 重新替换要重新选择图片的input元素\r\n\t*/\r\n\t$scope.clear = function(selector){\r\n\t\tvar element = document.getElementById(selector);\r\n\t\telement.outerHTML = element.outerHTML; //重新替换Input元素\r\n\t}\r\n\r\n\t/*\r\n\t** 发帖页面加载用户已完成订单信息\r\n\t*/\r\n\t$scope.loadOrder = function(){\r\n\t\tvar url = $scope.host + \"/wx/order/queryOrderList\";\r\n\t\tvar params = \"status=&userId=\"+$scope.userInfo.id+\"\";\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders: {\r\n\t\t\t   'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t   'accessToken':$scope.userInfo.accessToken\r\n\t\t\t }\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code===0){\r\n\t\t\t\tvar result = data.data.filter(function(item){\r\n\t\t\t\t\treturn item.status==4;\r\n\t\t\t\t})\r\n\t\t\t\tif(result.length>0){\r\n\t\t\t\t\t$scope.order.has = true;\r\n\t\t\t\t\t$scope.order.orderInfo = result;\r\n\t\t\t\t}\r\n\t\t\t\tfor(var index in $scope.order.orderInfo){\r\n\t\t\t\t\t$scope.order.orderInfo[index].has = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"加载订单信息失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 触发项目选择\r\n\t*/\r\n\t$scope.chooseOrder = function(){\r\n\t\tif($scope.order.has){\r\n\t\t\t$scope.select.has = !$scope.select.has;\r\n\t\t}else{\r\n\t\t\tTool.alert($scope,\"您还没有已完成的项目，暂不能写日记\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 选择项目\r\n\t*/\r\n\t$scope.chooseProduct = function(id){\r\n\t\t//先清理掉以选择的项\r\n\t\tfor(var prototype in $scope.order.orderInfo){\r\n\t\t\tif($scope.order.orderInfo[prototype].has){\r\n\t\t\t\t$scope.order.orderInfo[prototype].has = false;\r\n\t\t\t\t$scope.queryParams.productId = null;\r\n\t\t\t\t$scope.queryParams.doctorId = null;\r\n\t\t\t\t$scope.queryParams.hospitalId = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//再选择要选择的项\r\n\t\tfor(var prototype in $scope.order.orderInfo){\r\n\t\t\tif($scope.order.orderInfo[prototype].id==id){\r\n\t\t\t\t$scope.order.orderInfo[prototype].has = true;\r\n\t\t\t\t$scope.select.value = $scope.order.orderInfo[prototype].productName;\r\n\t\t\t\t$scope.select.has = false;\r\n\t\t\t\t$scope.queryParams.productId = $scope.order.orderInfo[prototype].productId;\r\n\t\t\t\t$scope.queryParams.doctorId = $scope.order.orderInfo[prototype].doctorId;\r\n\t\t\t\t$scope.queryParams.hospitalId = $scope.order.orderInfo[prototype].hospitalId;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}