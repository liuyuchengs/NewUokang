{"version":3,"sources":["detailCtrl.js"],"names":["app","controller","$scope","$http","$location","Tool","Ajax","selectTime","hasDoctor","noSelectTime","hasDocSchedule","loading","selectDoc","hosId","proId","hasDiscount","productInfo","hospitalInfo","doctorInfo","productImg","url","hospitalImg","scheduleInfo","scheduleParams","order","hospitalId","doctorId","productId","scheduleId","doctorName","treatmentTime","hospitalName","hospitalAddress","preferPrice","productName","flag","dealMoney","payMoney","realMoney","giftMoney","code","discountid","init","loadHost","loadQueryParams","queryProduct","queryProductImg","queryHospitalImg","queryDoctor","queryHospital","search","back","window","history","host","params","post","headers","Content-type","success","data","mergeProdcut","title","preferPriceType","error","alert","hasTip","get","length","mergeImg","logo","name","address","list","forEach","item","face","score","selectTimeValue","hasSelecTimeValue","queryDoctorSchedule","docId","mergeSchedule","chooseSchedule","chooseTime","scheId","date","select","mergeDocSelect","orderDetail","isLogin","isUserInfoComplete","loadUserinfo","paramsStr","convertParams","accessToken","userInfo","parseFloat","setSession","goPage","comfirm","items","priceunit","pricetype","smallImg","money","Itemindex","Timeindex","timeList","time","scheduleid","has","value","id"],"mappings":"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","file":"detailCtrl.js","sourcesContent":["app.controller(\"detailCtrl\",[\"$scope\",\"$http\",\"$location\",\"Tool\",\"Ajax\",function($scope,$http,$location,Tool,Ajax){\r\n\t$scope.selectTime = false;\r\n\t$scope.hasDoctor = false;\r\n\t$scope.noSelectTime = true;\r\n\t$scope.hasDocSchedule = \"\";\r\n\t$scope.loading = false;\r\n\t$scope.selectDoc =\"\";\r\n\t$scope.hosId;\r\n\t$scope.proId;\r\n\t$scope.hasDiscount=false;\r\n\t$scope.productInfo;\r\n\t$scope.hospitalInfo;\r\n\t$scope.doctorInfo = [];\r\n\t$scope.productImg = [\r\n\t\t{\r\n\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t},{\r\n\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t}];\r\n\t$scope.hospitalImg = [\r\n\t\t{\r\n\t\t\t\"url\":\"../../contents/img/p_default.png\"\r\n\t\t}];\r\n\t$scope.scheduleInfo = [];\r\n\t$scope.scheduleParams = {};\r\n\t$scope.order = {\r\n\t\thospitalId:\"\",\r\n\t    doctorId:\"\",\r\n\t    productId:\"\",\r\n\t    scheduleId:\"\",\r\n\t    doctorName:\"\",\r\n\t    treatmentTime:\"\",\r\n\t    hospitalName:\"\",\r\n\t    hospitalAddress:\"\",\r\n\t    preferPrice:\"\",\r\n\t    productName:\"\",\r\n\t    flag:null,\r\n\t    dealMoney:\"\",\r\n\t    payMoney:\"\",\r\n\t    realMoney:\"\",\r\n\t    giftMoney:\"\",\r\n\t\tcode:null,\r\n\t\tdiscountid:null,\r\n\t}\r\n\r\n\r\n\t/*\r\n\t** 初始化页面\r\n\t*/\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loadQueryParams();\r\n\t\t\t$scope.order.hospitalId = $scope.hosId;\r\n\t\t\t$scope.order.productId = $scope.proId;\r\n\t\t\t$scope.queryProduct();\r\n\t\t\t$scope.queryProductImg();\r\n\t\t\t$scope.queryHospitalImg();\r\n\t\t\t$scope.queryDoctor();\r\n\t\t\t$scope.queryHospital();\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载url参数\r\n\t*/\r\n\t$scope.loadQueryParams = function(){\r\n\t\t$scope.hosId = $location.search().hospitalId;\r\n\t\t$scope.proId = $location.search().productId;\r\n\t\tif($location.search().flag){\r\n\t\t\t$scope.order.flag = $location.search().flag;\r\n\t\t}\r\n\t\tif($location.search().discountid){\r\n\t\t\t$scope.order.discountid = $location.search().discountid;\r\n\t\t\t$scope.hasDiscount = true;\r\n\t\t}\r\n\t\tif($location.search().code){\r\n\t\t\t$scope.order.code = $location.search().code;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 返回上一页\r\n\t*/\r\n\t$scope.back = function(){\r\n\t\twindow.history.back();\r\n\t}\r\n\r\n\t/*\r\n\t** 查询项目信息\r\n\t*/\r\n\t$scope.queryProduct = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar url = $scope.host+\"/wx/product/querybyid\";\r\n\t\tvar params = \"productId=\"+$scope.proId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\t$scope.mergeProdcut(data);\r\n\t\t\t$scope.productInfo = data;\r\n\t\t\t$scope.order.productName = $scope.productInfo.title;\r\n\t\t\t$scope.order.preferPrice = \"￥\"+$scope.productInfo.preferPrice+$scope.productInfo.preferPriceType;\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"获取项目详细信息错误，请稍后再试!\",function(){\r\n\t\t\t\t$scope.hasTip = false;\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 查询项目图片\r\n\t*/\r\n\t$scope.queryProductImg = function(){\r\n\t\tvar url = $scope.host+\"/wx/image/querybymainid?type=PRODUCT&mainId=\"+$scope.proId;\r\n\t\t$http.get(url,{\r\n\t\t\theaders:{\r\n\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\"\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.length>0){\r\n\t\t\t\t$scope.mergeImg(data);\r\n\t\t\t\t$scope.productImg = data;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载医院信息\r\n\t*/\r\n\t$scope.queryHospital = function(){\r\n\t\tvar url = $scope.host+\"/wx/hospital/querybyid?id=\"+$scope.hosId;\r\n\t\t$http.get(url,{\r\n\t\t\theaders:{\r\n\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\"\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\t$scope.hospitalInfo = data;\r\n\t\t\tif($scope.hospitalInfo.logo==\"\"||$scope.hospitalInfo.logo==null){\r\n\t\t\t\t$scope.hospitalInfo.logo = \"../../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t\t$scope.order.hospitalName = data.name;\r\n\t\t\t$scope.order.hospitalAddress = data.address;\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"医院信息加载失败，请稍后再试!\",function(){\r\n\t\t\t\t$scope.hasTip = false;\r\n\t\t\t});\r\n\t\t\t$scope.loading = false;\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 查询医院图片\r\n\t*/\r\n\t$scope.queryHospitalImg = function(){\r\n\t\tvar url = $scope.host+\"/wx/image/querybymainid?type=HOSPITAL&mainId=\"+$scope.hosId;\r\n\t\t$http.get(url,{\r\n\t\t\theaders:{\r\n\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\"\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.length>0){\r\n\t\t\t\t$scope.mergeImg(data);\r\n\t\t\t\t$scope.hospitalImg = data;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 查询医生信息\r\n\t*/\r\n\t$scope.queryDoctor = function(){\r\n\t\tvar url= $scope.host +\"/wx/doctor/queryscheduledoctorbyproductid\";\r\n\t\tvar params = \"productId=\"+$scope.proId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\"\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.list.length>0){\r\n\t\t\t\t$scope.hasDoctor = true;\r\n\t\t\t\t$scope.doctorInfo = data.list;\r\n\t\t\t\t$scope.doctorInfo.forEach(function(item){\r\n\t\t\t\t\tif(item.face==\"\"||item.face==null){\r\n\t\t\t\t\t\titem.face=\"../../contents/img/p_default.png\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(item.score==\"\"||item.score==null){\r\n\t\t\t\t\t\titem.score = \"暂无评\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\titem.selectTimeValue = \"请选择\";\r\n\t\t\t\t\titem.hasSelecTimeValue = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"医生数据加载失败!\",function(){\r\n\t\t\t\t$scope.hasTip = false;\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 查询医生排班信息\r\n\t*/\r\n\t$scope.queryDoctorSchedule = function(docId){\r\n\t\tif($scope.hasDocSchedule==docId){\r\n\t\t\t$scope.selectTime = true;\r\n\t\t}else{\r\n\t\t\t$scope.loading = true;\r\n\t\t\tvar url = $scope.host+\"/wx/schedule/querybydoctorid?doctorId=\"+docId;\r\n\t\t\t$http.get(url,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\"\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\t$scope.mergeSchedule(data);\r\n\t\t\t\t$scope.scheduleInfo = data;\r\n\t\t\t\t$scope.loading = false;\r\n\t\t\t\t$scope.selectTime = true;\r\n\t\t\t\t$scope.hasDocSchedule = docId;\r\n\t\t\t}).error(function(){\r\n\t\t\t\tTool.alert($scope,\"医生排班信息加载失败!\",function(){\r\n\t\t\t\t\t$scope.hasTip = false;\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 选择就医时间按钮\r\n\t*/\r\n\t$scope.chooseSchedule = function(docId,name){\r\n\t\t$scope.order.doctorId = docId;\r\n\t\t$scope.order.doctorName = name;\r\n\t\t$scope.queryDoctorSchedule(docId);\r\n\t\t$scope.selectDoc = docId;\r\n\t}\r\n\r\n\t/*\r\n\t** 选择具体的就医时间\r\n\t*/\r\n\t$scope.chooseTime = function(scheId,date){\r\n\t\tTool.select(scheId,$scope.scheduleParams);\r\n\t\t$scope.order.scheduleId = scheId;\r\n\t\t$scope.order.treatmentTime = date;\r\n\t\t$scope.mergeDocSelect($scope.selectDoc,date);\r\n\t\t$scope.selectTime = false;\r\n\t\t$scope.noSelectTime = false;\r\n\t}\r\n\r\n\t/*\r\n\t** 下单按钮时间\r\n\t*/\r\n\t$scope.orderDetail = function(){\r\n\t\tif(!$scope.noSelectTime){\r\n\t\t\tif(!Tool.isLogin()){\r\n\t\t\t\tTool.comfirm($scope,\"请先登录并完善个人信息\",function(){\r\n\t\t\t\t\tTool.goPage(\"/new/htmls/login.html\");\r\n\t\t\t\t})\r\n\t\t\t}else if(!Tool.isUserInfoComplete()){\r\n\t\t\t\tTool.comfirm($scope,\"请完善个人信息!\",function(){\r\n\t\t\t\t\tTool.goPage(\"/new/htmls/userinfo.html\");\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\t$scope.loading = true;\r\n\t\t\t\tTool.loadUserinfo($scope);\r\n\t\t\t\tvar url = $scope.host +\"/wx/order/checkCodeMoney\";\r\n\t\t\t\tvar params = {\r\n\t\t\t\t\tproductId:$scope.order.productId\r\n\t\t\t\t};\r\n\t\t\t\tif($scope.order.code){\r\n\t\t\t\t\tparams.code = $scope.order.code;\r\n\t\t\t\t};\r\n\t\t\t\tif($scope.order.discountid){\r\n\t\t\t\t\tparams.discountid = $scope.order.discountid;\r\n\t\t\t\t};\r\n\t\t\t\tvar paramsStr = Tool.convertParams(params);\r\n\t\t\t\t$http.post(url,paramsStr,{\r\n\t\t\t\t\theaders:{\r\n\t\t\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\",\r\n\t\t\t\t\t\t\"accessToken\":$scope.userInfo.accessToken\r\n\t\t\t\t\t}\r\n\t\t\t\t}).success(function(data){\r\n\t\t\t\t\tTool.loading = false;\r\n\t\t\t\t\t$scope.order.dealMoney = data.dealMoney;\r\n                    $scope.order.payMoney = data.payMoney;\r\n                    $scope.order.realMoney = data.realMoney;\r\n                    $scope.order.giftMoney = data.giftMoney;\r\n\t\t\t\t\tif(parseFloat($scope.order.giftMoney)<=0&&$scope.order.flag!=11){\r\n\t\t\t\t\t\t$scope.order.flag = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tTool.setSession(\"makeorder\",$scope.order);\r\n\t\t\t\t\tTool.goPage(\"/new/htmls/makeorder.html\");\r\n\t\t\t\t}).error(function(){\r\n\t\t\t\t\tTool.loading = false;\r\n\t\t\t\t\tTool.alert($scope,\"加载App付款金额失败!\",function(){\r\n\t\t\t\t\t\t$scope.hasTip = false;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 图片为空时，设置默认图片,onerror无法处理src为空\r\n\t*/\r\n\t$scope.mergeImg = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.url==\"\"||item.url==null){\r\n\t\t\t\titem.url = \"../../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 修改项目信息\r\n\t*/\r\n\t$scope.mergeProdcut = function(data){\r\n\t\tif(data.priceunit!=null&&data.priceunit!=\"\"){\r\n\t\t\tdata.preferPriceType = data.pricetype+\"/\"+data.priceunit;\r\n\t\t}else{\r\n\t\t\tdata.preferPriceType = data.pricetype;\r\n\t\t}\r\n\t\tif(data.smallImg==\"\"||data.smallImg==null){\r\n\t\t\tdata.smallImg = \"../contents/img/p_default.png\";\r\n\t\t}\r\n\t\tif($location.search().money){\r\n\t\t\tdata.preferPrice = $location.search().money;\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t** 截取排班参数\r\n\t*/\r\n\t$scope.mergeSchedule = function(items){\r\n\t\tfor(var Itemindex in items){\r\n\t\t\tvar item = items[Itemindex];\r\n\t\t\tfor(var Timeindex in item.timeList){\r\n\t\t\t\tvar time = item.timeList[Timeindex];\r\n\t\t\t\tif(Itemindex==0&&Timeindex==0){\r\n\t\t\t\t\t$scope.scheduleParams[time.scheduleid] = {\r\n\t\t\t\t\t\thas:true,\r\n\t\t\t\t\t\tvalue:time.date,\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.scheduleParams[time.scheduleid] = {\r\n\t\t\t\t\t\thas:false,\r\n\t\t\t\t\t\tvalue:time.date,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t** 改变就医时间的选取值\r\n\t*/\r\n\t$scope.mergeDocSelect = function(docId,value){\r\n\t\t$scope.doctorInfo.forEach(function(item){\r\n\t\t\tif(item.id==docId){\r\n\t\t\t\titem.selectTimeValue = value;\r\n\t\t\t\titem.hasSelecTimeValue = true;\r\n\t\t\t}else{\r\n\t\t\t\titem.selectTimeValue = \"请选择\";\r\n\t\t\t\titem.hasSelecTimeValue = false;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}