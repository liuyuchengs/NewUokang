{"version":3,"sources":["examDetailCtrl.js"],"names":["app","controller","$scope","$http","$location","Tool","Ajax","loading","productId","hospitalId","product","productItem","schedules","hospital","hospitalImg","noSchedule","noSelectTime","scheduleParams","filterParams","has","notice","order","doctorId","scheduleId","doctorName","treatmentTime","hospitalName","hospitalAddress","preferPrice","productName","flag","dealMoney","payMoney","realMoney","giftMoney","code","discountid","init","loadHost","loadParams","loadProduct","loadHospital","loadHopitalImg","loadProductItem","loadSchedule","item","select","back","window","history","search","url","host","params","post","headers","Content-type","success","data","length","mergeSchedule","error","alert","items","index","scheduleid","val","dateStr","mergeProduct","title","preferPriceType","priceunit","pricetype","smallImg","mergeHospital","address","name","logo","selectTimeBtn","hasSelectTime","cancelTime","selectTime","id","detail","isLogin","isUserInfoComplete","accessToken","getLocal","parseFloat","setSession","goPage","comfirm"],"mappings":"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","file":"examDetailCtrl.js","sourcesContent":["app.controller(\"examDetailCtrl\",[\"$scope\",\"$http\",\"$location\",\"Tool\",\"Ajax\",function($scope,$http,$location,Tool,Ajax){\r\n\t$scope.loading = false;\r\n\t$scope.productId = null;\r\n\t$scope.hospitalId = null;\r\n\t$scope.product = null;\r\n\t$scope.productItem = [];\r\n\t$scope.schedules = [];\r\n\t$scope.hospital = null;\r\n\t$scope.hospitalImg = null;\r\n\t$scope.noSchedule = false;\r\n\t$scope.noSelectTime = false;\r\n\t$scope.scheduleParams = {};\r\n\t$scope.filterParams = {\r\n\t\tproduct:{has:true},\r\n\t\thospital:{has:false},\r\n\t\tnotice:{has:false},\r\n\t}\r\n\t$scope.order = {\r\n\t\thospitalId:\"\",\r\n\t    doctorId:\"\",\r\n\t    productId:\"\",\r\n\t    scheduleId:\"\",\r\n\t    doctorName:\"\",\r\n\t    treatmentTime:\"\",\r\n\t    hospitalName:\"\",\r\n\t    hospitalAddress:\"\",\r\n\t    preferPrice:\"\",\r\n\t    productName:\"\",\r\n\t    flag:1,\r\n\t    dealMoney:\"\",\r\n\t    payMoney:\"\",\r\n\t    realMoney:\"\",\r\n\t    giftMoney:\"\",\r\n\t\tcode:null,\r\n\t\tdiscountid:null,\r\n\t}\r\n\r\n\t/*\r\n\t** 页面初始化\r\n\t*/\r\n\t$scope.init = function(){\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loading = true;\r\n\t\t\t$scope.loadParams();\r\n\t\t\t$scope.loadProduct();\r\n\t\t\t$scope.loadHospital();\r\n\t\t\t$scope.loadHopitalImg();\r\n\t\t\t$scope.loadProductItem();\r\n\t\t\t$scope.loadSchedule();\r\n\t\t\t$scope.loading = false;\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 切换导航条\r\n\t*/\r\n\t$scope.switch = function(item){\r\n\t\tTool.select(item,$scope.filterParams);\r\n\t}\r\n\r\n\t/*\r\n\t** 返回上一页\r\n\t*/\r\n\t$scope.back = function(){\r\n\t\twindow.history.back();\r\n\t}\r\n\r\n\t/*\r\n\t** 获取url参数\r\n\t*/\r\n\t$scope.loadParams = function(){\r\n\t\tif($location.search().productId){\r\n\t\t\t$scope.productId = $location.search().productId;\r\n\t\t\t$scope.order.productId = $scope.productId;\r\n\t\t}\r\n\t\tif($location.search().hospitalId){\r\n\t\t\t$scope.hospitalId = $location.search().hospitalId;\r\n\t\t\t$scope.order.hospitalId = $scope.hospitalId;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载排班信息\r\n\t*/\r\n\t$scope.loadSchedule = function(){\r\n\t\tvar url = $scope.host+\"/wx/schedule/querybyhospitalid\";\r\n\t\tvar params = \"hospitalId=\"+$scope.hospitalId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.length>0){\r\n\t\t\t\t$scope.mergeSchedule(data);\r\n\t\t\t\t$scope.schedules = data;\r\n\r\n\t\t\t}else{\r\n\t\t\t\t$scope.noSchedule = true;\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert(\"加载排班信息失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 保存排班信息\r\n\t*/\r\n\t$scope.mergeSchedule = function(items){\r\n\t\tfor(var index in items){\r\n\t\t\tvar item  = items[index];\r\n\t\t\tif(index==0){\r\n\t\t\t\t$scope.scheduleParams[item.scheduleid] = {\r\n\t\t\t\t\thas:true,\r\n\t\t\t\t\tval:item.dateStr,\r\n\t\t\t\t}\r\n\t\t\t\t$scope.order.treatmentTime = item.dateStr;\r\n\t\t\t\t$scope.order.scheduleId = item.scheduleid;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.scheduleParams[item.scheduleid] = {\r\n\t\t\t\t\thas:false,\r\n\t\t\t\t\tval:item.dateStr,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载体检套餐信息\r\n\t*/\r\n\t$scope.loadProduct = function(){\r\n\t\tvar url = $scope.host+\"/wx/product/packagedetal\";\r\n\t\tvar params = \"packageid=\"+$scope.productId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.mergeProduct(data.data);\r\n\t\t\t\t$scope.product = data.data;\r\n\t\t\t\t$scope.order.productName = $scope.product.title;\r\n\t\t\t\t$scope.order.preferPrice = $scope.product.preferPrice+$scope.product.preferPriceType;\r\n\t\t\t}else{\r\n\t\t\t\tTool.alert($scope,\"加载套餐信息失败，请稍后再试!\");\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"加载套餐信息失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 体检套餐为空时，使用默认图片\r\n\t*/\r\n\t$scope.mergeProduct = function(item){\r\n\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t}else{\r\n\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t}\r\n\t\tif(item.smallImg==\"\"||item.smallImg==null){\r\n\t\t\titem.smallImg = \"../contents/img/p_default.png\";\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载体检套餐的项目信息\r\n\t*/\r\n\t$scope.loadProductItem = function(){\r\n\t\tvar url = $scope.host+\"/wx/product/packagedetalItem\";\r\n\t\tvar params = \"packageid=\"+$scope.productId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\t$scope.productItem = data;\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"加载体检项目失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 加载医院信息\r\n\t*/\r\n\t$scope.loadHospital = function(){\r\n\t\tvar url = $scope.host+\"/wx/product/hospitalbyid\";\r\n\t\tvar params = \"id=\"+$scope.hospitalId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.mergeHospital(data.data);\r\n\t\t\t\t$scope.hospital = data.data;\r\n\t\t\t\t$scope.order.hospitalAddress = $scope.hospital.address;\r\n\t\t\t\t$scope.order.hospitalName = $scope.hospital.name;\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"加载医院信息失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 医院图片为空时，使用默认图片\r\n\t*/\r\n\t$scope.mergeHospital = function(item){\r\n\t\tif(item.logo==\"\"||item.logo==null){\r\n\t\t\titem.logo = \"../contents/img/p_default.png\";\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 加载医院图片\r\n\t*/\r\n\t$scope.loadHopitalImg = function(){\r\n\t\tvar url = $scope.host+\"/wx/image/querybymainid\";\r\n\t\tvar params = \"type=HOSPITAL&mainId=\"+$scope.hospitalId;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data[0].url==\"\"|data[0].url==null){\r\n\t\t\t\tdata[0].url = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t\t$scope.hospitalImg = data[0].url;\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 打开选择时间按钮\r\n\t*/\r\n\t$scope.selectTimeBtn = function(){\r\n\t\tif(!$scope.noSchedule){\r\n\t\t\t$scope.hasSelectTime = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 取消选择时间\r\n\t*/\r\n\t$scope.cancelTime = function(){\r\n\t\t$scope.hasSelectTime = false;\r\n\t}\r\n\r\n\t/*\r\n\t** 选择时间\r\n\t*/\r\n\t$scope.selectTime = function(id){\r\n\t\tif(!$scope.noSchedule){\r\n\t\t\tTool.select(id,$scope.scheduleParams);\r\n\t\t\t$scope.order.treatmentTime = $scope.scheduleParams[id].val;\r\n\t\t\t$scope.order.scheduleId = id;\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t** 跳转到详细页面\r\n\t*/\r\n\t$scope.detail = function(){\r\n\t\tif(!Tool.isLogin()){\r\n\t\t\tTool.comfirm($scope,\"请先登录并完善个人信息!\",function(){\r\n\t\t\t\tTool.goPage(\"/new/htmls/login.html\");\r\n\t\t\t})\r\n\t\t}else if(!Tool.isUserInfoComplete()){\r\n\t\t\tTool.comfirm($scope,\"请完善个人信息!\",function(){\r\n\t\t\t\tTool.goPage(\"/new/htmls/userinfo.html\");\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t$scope.loading = true;\r\n\t\t\tvar url = $scope.host+\"/wx/order/checkCodeMoney\";\r\n\t\t\tvar params = \"productId=\"+$scope.order.productId;\r\n\t\t\tvar accessToken = Tool.getLocal(\"accessToken\");\r\n\t\t\t$http.post(url,params,{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\t\"Content-type\":\"application/x-www-form-urlencoded;charset=UTF-8\",\r\n\t\t\t\t\t\"accessToken\":accessToken\r\n\t\t\t\t}\r\n\t\t\t}).success(function(data){\r\n\t\t\t\t$scope.loading=false;\r\n\t\t\t\t$scope.order.dealMoney = data.dealMoney;\r\n\t\t\t\t$scope.order.payMoney = data.payMoney;\r\n\t\t\t\t$scope.order.realMoney = data.realMoney;\r\n\t\t\t\t$scope.order.giftMoney = data.giftMoney;\r\n\t\t\t\tif(parseFloat($scope.order.giftMoney)<=0){\r\n\t\t\t\t\t$scope.order.flag = null;\r\n\t\t\t\t}\r\n\t\t\t\tTool.setSession(\"makeorder\",$scope.order);\r\n\t\t\t\tTool.goPage(\"/new/htmls/makeorder.html\");\r\n\t\t\t}).error(function(){\r\n\t\t\t\t$scope.loading=false;\r\n\t\t\t\tTool.alert($scope,\"加载App付款金额失败!\")\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n}])\r\n"],"sourceRoot":"/source/"}