{"version":3,"sources":["homeCtrl.js"],"names":["app","controller","$scope","$http","Tool","Ajax","Weixin","host","loading","items","currentPage","noProduct","noProductText","banners","hasHomeMenu","key","locationInfo","imgStyle","width","screen","gotoMenu","path","goPage","init","loadHost","loadRecommend","queryBanner","initSwiper","getSession","city","wxInit","getLocation","wxConfig","latitude","longitude","url","jsonp","success","data","status","result","address_component","setSession","error","window","onscroll","body","document","html","documentElement","height","Math","max","scrollHeight","offsetHeight","clientHeight","innerHeight","scrollY","loadNext","params","post","headers","Content-type","code","length","mergeProdcut","concat","alert","forEach","item","priceunit","preferPriceType","pricetype","samllimg","mergeBanner","index","Swiper","loop","pagination","autoplay","autoplayDisableOnInteraction","observeParents","observer","detail","productId","hospitalId","flag","menuClick","value","mess"],"mappings":"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","file":"homeCtrl.js","sourcesContent":["app.controller(\"homeCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",\"Weixin\",function($scope,$http,Tool,Ajax,Weixin){\r\n\t$scope.host = \"\";\r\n\t$scope.loading =false;\r\n\t$scope.items = [];\r\n\t$scope.currentPage = 1;\r\n\t$scope.noProduct = false;\r\n\t$scope.noProductText = \"\";\r\n\t$scope.banners = [];\r\n\t$scope.hasHomeMenu = true;\r\n\t$scope.key = \"LFQBZ-7UNCX-VDR44-T34PN-OX2VQ-M2BNI\"; //个人私钥，后续可更换为企业密钥\r\n\t$scope.locationInfo =\"定位中..\"\r\n\t$scope.imgStyle = {\r\n\t\t\"width\":screen.width\r\n\t}\r\n\t$scope.gotoMenu = function(path){\r\n\t\tTool.goPage(path);\r\n\t}\r\n\r\n\t$scope.init = function(){\r\n\t\t$scope.loading = true;\r\n\t\tAjax.loadHost($scope,function(){\r\n\t\t\t$scope.loadRecommend();\r\n\t\t\t$scope.queryBanner();\r\n\t\t\t$scope.initSwiper();\r\n\t\t\tif(Tool.getSession(\"locationInfo\")){\r\n\t\t\t\t$scope.locationInfo = Tool.getSession(\"locationInfo\").city;\r\n\t\t\t}else{\r\n\t\t\t\tWeixin.wxInit($scope,$scope.getLocation);\r\n\t\t\t\tWeixin.wxConfig($scope);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t//逆地址服务\r\n\t$scope.getLocation = function(latitude,longitude){\r\n\t\tvar url = \"https://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&callback=JSON_CALLBACK&location=\"+latitude+\",\"+longitude+\"&key=\"+$scope.key;\r\n\t\t$http.jsonp(url).success(function(data){\r\n\t\t\tif(data.status==0){\r\n\t\t\t\t$scope.locationInfo = data.result.address_component.city;\r\n\t\t\t\tvar locationInfo = Tool.getSession(\"locationInfo\");\r\n\t\t\t\tlocationInfo.city = data.result.address_component.city;\r\n\t\t\t\tTool.setSession(\"locationInfo\",locationInfo);\r\n\t\t\t}else{\r\n\t\t\t\t$scope.locationInfo = \"定位失败\";\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\t$scope.locationInfo = \"定位失败\";\r\n\t\t})\r\n\r\n\t}\r\n\r\n\t//滚动监听\r\n\twindow.onscroll = function(){\r\n\t\tif($scope.loading||$scope.noProduct){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar body = document.body;\r\n\t    var html = document.documentElement;\r\n\t\tvar height = Math.max( body.scrollHeight, body.offsetHeight,html.clientHeight, html.scrollHeight, html.offsetHeight );\r\n\t\tif(height>window.innerHeight){\r\n\t\t\tif (height - window.scrollY - window.innerHeight < 100) {\r\n\t\t\t\t$scope.loadNext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 查询热门推荐\r\n\t*/\r\n\t$scope.loadRecommend = function(host){\r\n\t\t$scope.loading = true;\r\n\t\tvar url = $scope.host+\"/wx/product/queryrecommend\";\r\n\t\tvar params = \"city=深圳&currentPage=\"+$scope.currentPage;\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tif(data.data.length<1){\r\n\t\t\t\t\tif($scope.items.length<1){\r\n\t\t\t\t\t\t$scope.noProductText = \"暂时没有热门项目\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.noProductText = \"已经没有项目了!\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.noProduct = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.mergeProdcut(data.data);\r\n\t\t\t\t\t$scope.items = $scope.items.concat(data.data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$scope.loading = false;\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert($scope,\"获取热门推荐数据失败，请稍后再试!\");\r\n\t\t\t$scope.loading = false;\r\n\t\t\t$scope.noProduct = true;\r\n\t\t})\r\n\t}\r\n\t$scope.mergeProdcut = function(items){\r\n\t\titems.forEach(function(item){\r\n\t\t\tif(item.priceunit!=null&&item.priceunit!=\"\"){\r\n\t\t\t\titem.preferPriceType = item.pricetype+\"/\"+item.priceunit;\r\n\t\t\t}else{\r\n\t\t\t\titem.preferPriceType = item.pricetype;\r\n\t\t\t}\r\n\t\t\tif(item.samllimg==\"\"||item.samllimg==null){\r\n\t\t\t\titem.samllimg = \"../contents/img/p_default.png\";\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 获取图片轮播\r\n\t*/\r\n\t$scope.queryBanner = function(){\r\n\t\tvar url = $scope.host+\"/wx/banner/query\";\r\n\t\tvar params = \"type=home_banner\";\r\n\t\t$http.post(url,params,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\t$scope.mergeBanner(data.data);\r\n\t\t\t\t$scope.banners = data.data;\r\n\t\t\t}\r\n\t\t}).error(function(){\r\n\t\t\tTool.alert(\"获取主页图片失败，请稍后再试!\");\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 为图片轮播添加链接\r\n\t*/\r\n\t$scope.mergeBanner = function(items){\r\n\t\tfor(var index in items){\r\n\t\t\tif(index==2){\r\n\t\t\t\titems[index].url=\"section/wrap-c.html\";\r\n\t\t\t}else if(index==3){\r\n\t\t\t\titems[index].url=\"section/wrap-d.html\";\r\n\t\t\t}else if(index==4){\r\n\t\t\t\titems[index].url=\"section/wrap-e.html\";\r\n\t\t\t}else{\r\n\t\t\t\titems[index].url= \"#\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t** 初始化图片轮播插件\r\n\t*/\r\n\t$scope.initSwiper = function(){\r\n\t\t//初始化swiper\r\n\t\tvar myswiper = new Swiper(\".swiper-container\",{\r\n\t\t\tloop:false,\r\n\t\t\tpagination: '.swiper-pagination',\r\n\t\t\tautoplay: 5000,\r\n\t\t\tautoplayDisableOnInteraction:false,\r\n\t\t\tobserveParents:true,  //\r\n\t\t\tobserver:true,\r\n\t\t})\r\n\t}\r\n\r\n\t/*\r\n\t** 跳转到详细页面\r\n\t*/\r\n\t$scope.detail = function(productId,hospitalId,flag){\r\n\t\tvar url = \"/new/htmls/product-detail.html#?flag=1&productId=\"+productId+\"&hospitalId=\"+hospitalId;\r\n\t\tTool.goPage(url);\r\n\t}\r\n\r\n\t/*\r\n\t** 分页查询，查询下一页\r\n\t*/\r\n\t$scope.loadNext = function(){\r\n\t\t$scope.currentPage++;\r\n\t\t$scope.loadRecommend();\r\n\t}\r\n\r\n\t/*\r\n\t** 底部按钮事件\r\n\t*/\r\n\t$scope.menuClick = function(value){\r\n\t\tTool.menuClick($scope,value);\r\n\t}\r\n\r\n\t$scope.alert = function(mess){\r\n\t\tTool.alert($scope,mess);\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}