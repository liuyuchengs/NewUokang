{"version":3,"sources":["makeorderCtrl.min.js"],"names":["app","controller","$scope","$http","Tool","Ajax","hasCheck","hasGift","noUserInfo","giftText","orderInfo","getSession","patientName","getLocal","realname","patientTelephone","phone","userInfo","hasDoctor","angular","element","document","ready","loadUserinfo","checkGift","selectCush","payMoney","parseFloat","giftMoney","flag","toFixed","doctorName","makeorder","url","params","productId","scheduleId","dealMoney","realMoney","code","paramsStr","convertParams","post","headers","Content-type","accessToken","success","data","removeSession","setSession","appid","redirect_uri","href","goUrl","alert","message","error"],"mappings":"AAAAA,IAAIC,WAAW,iBAAiB,SAAS,QAAQ,OAAO,OAAO,SAASC,EAAOC,EAAMC,EAAKC,GACzFH,EAAOI,UAAW,EAClBJ,EAAOK,SAAU,EACjBL,EAAOM,YAAa,EACpBN,EAAOO,SAAW,YAClBP,EAAOQ,UAAYN,EAAKO,WAAW,aACnCT,EAAOQ,UAAUE,YAAcR,EAAKS,SAAS,QAAQC,SACrDZ,EAAOQ,UAAUK,iBAAmBX,EAAKS,SAAS,QAAQG,MAC1Dd,EAAOe,SACPf,EAAOgB,WAAY,EAKnBC,QAAQC,QAAQC,UAAUC,MAAM,WAC/BlB,EAAKmB,aAAarB,GAClBA,EAAOsB,cAMRtB,EAAOuB,WAAa,WACnB,GAAGvB,EAAOK,QAAQ,CACjBL,EAAOI,UAAYJ,EAAOI,QAC1B,IAAIoB,GAAWC,WAAWzB,EAAOQ,UAAUgB,UACvCE,EAAYD,WAAWzB,EAAOQ,UAAUkB,UACzC1B,GAAOI,SACTJ,EAAOQ,UAAUgB,SAAWA,EAAWE,GAEvC1B,EAAOQ,UAAUgB,SAAWA,EAAWE,EACvC1B,EAAOQ,UAAUmB,KAAK,MAEvB3B,EAAOQ,UAAUgB,SAASI,QAAQ,KAOpC5B,EAAOsB,UAAY,WACfG,WAAWzB,EAAOQ,UAAUkB,WAAW,IACzC1B,EAAOI,UAAW,EAClBJ,EAAOK,SAAU,EACjBL,EAAOO,SAAW,cAEa,IAA7BP,EAAOQ,UAAUqB,YAA6C,MAA7B7B,EAAOQ,UAAUqB,aACpD7B,EAAOgB,WAAY,IAOrBhB,EAAO8B,UAAY,WAClB,GAAIC,GAAM7B,EAAKO,WAAW,QAAQ,iBAC9BuB,GACHC,UAAWjC,EAAOQ,UAAUyB,UAC5BC,WAAYlC,EAAOQ,UAAU0B,WAC7BxB,YAAaV,EAAOQ,UAAUE,YAC9BG,iBAAkBb,EAAOQ,UAAUK,iBACnCsB,UAAUnC,EAAOQ,UAAU2B,UAC3BC,UAAUpC,EAAOQ,UAAU4B,UAC3BZ,SAASxB,EAAOQ,UAAUgB,SAGxBxB,GAAOQ,UAAU6B,OACnBL,EAAOK,KAAOrC,EAAOQ,UAAU6B,MAG7BrC,EAAOQ,UAAUmB,OACnBK,EAAOL,KAAO3B,EAAOQ,UAAUmB,KAEhC,IAAIW,GAAYpC,EAAKqC,cAAcP,EACnC/B,GAAMuC,KAAKT,EAAIO,GACdG,SACCC,eAAe,kDACfC,YAAc3C,EAAOe,SAAS4B,eAE7BC,QAAQ,SAASC,GACnB,GAAc,GAAXA,EAAKR,KAAQ,CACfnC,EAAK4C,cAAc,aACnB5C,EAAK6C,WAAW,QAAQF,EAAKA,KAC7B,IAAIG,GAAQ,qBACRC,EAAe/C,EAAKO,WAAW,QAAQ,sBACvCyC,EAAO,6DAA6DF,EAAM,iBAAiBC,EAAa,oEAC5G/C,GAAKiD,MAAMD,OAEThD,GAAKkD,MAAMpD,EAAO6C,EAAKQ,WAEtBC,MAAM,WACRpD,EAAKkD,MAAMpD,EAAO","file":"makeorderCtrl.min.js","sourcesContent":["app.controller(\"makeorderCtrl\",[\"$scope\",\"$http\",\"Tool\",\"Ajax\",function($scope,$http,Tool,Ajax){\r\n\t$scope.hasCheck = false;\r\n\t$scope.hasGift = false;\r\n\t$scope.noUserInfo = true;\r\n\t$scope.giftText = \"本订单无可用代金券\";\r\n\t$scope.orderInfo = Tool.getSession(\"makeorder\");\r\n\t$scope.orderInfo.patientName = Tool.getLocal(\"user\").realname;\r\n\t$scope.orderInfo.patientTelephone = Tool.getLocal(\"user\").phone;\r\n\t$scope.userInfo;\r\n\t$scope.hasDoctor = true;\r\n\r\n\t/*\r\n\t** 页面初始化\r\n\t*/\r\n\tangular.element(document).ready(function(){\r\n\t\tTool.loadUserinfo($scope);\r\n\t\t$scope.checkGift();\r\n\t})\r\n\r\n\t/*\r\n\t** 是否使用代金券\r\n\t*/\r\n\t$scope.selectCush = function(){\r\n\t\tif($scope.hasGift){\r\n\t\t\t$scope.hasCheck = !$scope.hasCheck;\r\n\t\t\tvar payMoney = parseFloat($scope.orderInfo.payMoney);\r\n\t\t\tvar giftMoney = parseFloat($scope.orderInfo.giftMoney);\r\n\t\t\tif($scope.hasCheck){\r\n\t\t\t\t$scope.orderInfo.payMoney = payMoney - giftMoney;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.orderInfo.payMoney = payMoney + giftMoney;\r\n\t\t\t\t$scope.orderInfo.flag=null;\r\n\t\t\t}\r\n\t\t\t$scope.orderInfo.payMoney.toFixed(1);\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 判定是否有代金券可用\r\n\t*/\r\n\t$scope.checkGift = function(){\r\n\t\tif(parseFloat($scope.orderInfo.giftMoney)>0){\r\n\t\t\t$scope.hasCheck = true;\r\n\t\t\t$scope.hasGift = true;\r\n\t\t\t$scope.giftText = \"本订单可使用代金券￥\";\r\n\t\t}\r\n\t\tif($scope.orderInfo.doctorName==\"\"||$scope.orderInfo.doctorName==null){\r\n\t\t\t$scope.hasDoctor = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t** 下单按钮\r\n\t*/\r\n\t$scope.makeorder = function(){\r\n\t\tvar url = Tool.getSession(\"host\")+\"/wx/order/make\";\r\n\t\tvar params = {\r\n\t\t\tproductId: $scope.orderInfo.productId,\r\n\t\t\tscheduleId: $scope.orderInfo.scheduleId,\r\n\t\t\tpatientName: $scope.orderInfo.patientName,\r\n\t\t\tpatientTelephone: $scope.orderInfo.patientTelephone,\r\n\t\t\tdealMoney:$scope.orderInfo.dealMoney,\r\n\t\t\trealMoney:$scope.orderInfo.realMoney,\r\n\t\t\tpayMoney:$scope.orderInfo.payMoney,\r\n\t\t}\r\n\t\t//特惠专区传入任意code\r\n\t\tif($scope.orderInfo.code){\r\n\t\t\tparams.code = $scope.orderInfo.code;\r\n\t\t}\r\n\t\t//使用代金券flag=1,不使用不传入flag\r\n\t\tif($scope.orderInfo.flag){\r\n\t\t\tparams.flag = $scope.orderInfo.flag;\r\n\t\t}\r\n\t\tvar paramsStr = Tool.convertParams(params);\r\n\t\t$http.post(url,paramsStr,{\r\n\t\t\theaders:{\r\n\t\t\t\t'Content-type':'application/x-www-form-urlencoded;charset=UTF-8',\r\n\t\t\t\t'accessToken':$scope.userInfo.accessToken\r\n\t\t\t}\r\n\t\t}).success(function(data){\r\n\t\t\tif(data.code==0){\r\n\t\t\t\tTool.removeSession(\"makeorder\");\r\n\t\t\t\tTool.setSession(\"order\",data.data);\r\n\t\t\t\tvar appid = \"wx0229404bc9eeea00\";\r\n\t\t\t\tvar redirect_uri = Tool.getSession(\"host\")+\"/new/htmls/pay.html\";\r\n\t\t\t\tvar href = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+appid+\"&redirect_uri=\"+redirect_uri+\"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect\";\r\n\t\t\t\tTool.goUrl(href);\r\n\t\t   }else{\r\n\t\t\t   Tool.alert($scope,data.message);\r\n\t\t   }\r\n\t   }).error(function(){\r\n\t\t   Tool.alert($scope,\"创建订单失败，请稍后再试!\");\r\n\t   })\r\n\t}\r\n}])\r\n"],"sourceRoot":"/source/"}